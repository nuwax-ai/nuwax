"use strict";(()=>{(self.webpackChunknuwax_frontend=self.webpackChunknuwax_frontend||[]).push([[5517],{75517:function(xl,qt,L){L.r(qt),L.d(qt,{default:function(){return el}});var ua=L(90228),ee=L.n(ua),da=L(87999),xe=L.n(da),ca=L(48305),me=L.n(ca),fa=L(15558),Ee=L.n(fa),pa=L(26068),x=L.n(pa),cn=L(40462),Tn=L(79484),va=L(55217),ga=L(11027),_t=L(33378),ha=L(82092),pe=L.n(ha),i=L(30799),se=L(38170),yt,ma=["Start","LLM","Plugin","Code","HTTPRequest","TextProcessing","Workflow","DocumentExtraction","Knowledge","TableSQL","TableDataQuery","TableDataUpdate","TableDataDelete","TableDataAdd"],er={IF:"\u5982\u679C",ELSE_IF:"\u5426\u5219\u5982\u679C",ELSE:"\u5426\u5219"},Nl=i.K$.General,Il=i.K$.Loop,nr=[{label:"\u4E2D\u65AD\u6D41\u7A0B",value:i.Xy.INTERRUPT},{label:"\u8FD4\u56DE\u7279\u5B9A\u5185\u5BB9",value:i.Xy.SPECIFIC_CONTENT},{label:"\u6267\u884C\u5F02\u5E38\u6D41\u7A0B",value:i.Xy.EXECUTE_EXCEPTION_FLOW}],xt=[i.C8.LLM,i.C8.Plugin,i.C8.Workflow,i.C8.MCP,i.C8.Code,i.C8.IntentRecognition,i.C8.Knowledge,i.C8.TableDataQuery,i.C8.TableDataUpdate,i.C8.TableDataDelete,i.C8.TableDataAdd,i.C8.TableSQL,i.C8.QA,i.C8.DocumentExtraction,i.C8.HTTPRequest],Ca=[{label:"\u4E0D\u91CD\u8BD5",value:0},{label:"1\u6B21",value:1},{label:"2\u6B21",value:2},{label:"3\u6B21",value:3}],ya=(yt={},pe()(pe()(pe()(pe()(pe()(pe()(pe()(pe()(pe()(pe()(yt,i.FN.EQUAL,"="),i.FN.NOT_EQUAL,"\u2260"),i.FN.GREATER_THAN,">"),i.FN.GREATER_THAN_OR_EQUAL,"\u2265"),i.FN.LESS_THAN,"<"),i.FN.LESS_THAN_OR_EQUAL,"\u2264"),i.FN.CONTAINS,"\u2283"),i.FN.NOT_CONTAINS,"\u2285"),i.FN.MATCH_REGEX,"~"),i.FN.IS_NULL,"\u2205"),pe()(yt,i.FN.NOT_NULL,"!\u2205")),xa=pe()(pe()({},i.J4.TEXT,"\u76F4\u63A5\u56DE\u7B54"),i.J4.SELECT,"\u9009\u9879\u56DE\u7B54"),Rn={newNodeOffsetX:100,newNodeOffsetY:100,offsetGapX:15,offsetGapY:15},Ln=pe()(pe()(pe()(pe()(pe()({},i.C8.Loop,{defaultWidth:860,defaultHeight:240}),i.C8.Condition,{defaultWidth:300,defaultHeight:120}),i.C8.QA,{defaultWidth:300,defaultHeight:110}),i.C8.IntentRecognition,{defaultWidth:300,defaultHeight:78}),"default",{defaultWidth:220,defaultHeight:44}),et=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Na={type:i.C8.Start,shape:i.K$.General,nodeConfig:{inputArgs:[]},id:se.zQ.empty,name:"\u6D4B\u8BD5",description:"\u6D4B\u8BD5",workflowId:0,icon:""},Ue="skillComponentConfigs",Ia=[{label:"\u8BBE\u7F6E\u53D8\u91CF\u503C",value:se.Do.SET_VARIABLE},{label:"\u83B7\u53D6\u53D8\u91CF\u503C",value:se.Do.GET_VARIABLE}],an=L(13765),Se=L(28327),ke=L(2201),Nt=L(40859),J=L(28190),j=L(75271),Re=L(53586),It=L(43637),Ea=L(38949),ba=L(6935),wa=L(2808),Sa=L(18765),ka=L(29895),ja=L(46448),Et=L(24573),Fa=L(56555),Aa=L(84523),oe=L(35843),Da=L(22675),Ta=L(46388),Ra=L(92973),La=L(26145),Zn=L(83352),tr=L(11239),Pa=L(335),gn=L.n(Pa),nt=L(27867),En=L(10749),tt=L(32699),On=function(t){var e,r,a=t.getChildren?Array.from(t.getChildren()||[]):[];if(a.length!==0){var o=1/0,l=1/0,s=-1/0,u=-1/0,c=40;if(a.forEach(function(A){if(En.NB.isNode(A)){var D=A.getBBox(),E=D.x,R=D.y,P=D.x+D.width,G=D.y+D.height;o=Math.min(o,E),l=Math.min(l,R),s=Math.max(s,P),u=Math.max(u,G)}}),!!isFinite(o)){var v=o-c,N=l-c,h=s+c,f=u+c,m=h-v,S=f-N,b=(e=(r=t).getData)===null||e===void 0?void 0:e.call(r),k=b?.type===i.C8.Loop,g=k?860:220,C=240;m=Math.max(m,g),S=Math.max(S,C);var d=(v+h)/2,y=(N+f)/2,I=d-Math.max(m,g)/2,w=y-Math.max(S,C)/2;t.prop({position:{x:I,y:w},size:{width:m,height:S}},{skipParentHandler:!0})}}};function rt(p){p.attr({line:{strokeDasharray:"",stroke:"#5147FF",strokeWidth:1}})}function rr(p,t){return p.type==="Loop"?p.id===t:p.loopNodeId===t}function bt(p,t){p.nextNodeIds?p.nextNodeIds.includes(t)||p.nextNodeIds.push(t):p.nextNodeIds=[t]}var ar=function(t,e){if(e===void 0||t===null)return"";var r=t?.getPort(e);return r?.group||""};function Va(p,t){if(p.type==="Loop"&&t.loopNodeId&&t.loopNodeId===p.id){var e=x()({},p);return e.innerStartNodeId=t.id,e}if(t.type==="Loop"&&p.loopNodeId&&p.loopNodeId===t.id){var r=x()({},t);return r.innerEndNodeId=p.id,r}return!1}function Ba(p,t,e){var r=JSON.parse(JSON.stringify(p)),a=t.id;if(p.type===i.C8.Condition){var o=gn()(r.nodeConfig.conditionBranchConfigs),l;try{for(o.s();!(l=o.n()).done;){var s=l.value;e.includes(s.uuid)&&bt(s,a)}}catch(m){o.e(m)}finally{o.f()}}else if(p.type===i.C8.IntentRecognition){var u=gn()(r.nodeConfig.intentConfigs),c;try{for(u.s();!(c=u.n()).done;){var v=c.value;e.includes(v.uuid)&&bt(v,a)}}catch(m){u.e(m)}finally{u.f()}}else if(p.type===i.C8.QA&&p.nodeConfig.answerType===i.J4.SELECT){var N=gn()(r.nodeConfig.options),h;try{for(N.s();!(h=N.n()).done;){var f=h.value;e.includes(f.uuid)&&bt(f,a)}}catch(m){N.e(m)}finally{N.f()}}return r}function El(p,t){return p!=null&&p.includes("left")||t!=null&&t.includes("right")?(message.warning("\u5DE6\u4FA7\u8FDE\u63A5\u6869\u53EA\u80FD\u4F5C\u4E3A\u63A5\u5165\u70B9\uFF0C\u53F3\u4FA7\u8FDE\u63A5\u6869\u53EA\u80FD\u4F5C\u4E3A\u8F93\u51FA\u70B9"),!1):!0}function Za(p,t,e,r,a,o){return p.some(function(l){return o&&l.id===o?!1:l.getSourceCellId()===t.toString()&&l.getTargetCellId()===e.toString()&&l.getSourcePortId()===r&&l.getTargetPortId()===a})}var Oa={name:"classic",size:6,fill:"#5147FF",stroke:"#5147FF"},Gn=function(t){var e=new Map;t.getEdges().forEach(function(r){var a=r.getTargetNode(),o=r.getTargetPortId();if(a&&o){var l="".concat(a.id,"-").concat(o),s=e.get(l)||[];s.push(r),e.set(l,s)}}),e.forEach(function(r){var a=r.sort(function(o,l){return o.id.localeCompare(l.id)});a.forEach(function(o,l){var s,u,c=l===a.length-1,v=o.getSourceNode(),N=o.getTargetNode();if((v==null||(s=v.getData)===null||s===void 0||(s=s.call(v))===null||s===void 0?void 0:s.type)==="LoopEnd"||(N==null||(u=N.getData)===null||u===void 0||(u=u.call(N))===null||u===void 0?void 0:u.type)==="LoopStart")return o.attr("line/targetMarker",null);o.attr("line/targetMarker",c?Oa:null)})})},Ga=function(t,e){if(e.type===i.C8.Loop){var r=[i.C8.IntentRecognition,i.C8.Condition,i.C8.QA];if(r.includes(t.type)&&t.loopNodeId)return"\u6761\u4EF6\u5206\u652F\uFF0C\u610F\u56FE\u8BC6\u522B\uFF0C\u95EE\u7B54\u4E0D\u80FD\u4F5C\u4E3A\u5FAA\u73AF\u7684\u51FA\u53E3\u8FDE\u63A5\u8282\u70B9";if(t.loopNodeId&&t.loopNodeId===e.id&&e.innerEndNodeId&&e.innerEndNodeId!==-1)return"\u5F53\u524D\u5DF2\u6709\u5BF9\u5B50\u8282\u70B9\u8FDE\u63A5\u5FAA\u73AF\u7684\u51FA\u53E3\uFF0C\u8BF7\u5148\u5220\u9664\u8BE5\u8FDE\u7EBF"}return t.type===i.C8.Loop&&e.loopNodeId&&e.loopNodeId===t.id&&t.innerStartNodeId&&t.innerStartNodeId!==-1?"\u5F53\u524D\u5FAA\u73AF\u5DF2\u6709\u5BF9\u5B50\u8282\u70B9\u7684\u8FDE\u7EBF\uFF0C\u8BF7\u5148\u5220\u9664\u8BE5\u8FDE\u7EBF":!1},Wa=function(t,e){var r,a,o=t.getSourceCellId(),l=t.getTargetCellId(),s=t.getSourcePortId()||"",u=t.getTargetPortId()||"",c=(r=t.getSourceNode())===null||r===void 0?void 0:r.getData(),v=(a=t.getTargetNode())===null||a===void 0?void 0:a.getData(),N=t.id,h=c.type===i.C8.Loop||v.type===i.C8.Loop;if(Za(e,o,l,s,u,N))return"\u4E0D\u80FD\u521B\u5EFA\u91CD\u590D\u7684\u8FB9";if(h){if(c.type===i.C8.Loop&&!v.loopNodeId&&s.includes("in")||v.type===i.C8.Loop&&!c.loopNodeId&&u.includes("out"))return"\u4E0D\u80FD\u8FDE\u63A5\u5916\u90E8\u7684\u8282\u70B9";var f=Ga(c,v);if(f!==!1)return f}if(c.type!==i.C8.Loop&&s!==null&&s!==void 0&&s.includes("in")||s!=null&&s.includes("left")||u!=null&&u.includes("right"))return"";var m=c.loopNodeId||v.loopNodeId;return m&&(!rr(c,m)||!rr(v,m))?"\u4E0D\u80FD\u8FDE\u63A5\u5916\u90E8\u8282\u70B9":c.type===i.C8.Loop&&s!==null&&s!==void 0&&s.includes("out")&&u!==null&&u!==void 0&&u.includes("out")?"":!1},at=function(t,e){if(!t)return null;var r=e.getCellById(t);return r},or=function(t,e,r){if(!t.length||!e)return"";var a=[];if(Object.keys(e).forEach(function(c){var v=(e[c]||[""]).some(function(N){return N?t.includes(N):!1});v&&a.push(c)}),a.length===1)return a[0];if(a.length>1){var o=a.map(function(c){var v=at(c,r);return v?.getData()||{}}),l=o.filter(function(c){var v=c.modified,N=v===void 0?"":v;return N&&!isNaN(new Date(N).getTime())});if(l.length===1){var s;return((s=l[0])===null||s===void 0?void 0:s.id)||""}if(l.length>1){var u;return((u=l.sort(function(c,v){var N=new Date(c.modified||"").getTime(),h=new Date(v.modified||"").getTime();return h-N})[0])===null||u===void 0?void 0:u.id)||""}}return""},Ma=function(t,e,r){var a=at(t,e),o=a?.model,l=o.outgoings,s=l===void 0?{}:l,u=o.incomings,c=u===void 0?{}:u,v=[],N="",h=null,f=null;if(r==="previous"){var m;v=c[t]||[],N=or(v,s,e),f=(m=at(N,e))===null||m===void 0?void 0:m.getPosition()}else if(r==="next"){var S;v=s[t]||[],N=or(v,c,e),f=(S=at(N,e))===null||S===void 0?void 0:S.getPosition()}return f&&(h=f),h},Ha=function(t,e){var r=[i.C8.Loop,i.C8.LoopStart,i.C8.LoopEnd,i.C8.Start,i.C8.End].includes(e.type),a=50,o=e.type===i.C8.Loop;return{in:{position:"left",attrs:{circle:{r:t,magnet:!0,magnetRadius:a}},connectable:{source:o,target:!0}},out:{position:{name:r?"right":"absolute"},attrs:{circle:{r:t,magnet:!0,magnetRadius:a}},connectable:{source:!0,target:o}},special:{position:{name:"absolute"},attrs:{circle:{r:t,magnet:!0,magnetRadius:a}},connectable:{source:!0,target:o}},exception:{position:{name:"absolute"},attrs:{circle:{r:t,magnet:!0,magnetRadius:a}},connectable:{source:!0,target:o}}}},Ua=function(t,e){return!(t.type===i.C8.Loop&&e.type===i.C8.LoopStart||t.type===i.C8.LoopEnd&&e.type===i.C8.Loop)},ot=function(t){return xt.includes(t.type)},ir=function(t){return[].concat(Ee()(xt),[i.C8.Condition]).includes(t.type)},it=function(t,e){var r;return ot(t)&&((r=t.nodeConfig)===null||r===void 0||(r=r.exceptionHandleConfig)===null||r===void 0?void 0:r.exceptionHandleType)===i.Xy.EXECUTE_EXCEPTION_FLOW&&e===se.TG.exception||!1},$a=function(t,e){return t.exceptionHandleType===e.exceptionHandleType&&t.specificContent===e.specificContent&&t.timeout===e.timeout&&t.retryCount===e.retryCount&&(0,tt.isEqual)(t.exceptionHandleNodeIds,e.exceptionHandleNodeIds)},wt=function(t){return t===""||t===void 0||t===null||(0,nt.Qr)(t)?"":typeof t=="string"?t:(0,tt.isPlainObject)(t)?JSON.stringify(t,null,2):""},za=function p(t,e){return t?t!=null&&t.classList.contains(e)?t:p(t?.parentElement||null,e):null},sr=function(t){var e=t.getData();return e.type==="Loop"?t.prop("zIndex")===10:t.prop("zIndex")===99},Xa=function(t){var e=t.graph,r=t.changeZIndex;e.on("node:click",function(a){var o=a.node;setTimeout(function(){if(o.prop("__click_type__")==="dblclick"){o.prop("__click_type__",null);return}var l=sr(o);l||r(o)},0)}),e.on("node:dblclick",function(a){var o=a.node,l=a.e.target,s=sr(o),u=za(l,"node-editable-title-text");u&&(s?(o.prop("__click_type__",null),o.prop("__click_flag__",null),u.dispatchEvent(new Event("onEditTitle"))):(o.prop("__click_type__","dblclick"),r(o),setTimeout(function(){o.prop("__click_flag__")||(o.prop("__click_flag__",!0),e.trigger("node:dblclick",{node:o,e:{target:document.querySelector('[data-id="'.concat(o.getData().id.toString(),'"]'))}}))},0)))})},Qa=function(t){var e=t.type,r=t.position,a=t.hasTargetNode,o=t.portId,l=t.sourceNodeId,s=t.graph;if(a){var u=hn({type:e,nodeConfig:{}}),c=u.width,v=u.height;return r.x=r.x-c/2,r.y=r.y-v/2,r}var N=Ln.default.defaultWidth;e===i.C8.Loop?N=Ln[i.C8.Loop].defaultWidth+260:(e===i.C8.Condition||e===i.C8.Interval||e===i.C8.QA)&&(N=Ln[i.C8.Condition].defaultWidth);var h=o.endsWith("out"),f=Ma(l,s,h?"next":"previous"),m=200;return h?(r.x=r.x+Rn.newNodeOffsetX,f!==null&&f.x<=r.x+m&&(r.x=f.x+Rn.offsetGapX,r.y=f.y+Rn.offsetGapX)):(r.x=r.x-N-Rn.newNodeOffsetX,f!==null&&f.x>=r.x-m&&(r.x=f.x-Rn.offsetGapX,r.y=f.y+Rn.offsetGapX)),r},lr=function(t,e){if(t){var r=e||0;return{x:t.x+t.width/2+r*16,y:t.y+t.height/2+r*16}}return{x:0,y:0}},bl=function(t,e,r){return t?"x"in t&&"y"in t?{x:t.x,y:t.y}:t.clientX&&t.clientY?{x:t.clientX,y:t.clientY}:lr(e,r):lr(e,r)},Ka=function(t,e){var r;if(!t.nodeConfig)return[];var a;switch(t.type){case i.C8.Condition:a=t.nodeConfig.conditionBranchConfigs;break;case i.C8.IntentRecognition:a=t.nodeConfig.intentConfigs;break;default:a=t.nodeConfig.options;break}return((r=a)===null||r===void 0?void 0:r.flatMap(function(o){return o.nextNodeIds||(o.nextNodeIds=[]),o.nextNodeIds.map(function(l){return{source:"".concat(t.id,"-").concat(o.uuid),target:l.toString(),zIndex:e?5:1}})}))||[]},Ja=function(t){var e=[];t.innerStartNodeId&&t.innerStartNodeId!==-1&&e.push({source:"".concat(t.id,"-in"),target:t.innerStartNodeId.toString(),zIndex:5}),t.innerEndNodeId&&t.innerEndNodeId!==-1&&e.push({source:t.innerEndNodeId.toString(),target:"".concat(t.id,"-out"),zIndex:5});var r=(t.nextNodeIds||[]).filter(function(a){return a!==t.innerStartNodeId&&a!==t.innerEndNodeId}).map(function(a){return{source:Number(t.id).toString(),target:Number(a).toString(),zIndex:5}});return e.push.apply(e,Ee()(r)),e},Ya=function(t,e){var r=Ee()(e);return t.forEach(function(a){var o,l=((o=a.nodeConfig)===null||o===void 0?void 0:o.exceptionHandleConfig)||{},s=l.exceptionHandleNodeIds,u=s===void 0?[]:s;if(it(a,se.TG.exception)&&u.length>0){var c=!!a.loopNodeId;r=r.concat(Ee()(u.map(function(v){return{source:"".concat(a.id,"-exception-out"),target:"".concat(v),zIndex:c?5:1}})))}}),r},Wn=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=Ya(t,t.flatMap(function(s){var u=!1;if(s.loopNodeId&&(u=!0),s.type===i.C8.Condition||s.type===i.C8.IntentRecognition||s.type===i.C8.QA&&s.nodeConfig.answerType===i.J4.SELECT)return Ka(s,u);if(s.type===i.C8.Loop)return Ja(s);if(s.nextNodeIds&&s.nextNodeIds.length>0){var c=s.nextNodeIds.filter(function(v){return v!==s.loopNodeId&&v!==s.id});return c.map(function(v){return{source:Number(s.id).toString(),target:Number(v).toString(),zIndex:u?5:1}})}return[]})),a=e?r.filter(function(s){return t.some(function(u){var c=s.target.split("-")[0];return c===u.id.toString()})}):r,o=new Set,l=[];return a.forEach(function(s){var u="".concat(s.source,"-").concat(s.target);o.has(u)||(o.add(u),l.push(s))}),console.log("getEdges:resultEdges",l),l},n=L(52676),hn=function(t){var e=t.type,r=t.nodeConfig,a=r?.extension||{},o=Ln[e]||Ln.default,l=o.defaultWidth,s=o.defaultHeight,u=xt.includes(e),c=32,v=u?c:0;return e===i.C8.QA||e===i.C8.Condition||e===i.C8.IntentRecognition?{width:l,height:(a.height||s)+v}:e===i.C8.Loop?{width:a.width&&a.width>l?a.width:l,height:(a.height||s)+v}:{width:l,height:s+v}},ur=10,Pn=ur+1,qa="#e67e22",_a="#5147FF",eo={Agent:Da,Table:Ta,Knowledge:Ra,Plugin:La,Workflow:Zn,Trigger:Zn,Variable:Zn,Model:Zn,Page:Zn},St=function(t){return t===i.C8.Loop?i.K$.Loop:i.K$.General},dr=function(t){return eo[t]},st=function(t){switch(t){case i.C8.Start:case i.C8.LoopStart:return(0,n.jsx)(oe.nG,{});case i.C8.End:case i.C8.LoopEnd:return(0,n.jsx)(oe.Br,{});case i.C8.Output:return(0,n.jsx)(oe.N$,{});case i.C8.Code:return(0,n.jsx)(oe.HF,{});case i.C8.Condition:return(0,n.jsx)(oe.ZO,{});case i.C8.DocumentExtraction:return(0,n.jsx)(oe.zL,{});case i.C8.HTTPRequest:return(0,n.jsx)(oe.qm,{});case i.C8.IntentRecognition:return(0,n.jsx)(oe.mT,{});case i.C8.Knowledge:return(0,n.jsx)(oe.fF,{});case i.C8.LLM:return(0,n.jsx)(oe.EF,{});case i.C8.LongTermMemory:return(0,n.jsx)(oe.GY,{});case i.C8.Loop:return(0,n.jsx)(oe.ZX,{});case i.C8.LoopContinue:return(0,n.jsx)(oe.uS,{});case i.C8.LoopBreak:return(0,n.jsx)(oe.QL,{});case i.C8.Plugin:return(0,n.jsx)(oe.KS,{});case i.C8.QA:return(0,n.jsx)(oe.MO,{});case i.C8.TextProcessing:return(0,n.jsx)(oe.lR,{});case i.C8.Variable:case i.C8.VariableAggregation:return(0,n.jsx)(oe.JU,{});case i.C8.Workflow:return(0,n.jsx)(oe.fl,{});case i.C8.TableDataAdd:return(0,n.jsx)(oe.wN,{});case i.C8.TableDataDelete:return(0,n.jsx)(oe.t_,{});case i.C8.TableDataUpdate:return(0,n.jsx)(oe.Lg,{});case i.C8.TableDataQuery:return(0,n.jsx)(oe.Qe,{});case i.C8.TableSQL:return(0,n.jsx)(oe.rX,{});case i.C8.MCP:return(0,n.jsx)(oe.VE,{});default:return(0,n.jsx)(oe.$B,{})}},kt=function(t){switch(t){case i.C8.Start:case i.C8.End:return"#EEEEFF";case i.C8.Code:case i.C8.Loop:case i.C8.LoopContinue:case i.C8.LoopBreak:case i.C8.Condition:case i.C8.IntentRecognition:return"#ebf9f9";case i.C8.Knowledge:case i.C8.Variable:case i.C8.VariableAggregation:case i.C8.LongTermMemory:case i.C8.MCP:return"#FFF0DF";case i.C8.QA:case i.C8.DocumentExtraction:case i.C8.TextProcessing:case i.C8.HTTPRequest:return"#fef9eb";case i.C8.LLM:return"#E9EBED";case i.C8.Plugin:return"#E7E1FF";case i.C8.Workflow:return"#D0FFDB";case i.C8.Output:return"#E7E1FF";default:return"#EEEEFF"}},lt=function(t){var e,r=t.data,a=t.ports,o=t.type,l=r.type===i.C8.Loop,s=hn(r),u=s.width,c=s.height,v=((e=a[a.length-1])===null||e===void 0||(e=e.args)===null||e===void 0?void 0:e.offsetY)||c-Pn,N=l?c:v+Pn;return{type:o,width:u,height:N}},no=function(t,e,r){var a,o=hn(t).width,l=(a=e[e.length-1])===null||a===void 0||(a=a.args)===null||a===void 0?void 0:a.offsetY,s=24;return it(t,se.TG.exception)?[].concat(Ee()(e),[r({group:se.TG.exception,idSuffix:"exception-out",yHeight:l+ur+s/2,offsetY:l+s+Pn,xWidth:o,color:qa})]):(ot(t)&&e.length>=1&&(e.length===1&&(e[e.length-1].args.y=(l+s+Pn+1)/2),e[e.length-1].args.offsetY=l+s+Pn),e)},bn=function(t){var e=3,r=Ln.default.defaultHeight,a=hn(t).width,o=function(d){var y=d.group,I=d.idSuffix,w=d.color,A=w===void 0?_a:w,D=d.yHeight,E=D===void 0?(r-1)/2+1:D,R=d.xWidth,P=R===void 0?I==="in"?0:a:R,G=d.offsetY,B=G===void 0?r-Pn:G,Y=d.offsetX,le=Y===void 0?P:Y;return{group:y,markup:[{tagName:"circle",selector:"circle",attrs:{magnet:!0,pointerEvents:"auto"}},{tagName:"image",selector:"icon",attrs:{magnet:!1}},{tagName:"circle",selector:"hoverCircle",attrs:{r:e+10,opacity:0,pointerEvents:"visiblePainted",zIndex:-1,magnet:!1}}],id:"".concat(t.id,"-").concat(I),zIndex:99,magnet:!0,attrs:{circle:{r:e,magnet:!0,stroke:A,fill:A,magnetRadius:30,zIndex:2},icon:{xlinkHref:tr.Z,magnet:!1,width:0,height:0,fill:"#fff",zIndex:-2,pointerEvents:"none",opacity:0}},args:{x:P,y:E,offsetY:B,offsetX:le}}},l=[o({group:se.TG.in,idSuffix:"in"})],s=[];switch(t.type){case i.C8.Start:l=[],s=[o({group:se.TG.out,idSuffix:"out"})];break;case i.C8.End:l=[o({group:se.TG.in,idSuffix:"in"})],s=[];break;case i.C8.Condition:case i.C8.IntentRecognition:{var u,c=((u=t.nodeConfig)===null||u===void 0?void 0:u.conditionBranchConfigs)||t.nodeConfig.intentConfigs||[],v=r,N=t.type===i.C8.Condition?32:24,h=t.type===i.C8.Condition?16:12;l=[x()({},o({group:se.TG.in,idSuffix:"in"}))],s=c.map(function(C,d){return x()({},o({group:se.TG.special,idSuffix:"".concat(C.uuid||d,"-out"),yHeight:v+(d+1)*N-h,xWidth:hn(t).width,offsetY:v+(d+1)*N}))});break}case i.C8.QA:{var f,m=t.nodeConfig.answerType,S=(f=t.nodeConfig)===null||f===void 0?void 0:f.options,b=24,k=12,g=r;m===i.J4.SELECT?(g+=b*3,s=(S||[]).map(function(C,d){return x()({},o({group:se.TG.special,idSuffix:"".concat(C.uuid||d,"-out"),yHeight:g+(d+1)*b-k,xWidth:hn(t).width,offsetY:g+(d+1)*b}))})):(g+=b*2,s=[x()({},o({group:se.TG.out,idSuffix:"out",yHeight:g+b-k,xWidth:hn(t).width,offsetY:g+b}))]);break}default:l=[o({group:se.TG.in,idSuffix:"in"})],s=[o({group:se.TG.out,idSuffix:"out"})];break}return s=no(t,s,o),{groups:Ha(e,t),items:[].concat(Ee()(l),Ee()(s))}},wl=function(t,e,r){var a,o,l=((a=t.nodeConfig)===null||a===void 0||(a=a[r])===null||a===void 0?void 0:a.length)||0,s=((o=e.nodeConfig)===null||o===void 0||(o=o[r])===null||o===void 0?void 0:o.length)||0;return l!==s?s:null},Sl=function(t,e,r){t.forEach(function(a){var o=a.getAttribute("port"),l=o===r;a.style.visibility="visible",e&&l?(a.setAttribute("width","12"),a.setAttribute("height","12"),a.style.fill="#5F95FF"):(a.setAttribute("width","8"),a.setAttribute("height","8"),a.style.fill="#A2B1C3")})};function cr(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:800,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:600;return{x:Math.random()*(p-300),y:Math.random()*(t-83)}}var to=function(t){var e,r,a,o=((e=t.nodeConfig)===null||e===void 0?void 0:e.extension)||{},l=t.loopNodeId,s=bn(t),u=lt({data:t,ports:s.items,type:se.yn.create}),c=u.width,v=u.height;return{id:t.id.toString(),shape:St(t.type),x:(r=o.x)!==null&&r!==void 0?r:cr().x,y:(a=o.y)!==null&&a!==void 0?a:cr().y,width:c,height:v,label:t.name,data:x()(x()({},t),{},{parentId:null}),ports:bn(t),zIndex:l?6:3}},fr=function(t,e){var r,a=((r=e.nodeConfig)===null||r===void 0?void 0:r.extension)||{},o=bn(e),l=lt({data:e,ports:o.items,type:se.yn.create}),s=l.width,u=l.height;return{id:e.id.toString(),shape:St(e.type),x:a.x,y:a.y,width:s,height:u,label:e.name,data:x()(x()({},e),{},{nodeConfig:x()(x()({},e.nodeConfig),{},{extension:a}),parentId:t}),ports:bn(e),zIndex:6,inherit:!1}},pr=function(t){if(t.source!==t.target){var e=function(a,o){var l=a.includes("in")||a.includes("out"),s=a.includes("-");return{cell:l||s?a.split("-")[0]:a,port:l?a:"".concat(a,"-").concat(o)}};return{shape:"edge",router:{name:"orth"},attrs:{line:{stroke:"#5147FF",strokeWidth:1}},source:e(t.source,"out"),target:e(t.target,"in"),zIndex:t.zIndex||1}}},kl=function(t,e){var r,a=t.getData();(r=a.innerNodes)!==null&&r!==void 0&&r.length&&(a.innerNodes.forEach(function(o){var l=fr(a.id.toString(),o),s=e.addNode(l);s.setData(_objectSpread(_objectSpread({},o),{},{parentId:t.id})),t.addChild(s)}),adjustParentSize(t))},ro=function(t,e,r,a){var o;switch(t.type){case"Condition":{var l;o=(l=t.nodeConfig)===null||l===void 0?void 0:l.conditionBranchConfigs;break}case"IntentRecognition":{var s;o=(s=t.nodeConfig)===null||s===void 0?void 0:s.intentConfigs;break}case"QA":{var u;o=(u=t.nodeConfig)===null||u===void 0?void 0:u.options;break}default:{o=[];break}}o.forEach(function(v){var N=v.nextNodeIds||[];e.includes(v.uuid)&&(a?v.nextNodeIds=N.map(function(h){return h===a.id?r:h}):v.nextNodeIds=[].concat(Ee()(N),[r]))});var c=x()(x()({},t),{},{nodeConfig:x()(x()(x()(x()({},t.nodeConfig),t.type===i.C8.Condition&&{conditionBranchConfigs:o}),t.type===i.C8.IntentRecognition&&{intentConfigs:o}),t.type===i.C8.QA&&{options:o})});return c},ao=function(t,e,r){var a,o=e.split("-"),l=o.slice(1,-1).join("-"),s;switch(t.type){case"Condition":{var u;s=(u=t.nodeConfig)===null||u===void 0?void 0:u.conditionBranchConfigs;break}case"IntentRecognition":{var c;s=(c=t.nodeConfig)===null||c===void 0?void 0:c.intentConfigs;break}case"QA":{var v;s=(v=t.nodeConfig)===null||v===void 0?void 0:v.options;break}default:{s=[];break}}(a=s)===null||a===void 0||a.forEach(function(h){l.includes(h.uuid)&&(h.nextNodeIds=(h.nextNodeIds||[]).filter(function(f){return f!==r}))});var N=x()(x()({},t),{},{nodeConfig:x()(x()(x()(x()({},t.nodeConfig),t.type===i.C8.Condition&&{conditionBranchConfigs:s}),t.type===i.C8.IntentRecognition&&{intentConfigs:s}),t.type===i.C8.QA&&{options:s})});return N},oo=function(t){var e,r=t.sourceNode,a=t.id,o=t.targetNodeId,l=Ee()(((e=r.nodeConfig)===null||e===void 0||(e=e.exceptionHandleConfig)===null||e===void 0?void 0:e.exceptionHandleNodeIds)||[]);o?l=l.map(function(u){return u===o?a:u}):l=[].concat(Ee()(l),[a]);var s=x()(x()({},r),{},{nodeConfig:x()(x()({},r.nodeConfig),{},{exceptionHandleConfig:x()(x()({},r.nodeConfig.exceptionHandleConfig),{},{exceptionHandleNodeIds:l})})});return s},vr=function(t,e){var r,a,o=JSON.parse(JSON.stringify(t)),l=((r=o.nodeConfig)===null||r===void 0?void 0:r.conditionBranchConfigs)||((a=o.nodeConfig)===null||a===void 0?void 0:a.intentConfigs);if(!l||l.length===0)return console.warn("[QuicklyCreateEdgeConditionConfig] \u6761\u4EF6/\u610F\u56FE\u914D\u7F6E\u4E3A\u7A7A\uFF0C\u8DF3\u8FC7\u8FDE\u7EBF"),{nodeData:o,sourcePortId:""};l[0].nextNodeIds=[e.id];var s="".concat(o.id,"-").concat(l[0].uuid);return t.type==="Condition"?o.nodeConfig.conditionBranchConfigs=l:o.nodeConfig.intentConfigs=l,{nodeData:o,sourcePortId:s}},io=function(t){var e=t.type,r=t.nodeConfig,a=t.form;switch(e){case i.C8.HTTPRequest:{r.method||a.setFieldValue("method",i.LM.GET),r.contentType||a.setFieldValue("contentType",i.lT.OTHER),r.timeout||a.setFieldValue("timeout",30);break}case i.C8.Variable:{r.configType||a.setFieldValue("configType",se.Do.SET_VARIABLE);break}case i.C8.QA:{r.answerType||a.setFieldValue("answerType",i.J4.TEXT);break}default:break}},jl=function(t,e){if(e&&e!==null&&e!==void 0&&e.includes("File")){var r,a=(r=e?.startsWith("Array_"))!==null&&r!==void 0?r:!1;return a?JSON.stringify(t?.map(function(o){return o?.url})||[]):t?.url}return typeof t!="string"&&t!==null?JSON.stringify(t):t},Fl=function(){var t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1?arguments[1]:void 0,a,o=(t=r?.startsWith("Array_"))!==null&&t!==void 0?t:!1;if(o)a=Array.isArray(e)&&e?.length>0?e?.map(function(s){return s?.url}):[];else if(Array.isArray(e)){var l;a=(e==null||(l=e[0])===null||l===void 0?void 0:l.url)||""}else a=e?.url||"";return a},so=function(t){var e=t.spaceId,r=t.workflowId;return localStorage.getItem("testRun_".concat(e,"_").concat(r))||""},gr=function(t){var e=t.spaceId,r=t.workflowId,a=t.value;localStorage.setItem("testRun_".concat(e,"_").concat(r),a)},jt=function(t){var e=t.spaceId,r=t.workflowId;localStorage.getItem("testRun")&&localStorage.removeItem("testRun"),localStorage.removeItem("testRun_".concat(e,"_").concat(r))},lo=L(67825),hr=L.n(lo),uo=L(46219),co=[i.C8.Start,i.C8.End,i.C8.LoopStart,i.C8.LoopEnd],fo=function(t){var e=t.graph,r=t.changeEdgeConfigWithRefresh,a=t.copyNode,o=t.changeNodeConfigWithRefresh,l=t.removeNode,s=t.modal,u=t.message,c=null,v=0;e.bindKey(["meta+c","ctrl+c"],function(){var f=e.getSelectedCells();if(f.length){var m=f[0];if(m.isNode()){var S=m.getData();if(S.type===i.C8.LoopStart||S.type===i.C8.LoopEnd||S.type===i.C8.Loop||S.type===i.C8.Start||S.type===i.C8.End)return u.warning("\u8BE5\u8282\u70B9\u7C7B\u578B\u4E0D\u652F\u6301\u590D\u5236"),c=null,v=0,!1;c=(0,ke.Xh)(S),v=0,e.copy(f),u.success("\u5DF2\u590D\u5236\u8282\u70B9")}}return!1}),e.bindKey(["meta+v","ctrl+v"],function(){if(c){v++;var f=v*30;a(c,{x:f,y:f})}else if(e.isClipboardEmpty())u.warning("\u8BF7\u5148\u590D\u5236\u4E00\u4E2A\u8282\u70B9");else{var m=e.getSelectedCells();if(m&&m.length>0){var S=m[0].getData();if(S.type===i.C8.LoopStart||S.type===i.C8.LoopEnd||S.type===i.C8.Loop){u.error("\u4E0D\u80FD\u7C98\u8D34\u5FAA\u73AF\u8282\u70B9");return}if(S.type===i.C8.Start){u.error("\u4E0D\u80FD\u7C98\u8D34\u5F00\u59CB\u8282\u70B9");return}if(S.type===i.C8.End){u.error("\u4E0D\u80FD\u7C98\u8D34\u7ED3\u675F\u8282\u70B9");return}a(S)}}return!1});var N=function(m){var S,b,k=m[0],g=(S=k.getTargetNode())===null||S===void 0?void 0:S.id,C=(b=k.getSourceNode())===null||b===void 0?void 0:b.getData(),d=k.getSourcePortId(),y=JSON.parse(JSON.stringify(C));if(C.type===i.C8.Condition){var I=gn()(y.nodeConfig.conditionBranchConfigs),w;try{for(I.s();!(w=I.n()).done;){var A=w.value;d.includes(A.uuid)&&(A.nextNodeIds=A.nextNodeIds.filter(function(Y){return Y!==Number(g)}))}}catch(Y){I.e(Y)}finally{I.f()}}else if(C.type===i.C8.QA)if(y.nodeConfig.answerType===i.J4.SELECT){var D=gn()(y.nodeConfig.options),E;try{for(D.s();!(E=D.n()).done;){var R=E.value;d.includes(R.uuid)&&(R.nextNodeIds=R.nextNodeIds.filter(function(Y){return Y!==Number(g)}))}}catch(Y){D.e(Y)}finally{D.f()}}else{r({type:se.I3.deleted,targetId:g,sourceNode:C,id:"0"}),e.removeCells(m);return}else{var P=gn()(y.nodeConfig.intentConfigs),G;try{for(P.s();!(G=P.n()).done;){var B=G.value;d.includes(B.uuid)&&(B.nextNodeIds=B.nextNodeIds.filter(function(Y){return Y!==Number(g)}))}}catch(Y){P.e(Y)}finally{P.f()}}o({nodeData:y,targetNodeId:g?.toString()})},h=function(m,S){var b,k,g=m.getSourcePortId(),C=(b=m.getSourceNode())===null||b===void 0?void 0:b.getData(),d=(k=m.getTargetNode())===null||k===void 0?void 0:k.getData(),y=ar(m.getSourceNode(),g);if(it(C,y)){var I,w,A=(0,ke.Xh)(C),D=((I=A.nodeConfig)===null||I===void 0?void 0:I.exceptionHandleConfig)||{},E=D.exceptionHandleNodeIds,R=E===void 0?[]:E,P=R.filter(function(B){return B!==Number(d.id)}),G=x()(x()({},((w=A.nodeConfig)===null||w===void 0?void 0:w.exceptionHandleConfig)||{}),{},{exceptionHandleNodeIds:P});return A.nodeConfig.exceptionHandleConfig=G,S(A),!0}return!1};return e.bindKey(["delete","backspace"],function(){var f=e.getSelectedCells();if(f.length){var m=f[0];if(m.isEdge()){var S,b,k,g=(S=m.getSourceNode())===null||S===void 0?void 0:S.getData(),C=(b=m.getTargetNode())===null||b===void 0?void 0:b.getData(),d=(k=m.getTargetNode())===null||k===void 0?void 0:k.id;if(!Ua(g,C)){u.warning("\u4E0D\u80FD\u5220\u9664\u5FAA\u73AF\u8282\u70B9\u8FDE\u7EBF");return}var y=h(m,function(I){e.removeCells([m]),o({nodeData:I,targetNodeId:C.id.toString()})});if(y)return;if(g.type===i.C8.Loop||C.type===i.C8.Loop){if(g.type===i.C8.Loop&&C.loopNodeId&&C.loopNodeId===g.id){g.innerStartNodeId=-1,o({nodeData:g,targetNodeId:d?.toString()}),e.removeCells([m]);return}if(C.type===i.C8.Loop&&g.loopNodeId&&g.loopNodeId===C.id){C.innerEndNodeId=-1,o({nodeData:C,targetNodeId:C.id.toString()}),e.removeCells([m]);return}}g.type===i.C8.Condition||g.type===i.C8.IntentRecognition||g.type===i.C8.QA?N(f):r({type:se.I3.deleted,targetId:d,sourceNode:g,id:"0"})}else{if(co.includes(m.getData().type)){u.warning("\u4E0D\u80FD\u5220\u9664\u5F00\u59CB\u8282\u70B9\u548C\u7ED3\u675F\u8282\u70B9");return}if(m.getData().loopNodeId||m.getData().type===i.C8.Loop){if(m.getData().type===i.C8.Loop){s.confirm({title:"\u786E\u5B9A\u8981\u5220\u9664\u5FAA\u73AF\u8282\u70B9\u5417\uFF1F",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:function(){l(m.id,m.getData()),e.removeCells(f)},onCancel:function(){return!1}});return}l(m.id,m.getData())}else l(m.id)}e.removeCells(f)}return!1}),function(){}},po=fo,vo=L(31759),Mn=L.n(vo),go=L(54231),ho=L(81376),mo=L(61943),Co=L(90541),yo=L(66508),Ft=L(14719),$e=L(41249),Vn=L(63881),mr=L(56769),Ge=L(63619),xo=L(28246),ut=L(43898),No=[{name:"",key:"group1",children:[{name:"\u5927\u6A21\u578B",icon:(0,n.jsx)(oe.EF,{}),bgIcon:oe.G0,type:i.C8.LLM,shape:i.K$.General,description:"\u8C03\u7528\u5927\u8BED\u8A00\u6A21\u578B\uFF0C\u4F7F\u7528\u53D8\u91CF\u548C\u63D0\u793A\u8BCD\u751F\u6210\u56DE\u590D"},{name:"\u63D2\u4EF6",icon:(0,n.jsx)(oe.KS,{}),bgIcon:oe.SU,type:i.C8.Plugin,shape:i.K$.General,description:"\u5FC5\u5E94\u641C\u7D22\u5F15\u64CE\u3002\u5F53\u4F60\u9700\u8981\u641C\u7D22\u4F60\u4E0D\u77E5\u9053\u7684\u4FE1\u606F\uFF0C\u6BD4\u5982\u5929\u6C14..."},{name:"\u5DE5\u4F5C\u6D41",icon:(0,n.jsx)(oe.fl,{}),bgIcon:oe.Ls,type:i.C8.Workflow,shape:i.K$.General,description:"\u5FC5\u5E94\u641C\u7D22\u5F15\u64CE\u3002\u5F53\u4F60\u9700\u8981\u641C\u7D22\u4F60\u4E0D\u77E5\u9053\u7684\u4FE1\u606F\uFF0C\u6BD4\u5982\u5929\u6C14..."},{name:"MCP",icon:(0,n.jsx)(oe.VE,{}),bgIcon:oe.zH,type:i.C8.MCP,shape:i.K$.General,description:"MCP \u7EC4\u4EF6"}]},{name:"\u4E1A\u52A1\u903B\u8F91",key:"group2",children:[{name:"\u4EE3\u7801",icon:(0,n.jsx)(oe.HF,{}),bgIcon:oe.Po,type:i.C8.Code,shape:i.K$.General,description:"\u7F16\u5199\u4EE3\u7801\uFF0C\u5904\u7406\u8F93\u5165\u53D8\u91CF\u6765\u751F\u6210\u8FD4\u56DE\u503C"},{name:"\u6761\u4EF6\u5206\u652F",icon:(0,n.jsx)(oe.ZO,{}),bgIcon:oe.TK,type:i.C8.Condition,shape:i.K$.General,description:"\u8FDE\u63A5\u591A\u4E2A\u4E0B\u6E38\u5206\u652F\uFF0C\u82E5\u8BBE\u5B9A\u7684\u6761\u4EF6\u6210\u7ACB\u5219\u4EC5\u8FD0\u884C\u5BF9\u5E94\u7684\u5206\u652F\uFF0C\u82E5 \u5747\u4E0D\u6210\u7ACB\u5219\u53EA\u8FD0\u884C\u201C\u5426\u5219\u201D\u5206\u652F"},{name:"\u610F\u56FE\u8BC6\u522B",icon:(0,n.jsx)(oe.mT,{}),bgIcon:oe.cp,type:i.C8.IntentRecognition,shape:i.K$.General,description:"\u7528\u4E8E\u7528\u6237\u8F93\u5165\u7684\u610F\u56FE\u8BC6\u522B\uFF0C\u5E76\u5C06\u5176\u4E0E\u9884\u8BBE\u610F\u56FE\u9009\u9879\u8FDB\u884C\u5339\u914D\u3002"},{name:"\u5FAA\u73AF",icon:(0,n.jsx)(oe.ZX,{}),bgIcon:oe.bD,type:i.C8.Loop,shape:i.K$.Loop,description:"\u7528\u4E8E\u901A\u8FC7\u8BBE\u5B9A\u5FAA\u73AF\u6B21\u6570\u548C\u903B\u8F91\uFF0C\u91CD\u590D\u6267\u884C\u4E00\u7CFB\u5217\u4EFB\u52A1\u3002"},{name:"\u7EE7\u7EED\u5FAA\u73AF",icon:(0,n.jsx)(oe.uS,{}),bgIcon:oe.jI,type:i.C8.LoopContinue,shape:i.K$.General,description:""},{name:"\u7EC8\u6B62\u5FAA\u73AF",icon:(0,n.jsx)(oe.QL,{}),bgIcon:oe.J2,type:i.C8.LoopBreak,shape:i.K$.General,description:""}]},{name:"\u77E5\u8BC6&\u6570\u636E",key:"group3",children:[{name:"\u77E5\u8BC6\u5E93",icon:(0,n.jsx)(oe.fF,{}),bgIcon:oe.Lm,type:i.C8.Knowledge,shape:i.K$.General,description:"\u5728\u9009\u5B9A\u7684\u77E5\u8BC6\u4E2D\uFF0C\u6839\u636E\u8F93\u5165\u53D8\u91CF\u53EC\u56DE\u6700\u5339\u914D\u7684\u4FE1\u606F"},{name:"\u53D8\u91CF",icon:(0,n.jsx)(oe.JU,{}),bgIcon:oe.Hl,type:i.C8.Variable,shape:i.K$.General,description:"\u7528\u4E8E\u8BFB\u53D6\u548C\u5199\u5165\u9879\u76EE\u4E2D\u7684\u53D8\u91CF\uFF0C\u53D8\u91CF\u540D\u987B\u4E0E\u9879\u76EE\u4E2D\u7684\u53D8\u91CF\u540D\u76F8\u5339\u914D"},{name:"\u53D8\u91CF\u805A\u5408",icon:(0,n.jsx)(oe.JU,{}),bgIcon:oe.Hl,type:i.C8.VariableAggregation,shape:i.K$.General,description:"\u5C06\u591A\u4E2A\u5206\u652F\u6216\u53D8\u91CF\u805A\u5408\u6210\u5206\u7EC4\u8F93\u51FA"},{name:"\u957F\u671F\u8BB0\u5FC6",icon:(0,n.jsx)(oe.GY,{}),bgIcon:oe.aA,type:i.C8.LongTermMemory,shape:i.K$.General,description:"\u7528\u4E8E\u8C03\u7528\u957F\u671F\u8BB0\u5FC6\uFF0C\u83B7\u53D6\u7528\u6237\u7684\u4E2A\u6027\u5316\u4FE1\u606F"}]},{name:"\u6570\u636E\u8868",key:"group4",children:[{name:"\u6570\u636E\u65B0\u589E",icon:(0,n.jsx)(oe.wN,{}),bgIcon:oe.Te,type:i.C8.TableDataAdd,shape:i.K$.General,description:"\u5BF9\u9009\u5B9A\u7684\u6570\u636E\u8868\u8FDB\u884C\u6570\u636E\u5199\u5165"},{name:"\u6570\u636E\u5220\u9664",icon:(0,n.jsx)(oe.t_,{}),bgIcon:oe.u8,type:i.C8.TableDataDelete,shape:i.K$.General,description:"\u5BF9\u9009\u5B9A\u7684\u6570\u636E\u8868\u6839\u636E\u6307\u5B9AID\u8FDB\u884C\u6570\u636E\u5220\u9664"},{name:"\u6570\u636E\u66F4\u65B0",icon:(0,n.jsx)(oe.Lg,{}),bgIcon:oe.Og,type:i.C8.TableDataUpdate,shape:i.K$.General,description:"\u5BF9\u9009\u5B9A\u7684\u6570\u636E\u8868\u6839\u636E\u6307\u5B9A\u6761\u4EF6\u8FDB\u884C\u6570\u636E\u66F4\u65B0"},{name:"\u6570\u636E\u67E5\u8BE2",icon:(0,n.jsx)(oe.Qe,{}),bgIcon:oe.c7,type:i.C8.TableDataQuery,shape:i.K$.General,description:"\u5BF9\u9009\u5B9A\u7684\u6570\u636E\u8868\u6839\u636E\u6307\u5B9A\u6761\u4EF6\u8FDB\u884C\u6570\u636E\u67E5\u8BE2"},{name:"SQL\u81EA\u5B9A\u4E49",icon:(0,n.jsx)(oe.rX,{}),bgIcon:oe.D9,type:i.C8.TableSQL,shape:i.K$.General,description:"\u53EF\u652F\u6301\u5BF9\u6570\u636E\u8868\u7684\u67E5\u8BE2\u63A7\u5236\uFF0C\u7528\u6237\u53EF\u67E5\u8BE2\u5176\u4ED6\u7528\u6237\u63D0\u4EA4\u7684\u6570\u636E\uFF0C\u7531\u5F00\u53D1\u8005\u63A7\u5236"}]},{name:"\u7EC4\u4EF6&\u5DE5\u5177",key:"group5",children:[{name:"\u95EE\u7B54",icon:(0,n.jsx)(oe.MO,{}),bgIcon:oe.HI,type:i.C8.QA,shape:i.K$.General,description:"\u652F\u6301\u4E2D\u95F4\u5411\u7528\u6237\u63D0\u95EE\u95EE\u9898"},{name:"\u6587\u672C\u5904\u7406",icon:(0,n.jsx)(oe.lR,{}),bgIcon:oe.v$,type:i.C8.TextProcessing,shape:i.K$.General,description:"\u7528\u4E8E\u5904\u7406\u591A\u4E2A\u5B57\u7B26\u4E32\u7C7B\u578B\u53D8\u91CF\u7684\u683C\u5F0F"},{name:"\u6587\u6863\u63D0\u53D6",icon:(0,n.jsx)(oe.zL,{}),bgIcon:oe.AR,type:i.C8.DocumentExtraction,shape:i.K$.General,description:"\u7528\u4E8E\u63D0\u53D6\u6587\u6863\u5185\u5BB9\uFF0C\u652F\u6301\u7684\u6587\u4EF6\u7C7B\u578B: txt\u3001 markdown\u3001pdf\u3001 html\u3001 xlsx\u3001 xls\u3001 docx\u3001 csv\u3001 md\u3001 htm"},{name:"http\u8BF7\u6C42",icon:(0,n.jsx)(oe.qm,{}),bgIcon:oe.L5,type:i.C8.HTTPRequest,shape:i.K$.General,description:"\u7528\u4E8E\u914D\u7F6Ehttp\u8BF7\u6C42\u8C03\u7528\u5DF2\u6709\u7684\u670D\u52A1"}]},{name:"\u8F93\u51FA",key:"group6",children:[{name:"\u8FC7\u7A0B\u8F93\u51FA",icon:(0,n.jsx)(oe.N$,{}),bgIcon:oe.bi,type:i.C8.Output,shape:i.K$.General,description:"\u652F\u6301\u4E2D\u95F4\u8FC7\u7A0B\u7684\u6D88\u606F\u8F93\u51FA\uFF0C\u652F\u6301\u6D41\u5F0F\u548C\u975E\u6D41\u5F0F\u4E24\u79CD\u65B9\u5F0F"}]}],Io=[{label:"String",value:i.Gi.String},{label:"Integer",value:i.Gi.Integer},{label:"Number",value:i.Gi.Number},{label:"File",value:"File",children:[{label:"Default",value:i.Gi.File_Default},{label:"Doc",value:i.Gi.File_Doc},{label:"Excel",value:i.Gi.File_Excel},{label:"PPT",value:i.Gi.File_PPT},{label:"Txt",value:i.Gi.File_Txt},{label:"Image",value:i.Gi.File_Image},{label:"Audio",value:i.Gi.File_Audio},{label:"Video",value:i.Gi.File_Video},{label:"Svg",value:i.Gi.File_Svg},{label:"Code",value:i.Gi.File_Code}]},{label:"Boolean",value:i.Gi.Boolean},{label:"Object",value:i.Gi.Object},{label:"Array<String>",value:i.Gi.Array_String},{label:"Array<Integer>",value:i.Gi.Array_Integer},{label:"Array<Number>",value:i.Gi.Array_Number},{label:"Array<Boolean>",value:i.Gi.Array_Boolean},{label:"Array<Object>",value:i.Gi.Array_Object},{label:"Array<File>",value:"Array_File",children:[{label:"Default",value:i.Gi.Array_File_Default},{label:"Array<Image>",value:i.Gi.Array_File_Image},{label:"Array<Doc>",value:i.Gi.Array_File_Doc},{label:"Array<Code>",value:i.Gi.Array_File_Code},{label:"Array<PPT>",value:i.Gi.Array_File_PPT},{label:"Array<Txt>",value:i.Gi.Array_File_Txt},{label:"Array<Excel>",value:i.Gi.Array_File_Excel},{label:"Array<Audio>",value:i.Gi.Array_File_Audio},{label:"Array<Zip>",value:i.Gi.Array_File_Zip},{label:"Array<Video>",value:i.Gi.Array_File_Video},{label:"Array<Svg>",value:i.Gi.Array_File_Svg}]}],Al=[{label:"\u6807\u9898\u751F\u6210",icon:(0,n.jsx)(oe.nG,{}),key:"\u6807\u9898\u751F\u6210",children:[{key:"output",label:"output",tag:"String"},{key:"setting",label:"Setting",tag:"Number"}]}],Eo=[{label:"\u4F7F\u7528\u6570\u7EC4\u5FAA\u73AF",value:"ARRAY_LOOP"},{label:"\u6307\u5B9A\u6B21\u6570\u5FAA\u73AF",value:"SPECIFY_TIMES_LOOP"},{label:"\u65E0\u9650\u5FAA\u73AF",value:"INFINITE_LOOP"}],Dl=[{name:"name",placeholder:"\u53D8\u91CF\u540D",label:"\u53D8\u91CF\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u53D8\u91CF\u540D"}],component:Ge.Z,width:140},{name:"dataType",placeholder:"\u9009\u62E9\u7C7B\u578B",label:"\u53D8\u91CF\u7C7B\u578B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u53D8\u91CF\u7C7B\u578B"}],component:xo.Z,width:110,options:Io},{name:"description",placeholder:"\u63CF\u8FF0",label:"",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u63CF\u8FF0"}],component:ut.Z,width:0},{name:"require",placeholder:"\u53D8\u91CF\u540D",label:"",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u53D8\u91CF\u540D"}],component:ut.Z,width:0}],ze=[{name:"name",placeholder:"\u53C2\u6570\u540D",label:"\u53C2\u6570\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u53C2\u6570\u540D"}],component:Ge.Z,width:100},{name:"bindValue",placeholder:"\u8F93\u5165\u6216\u5F15\u7528\u53C2\u6570\u503C",label:"\u53C2\u6570\u503C",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u53C2\u6570\u503C"}],component:Vn.Z,width:180},{name:"description",placeholder:"\u63CF\u8FF0",label:"",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u63CF\u8FF0"}],component:ut.Z,width:0}],Tl=[{name:"intent",placeholder:"\u8F93\u5165\u53C2\u6570\u503C",label:"",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u610F\u56FE\u7684\u63CF\u8FF0"}],component:Ge.Z,width:296}],Rl=[{name:"name",placeholder:"\u53C2\u6570\u540D",label:"\u53C2\u6570\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u53C2\u6570\u540D"}],component:Ge.Z,width:140},{name:"paramsValue",placeholder:"\u8F93\u5165\u6216\u5F15\u7528\u53D8\u91CF\u503C",label:"\u53D8\u91CF\u503C",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u53D8\u91CF\u503C"}],component:Vn.Z,width:120}],Ll=[{icon:(0,n.jsx)(mr.Z,{}),name:"\u8D44\u6E90\u5E93\u5DE5\u4F5C\u6D41",key:"resources"},{icon:(0,n.jsx)(mr.Z,{}),name:"\u5B98\u65B9\u793A\u4F8B",key:"example"}],bo=[{label:"\u7B49\u4E8E",value:"EQUAL",displayValue:"="},{label:"\u4E0D\u7B49\u4E8E",value:"NOT_EQUAL",displayValue:"\u2260"},{label:"\u5927\u4E8E",value:"GREATER_THAN",displayValue:">"},{label:"\u5927\u4E8E\u7B49\u4E8E",value:"GREATER_THAN_OR_EQUAL",displayValue:"\u2265"},{label:"\u5C0F\u4E8E",value:"LESS_THAN",displayValue:"<"},{label:"\u5C0F\u4E8E\u7B49\u4E8E",value:"LESS_THAN_OR_EQUAL",displayValue:"\u2264"},{label:"\u957F\u5EA6\u5927\u4E8E",value:"LENGTH_GREATER_THAN",displayValue:">"},{label:"\u957F\u5EA6\u5927\u4E8E\u7B49\u4E8E",value:"LENGTH_GREATER_THAN_OR_EQUAL",displayValue:"\u2265"},{label:"\u957F\u5EA6\u5C0F\u4E8E",value:"LENGTH_LESS_THAN",displayValue:"<"},{label:"\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E",value:"LENGTH_LESS_THAN_OR_EQUAL",displayValue:"\u2264"},{label:"\u5305\u542B",value:"CONTAINS",displayValue:"\u2283"},{label:"\u4E0D\u5305\u542B",value:"NOT_CONTAINS",displayValue:"\u2285"},{label:"\u5339\u914D\u6B63\u5219\u8868\u8FBE\u5F0F",value:"MATCH_REGEX",displayValue:"~"},{label:"\u4E3A\u7A7A",value:"IS_NULL",displayValue:"\u2205"},{label:"\u4E0D\u4E3A\u7A7A",value:"NOT_NULL",displayValue:"!\u2205"}],wo=[{label:"\u7B49\u4E8E",value:"EQUAL",displayValue:"="},{label:"\u4E0D\u7B49\u4E8E",value:"NOT_EQUAL",displayValue:"\u2260"},{label:"\u5927\u4E8E",value:"GREATER_THAN",displayValue:">"},{label:"\u5927\u4E8E\u7B49\u4E8E",value:"GREATER_THAN_OR_EQUAL",displayValue:"\u2265"},{label:"\u5C0F\u4E8E",value:"LESS_THAN",displayValue:"<"},{label:"\u5C0F\u4E8E\u7B49\u4E8E",value:"LESS_THAN_OR_EQUAL",displayValue:"\u2264"},{label:"\u5C5E\u4E8E",value:"IN",displayValue:"\u2283"},{label:"\u4E0D\u5C5E\u4E8E",value:"NOT_IN",displayValue:"\u2285"},{label:"\u4E3A\u7A7A",value:"IS_NULL",displayValue:"\u2205"},{label:"\u4E0D\u4E3A\u7A7A",value:"NOT_NULL",displayValue:"!\u2205"}],So=function(t){return(0,n.jsx)("div",{className:"icon-box-style",style:x()({width:"20px",height:"20px",backgroundSize:"100% 100%",backgroundRepeat:"no-repeat",backgroundPosition:"center"},t&&{backgroundImage:'url("'.concat(t,'")')})})},ko=function(t){var e=t.dragChild,r=t.isLoop,a=r===void 0?!1:r,o=function(s,u){e(s,u)};return(0,n.jsxs)("div",{className:"stencil-content",children:[(0,n.jsx)("p",{className:"stencil-title",children:"\u8282\u70B9\u9009\u62E9"}),(0,n.jsx)("div",{className:"stencil-list-style",children:No.map(function(l){return(0,n.jsxs)("div",{className:"stencil-list-item",children:[l.name&&(0,n.jsx)("p",{className:"stencil-list-title",children:l.name}),(0,n.jsx)("div",{className:"stencil-list-content",children:l.children.filter(function(s){return a?s.type!==i.C8.Loop:!0}).map(function(s){var u=[i.C8.LoopBreak,i.C8.LoopContinue].includes(s?.type||""),c=u?a:!0;return c&&(0,n.jsxs)("div",{className:"child-content dis-left",draggable:"true",onDragEnd:function(N){return o(s,N)},onClick:function(){return o(s)},children:[So(s.bgIcon||""),(0,n.jsx)("span",{children:s.name})]},s.type)})})]},l.name)})})]})},Cr=ko,yr=L(41519),xr=L(45564),Nr=L(35477),He=L(12758),Ir=L(83677),Er=L(4692),jo=L(75434),br=L(13143),Fo=L(84896),Ke=L(17701),Ao=L(94581),We=L.n(Ao),Fe={"xagi-nav-style2":"xagi-nav-style2___w54uP",text:"text___P6loo","page-container":"page-container___C1ukr",runResultContainer:"runResultContainer___hEw_J",runResultHeader:"runResultHeader___rXfpV",runResultStatus:"runResultStatus___zBgfc",statusIcon:"statusIcon___Fanub",success:"success___N5dYP",error:"error___Rvi1E",statusText:"statusText___ZLRB6",runTime:"runTime___cwOAx",collapseIcon:"collapseIcon___Glhqv",runResultBody:"runResultBody___XlJY0",runResultInfo:"runResultInfo___HQFRe",totalCount:"totalCount___mofBr",runResultPagination:"runResultPagination___EnXnz",runResultPaginationPages:"runResultPaginationPages___SoUTs",runResultPageItem:"runResultPageItem___QnstN",active:"active___n1Wp2",runResultPageSelect:"runResultPageSelect___H7VhE",selectArrow:"selectArrow___vdZdT",onlyErrorCheckbox:"onlyErrorCheckbox___Iny2u",runResultBatch:"runResultBatch____fO20",runResultBatchHeader:"runResultBatchHeader___oczi6",runResultBatchContent:"runResultBatchContent___TX8lS",runResultSection:"runResultSection___Rgalf",runResultSectionHeader:"runResultSectionHeader___yCEmT",runResultSectionContent:"runResultSectionContent___BGBaX",keyValueItem:"keyValueItem___ldPI9",key:"key___BX_UA",value:"value___bOb5e",runResultPageSelectRoot:"runResultPageSelectRoot___CrDPG"},Le=We().bind(Fe),wr=5,Do=function(t){var e=t.success,r=e===void 0?!0:e,a=t.loading,o=a===void 0?!1:a,l=t.time,s=l===void 0?"0.001s":l,u=t.total,c=u===void 0?10:u,v=t.current,N=v===void 0?1:v,h=t.onlyError,f=h===void 0?!1:h,m=t.onPageChange,S=t.onOnlyErrorChange,b=t.batchVariables,k=b===void 0?{}:b,g=t.inputParams,C=g===void 0?{}:g,d=t.outputResult,y=d===void 0?{}:d,I=t.collapsible,w=I===void 0?!0:I,A=t.expanded,D=A===void 0?!1:A,E=t.title,R=E===void 0?"":E,P=t.onExpandChange,G=(0,j.useRef)(null),B=(0,j.useState)(!D),Y=me()(B,2),le=Y[0],re=Y[1],Q=function(){var ne=!le;re(ne),P?.(!ne)},O=function(ne){m?.(ne)},U=function(ne){S?.(ne.target.checked)},Z=function(){for(var ne=[],K=Math.min(wr,c),z=function(F){ne.push((0,n.jsx)("span",{className:Le(Fe.runResultPageItem,pe()({},Fe.active,N===F)),onClick:function(){return O(F)},children:F},F))},W=1;W<=K;W++)z(W);return(0,n.jsxs)("div",{className:Le(Fe.runResultPagination),children:[(0,n.jsx)("div",{className:Le(Fe.runResultPaginationPages),children:ne}),(0,n.jsx)("div",{className:Le(Fe.runResultPageSelect),children:c>wr&&(0,n.jsx)(Ke.default,{value:N,onChange:O,options:Array.from({length:c},function(M,F){return{value:F+1,label:F+1}}),listHeight:100,className:Fe.runResultPageSelectRoot,size:"small",getPopupContainer:function(){return G.current}})})]})},ae=function(ne,K){return(0,n.jsxs)("div",{className:Le(Fe.runResultSection),children:[(0,n.jsxs)("div",{className:Le(Fe.runResultSectionHeader),children:[(0,n.jsx)("span",{children:K}),(0,n.jsx)(Ir.Z,{data:ne,jsonSpace:2,tooltipTitle:"\u590D\u5236"})]}),(0,n.jsx)("div",{className:Le(Fe.runResultSectionContent,"overflow-y"),children:(0,n.jsx)("code",{children:JSON.stringify(ne,null,2)})})]})};return(0,n.jsxs)("div",{ref:G,className:Le(Fe.runResultContainer),onClick:function(ne){ne.stopPropagation()},children:[(0,n.jsxs)("div",{className:Le(Fe.runResultHeader),children:[(0,n.jsxs)("div",{className:Le(Fe.runResultStatus),children:[o?(0,n.jsx)(Et.Z,{className:Le(Fe.statusIcon)}):r?(0,n.jsx)(Er.Z,{className:Le(Fe.statusIcon,Fe.success)}):(0,n.jsx)(jo.Z,{className:Le(Fe.statusIcon,Fe.error)}),(0,n.jsx)("span",{className:Le(Fe.statusText),children:R||(o?"\u8FD0\u884C\u4E2D":r?"\u8FD0\u884C\u6210\u529F":"\u8FD0\u884C\u5931\u8D25")}),!o&&(0,n.jsx)("span",{className:Le(Fe.runTime),children:s})]}),w&&(0,n.jsx)("div",{className:Le(Fe.collapseIcon),onClick:Q,children:le?(0,n.jsx)(br.Z,{}):(0,n.jsx)(Fo.Z,{})})]}),!le&&(0,n.jsxs)("div",{className:Le(Fe.runResultBody),children:[(0,n.jsxs)("div",{className:Le(Fe.runResultInfo),children:[(0,n.jsxs)("div",{className:Le(Fe.totalCount),children:["\u603B\u6570: ",c]}),c>1&&!r&&(0,n.jsx)("div",{className:Le(Fe.onlyErrorCheckbox),children:(0,n.jsx)(ut.Z,{checked:f,onChange:U,children:"\u53EA\u770B\u9519\u8BEF"})})]}),c>1&&Z()||null,Object.keys(k).length>0&&(0,n.jsxs)("div",{className:Le(Fe.runResultBatch),children:[(0,n.jsxs)("div",{className:Le(Fe.runResultBatchHeader),children:[(0,n.jsx)("span",{children:"\u672C\u6B21\u6279\u5904\u7406\u53D8\u91CF"}),(0,n.jsx)(Ir.Z,{data:k,jsonSpace:2,tooltipTitle:"\u590D\u5236"})]}),(0,n.jsx)("div",{className:Le(Fe.runResultSectionContent,"overflow-y"),children:(0,n.jsx)("pre",{children:JSON.stringify(k,null,2)})})]}),ae(C,"\u8F93\u5165"),ae(y,"\u8F93\u51FA")]})]})},To=Do,Ro=function(t){var e=t.data,r=e.nodeConfig.conditionBranchConfigs;return(0,n.jsx)("div",{className:"condition-node-content-style",children:r?.map(function(a){var o,l,s,u,c=a.conditionArgs?(o=a.conditionArgs[0])===null||o===void 0||(o=o.firstArg)===null||o===void 0?void 0:o.name:"",v=((l=a.conditionArgs[0])===null||l===void 0||(l=l.secondArg)===null||l===void 0?void 0:l.name)||((s=a.conditionArgs[0])===null||s===void 0||(s=s.secondArg)===null||s===void 0?void 0:s.bindValue)||"";return(0,n.jsxs)("div",{className:"dis-left condition-item-style",children:[(0,n.jsx)("span",{className:"condition-title-sytle",children:er[a.branchType||se.F0.ELSE_IF]}),(0,n.jsx)("div",{className:"flex-1 condition-node-left-input",children:c}),a.conditionArgs&&a.conditionArgs.length>0&&(0,n.jsxs)("div",{className:"dis-left",children:[(0,n.jsx)("span",{className:"condition-node-compare-type",children:(u=a.conditionArgs[0])!==null&&u!==void 0&&u.compareType?ya[a.conditionArgs[0].compareType]:""}),(0,n.jsx)("div",{className:"condition-node-right-input",children:v})]})]},a.uuid)})})},Lo=function(t){var e,r=t.data,a=r.nodeConfig.inputArgs,o=r.nodeConfig.question,l=r.nodeConfig.answerType;return(0,n.jsxs)("div",{className:"qa-node-content-style",children:[(0,n.jsxs)("div",{className:"dis-left",children:[(0,n.jsx)("span",{className:"text-right qa-title-style",children:"\u8F93\u5165"}),a?.slice(0,2).map(function(s,u){return(0,n.jsx)(He.Z,{children:s.name},"inputArgs-".concat(s.name,"-").concat(u))}),a&&a.length>2&&(0,n.jsxs)(He.Z,{children:["+",a.length-2]}),!a&&(0,n.jsx)("span",{children:"\u672A\u914D\u7F6E\u8F93\u5165\u5185\u5BB9"})]}),(0,n.jsxs)("div",{className:"dis-left",children:[(0,n.jsx)("span",{className:"text-right qa-title-style",children:"\u63D0\u95EE\u5185\u5BB9"}),(0,n.jsx)("span",{className:"question-content-style",children:o||"\u672A\u914D\u7F6E\u63D0\u95EE\u5185\u5BB9"})]}),(0,n.jsxs)("div",{className:"dis-left",children:[(0,n.jsx)("span",{className:"text-right qa-title-style",children:"\u95EE\u7B54\u7C7B\u578B"}),(0,n.jsx)("span",{children:xa[l]})]}),l===i.J4.SELECT&&((e=r.nodeConfig.options)===null||e===void 0?void 0:e.map(function(s,u){return(0,n.jsxs)("div",{className:"dis-left",children:[(0,n.jsx)("span",{className:"text-right qa-title-style"}),(0,n.jsx)(He.Z,{children:et[u]}),(0,n.jsx)("span",{className:"qa-content-style",children:s.content||"\u672A\u914D\u7F6E\u5185\u5BB9"})]},"options-".concat(s.uuid||et[u],"-").concat(u))}))]})},Po=function(t){var e=t.data,r=e.nodeConfig.intentConfigs;return(0,n.jsx)("div",{className:"qa-node-content-style",children:r?.map(function(a,o){return(0,n.jsxs)("div",{className:"dis-left",children:[(0,n.jsxs)("span",{className:"qa-title-style",children:["\u9009\u9879",o+1]}),(0,n.jsx)("span",{className:"qa-content-style",children:a.intent||"\u672A\u914D\u7F6E\u610F\u56FE"})]},o)})})},Vo=[i.C8.LoopStart,i.C8.LoopEnd,i.C8.Start,i.C8.End],Sr=function(t){var e,r,a=t.data,o=((a?.reduce(function(re,Q){var O,U;return re+(((Q==null||(O=Q.options)===null||O===void 0?void 0:O.endTime)||0)-((Q==null||(U=Q.options)===null||U===void 0?void 0:U.startTime)||0))},0)||0)/1e3).toFixed(3),l=a?.length||0,s=(0,j.useState)(l),u=me()(s,2),c=u[0],v=u[1],N=(0,j.useState)(1),h=me()(N,2),f=h[0],m=h[1],S=(0,j.useState)(!1),b=me()(S,2),k=b[0],g=b[1],C=(0,j.useState)(!1),d=me()(C,2),y=d[0],I=d[1],w=(0,j.useState)([]),A=me()(w,2),D=A[0],E=A[1],R=a.every(function(re){return re?.status===i.Ss.FINISHED}),P=a.some(function(re){return re?.status===i.Ss.EXECUTING||re?.status===i.Ss.STOP_WAIT_ANSWER}),G=function(Q){console.log("\u9875\u7801\u53D8\u5316\uFF1A",Q),m(Q)},B=function(Q){console.log("\u53EA\u770B\u9519\u8BEF\u53D8\u5316\uFF1A",Q),g(Q)},Y=function(Q){console.log("\u5C55\u5F00/\u6536\u8D77\u53D8\u5316\uFF1A",Q),I(Q)};(0,j.useEffect)(function(){E(a)},[a]),(0,j.useEffect)(function(){if(k&&!R){var re=a.filter(function(Q){return Q?.status===i.Ss.FAILED});E(re.length>0?re:[])}else E(a)},[k,R]),(0,j.useEffect)(function(){v(D.length),m(1)},[D]);var le=(0,j.useCallback)(function(){var re=a.map(function(Q){return Q?.status});switch(!0){case re.some(function(Q){return Q===i.Ss.STOP_WAIT_ANSWER}):return"\u8BF7\u7B54\u590D\u95EE\u9898";case re.some(function(Q){return Q===i.Ss.EXECUTING}):return"\u8FD0\u884C\u4E2D";case re.some(function(Q){return Q===i.Ss.FAILED}):return"\u8FD0\u884C\u5931\u8D25";case re.every(function(Q){return Q===i.Ss.FINISHED}):return"\u8FD0\u884C\u6210\u529F";default:return"\u8FD0\u884C\u5931\u8D25"}},[a]);return a?.length===0?null:(0,n.jsx)(To,{success:R,title:le(),loading:P,collapsible:!P,time:"".concat(o,"s"),total:c,current:f,onlyError:k,onPageChange:G,onOnlyErrorChange:B,expanded:y,onExpandChange:Y,inputParams:((e=D[f-1])===null||e===void 0||(e=e.options)===null||e===void 0?void 0:e.input)||{},outputResult:((r=D[f-1])===null||r===void 0||(r=r.options)===null||r===void 0?void 0:r.data)||{}})},Bo=function(t){var e,r=t.data;return(0,n.jsxs)("div",{className:"exception-handle-style",children:[(0,n.jsx)("span",{className:"exception-handle-title",children:"\u5F02\u5E38\u65F6"}),(0,n.jsx)("p",{className:"exception-handle-content",children:(e=nr.find(function(a){return a.value===r?.exceptionHandleType}))===null||e===void 0?void 0:e.label})]})},Zo=function(t){var e=t.node,r=t.graph,a=e.getData(),o=(0,xr.Z)({graph:r,nodeId:a?.id}),l=(0,j.useState)(a?.name||""),s=me()(l,2),u=s[0],c=s[1];if((0,j.useEffect)(function(){c(a?.name||"")},[a?.name]),!a)return null;var v="linear-gradient(to bottom, ".concat(kt(a.type)," 0%, white 100%)"),N=[i.C8.QA,i.C8.Condition,i.C8.IntentRecognition].includes(a.type),h=N?"10px":"0",f=function(d){e.setData({enableMove:!d})},m=function(d){return c(d),r.trigger("node:custom:save",{data:e.getData(),payload:{name:d}}),!0},S=Vo.includes(a.type),b=a.runResults||[],k=[i.C8.LoopStart,i.C8.LoopEnd].includes(a.type)?!1:!!b.length,g=ot(a);return a?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"general-node ".concat(o?"selected-general-node":""),children:[(0,n.jsxs)("div",{className:"general-node-header",style:{background:v,marginBottom:h},children:[(0,n.jsx)("div",{className:"dis-left general-node-header-image",children:st(a.type)}),(0,n.jsx)(yr.Z,{dataId:a.id.toString(),value:u,onSave:m,disabled:S,onEditingStatusChange:f},a.id.toString())]}),a.type===i.C8.Condition&&(0,n.jsx)(Ro,{data:a}),a.type===i.C8.QA&&(0,n.jsx)(Lo,{data:a}),a.type===i.C8.IntentRecognition&&(0,n.jsx)(Po,{data:a}),g&&(0,n.jsx)(Bo,{data:a.nodeConfig.exceptionHandleConfig})]}),k&&(0,n.jsx)(Sr,{data:b})]}):null},Oo=function(t){var e=t.node,r=t.graph,a=e.getData(),o=(0,j.useState)(a?.name||""),l=me()(o,2),s=l[0],u=l[1],c=(0,xr.Z)({graph:r,nodeId:a?.id}),v="linear-gradient(to bottom, ".concat(kt(a.type)," 0%, white 42px)");(0,j.useEffect)(function(){u(a?.name||"")},[a?.name]);var N=function(b){e.setData({enableMove:!b})},h=function(b){return u(b),r.trigger("node:custom:save",{data:e.getData(),payload:{name:b}}),!0},f=a.runResults||[],m=!!f.length;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"loop-node-style general-node ".concat(c?"selected-general-node":""),style:{background:v},children:[(0,n.jsxs)("div",{className:"loop-node-title-style dis-left",children:[(0,n.jsx)(oe.ZX,{style:{marginRight:"6px"}}),(0,n.jsx)(yr.Z,{value:s,dataId:a.id.toString(),onEditingStatusChange:N,onSave:h},a.id.toString())]}),(0,n.jsx)("div",{className:"loop-node-content"})]}),m&&(0,n.jsx)(Sr,{data:f})]})};function Go(){(0,Nr.z2)({shape:i.K$.General,component:Zo}),(0,Nr.z2)({shape:i.K$.Loop,component:Oo,resizable:!0,draggable:!0})}var Wo=function(t,e){var r=2,a=2,o=Math.abs(e.x-t.x),l=Math.floor(o/3*2),s=t.x<e.x?t.x+r:t.x-r,u=e.x>t.x?e.x-a:e.x+a,c=t.y,v=e.y,N={x:s+l,y:c},h={x:u-l,y:v};return En.y$.normalize("M ".concat(s," ").concat(c,`
     L `).concat(s+(t.x<e.x?r:-r)," ").concat(c,`
     C `).concat(N.x," ").concat(N.y," ").concat(h.x," ").concat(h.y," ").concat(u," ").concat(v,`
     L `).concat(u," ").concat(v,`
    `))},kr=!0,jr=!1,Fr=function(t){kr=t},mn=function(t){jr=t},Mo=function(t){var e=t.containerId,r=t.changeDrawer,a=t.changeCondition,o=t.changeEdgeConfigWithRefresh,l=t.changeNodeConfigWithRefresh,s=t.changeZoom,u=t.createNodeByPortOrEdge,c=t.onSaveNode,v=t.onClickBlank,N=document.getElementById(e);if(!N)throw new Error("Container not found");En.kJ.registerConnector("curveConnector",Wo,!0),En.kS.config({markup:[{tagName:"path",selector:"wrap"},{tagName:"path",selector:"line"}],connector:{name:"curveConnector"},attrs:{wrap:{connection:!0,strokeWidth:10,strokeLinejoin:"round",cursor:"pointer",pointerEvents:"none"},line:{connection:!0,strokeWidth:1,pointerEvents:"none",targetMarker:{name:"classic",size:6}}}});var h=function(d,y,I,w,A,D){var E=y.target.getBoundingClientRect(),R=E.left+E.width/2,P=E.top+E.height/2,G=d.clientToLocal({x:R,y:P}),B=function(Q){u({child:Q,sourceNode:I,portId:w,position:G,targetNode:A,edgeId:D})},Y=!!(I!=null&&I.loopNodeId||I?.type===i.C8.Loop),le=(0,n.jsx)("div",{className:"confirm-popover",children:(0,n.jsx)(Cr,{dragChild:function(Q){B(Q),Ft.Z.destroyAll()},isLoop:Y})});Ft.Z.confirm({content:le,footer:null,icon:null,width:260,maskClosable:!0,getContainer:function(){return document.body},style:{position:"fixed",left:R}})},f=new En.kJ({container:N,grid:{visible:!0,type:"dot",size:22,args:{color:"#606060",thickness:1}},autoResize:!0,panning:!0,mousewheel:{enabled:!0,zoomAtMousePosition:!0,minScale:.2,maxScale:3,modifiers:["ctrl","meta"]},background:{color:"#f2f2f2"},connecting:{router:"manhattan",connector:"curveConnector",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,allowNode:!1,allowLoop:!1,allowEdge:!1,highlight:!0,snap:{radius:22,anchor:"bbox"},createEdge:function(){return new En.bn.kS({attrs:{line:{strokeDasharray:"5 5",strokeWidth:1,targetMarker:null,zIndex:1,style:{animation:"ant-line 30s infinite linear"}}}})},validateConnection:function(d){var y=d.sourceMagnet,I=d.targetMagnet,w=d.sourceCell,A=d.targetCell;if(!y||!I||!w||!A||w===A)return!1;var D=I.closest(".x6-port-body"),E=y.getAttribute("port-group")||"",R=D.getAttribute("port-group")||"",P=y.getAttribute("port"),G=D.getAttribute("port");if(!P||!G)return!1;var B=f.getEdges(),Y=B.some(function(O){var U=O.getSource(),Z=O.getTarget();return Mn()(U)==="object"&&"cell"in U&&"port"in U&&Mn()(Z)==="object"&&"cell"in Z&&"port"in Z?U.cell===w.id&&U.port===P&&Z.cell===A.id&&Z.port===G:!1});if(Y)return!1;var le=A.getData(),re=w.getData();if(re.type===i.C8.LoopBreak&&le.type!==i.C8.LoopEnd)return!1;var Q=function(U){var Z;return((Z=U.getData())===null||Z===void 0?void 0:Z.type)==="Loop"};return!Q(w)&&!Q(A)?(E===se.TG.out||E===se.TG.special||E===se.TG.exception)&&R===se.TG.in:(Q(w)||Q(A),!0)}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5147FF",stroke:"#5147FF"}}}},embedding:{enabled:!1},interacting:{nodeMovable:function(d){var y=d.cell,I=y.getData(),w=I.enableMove;return w}}}),m=function(){f.getNodes().forEach(function(d){var y=d.getPorts(),I=y.map(function(w){return x()(x()({},w),{},{attrs:x()(x()({},w.attrs),{},{circle:{r:3},pointerEvents:"all",event:"mouseenter"})})});d.prop("ports/items",I)})},S=function(d){var y=f.getNodes();y.forEach(function(D){D.prop("zIndex",4)});var I=y.filter(function(D){var E=D.getData();return E.type==="Loop"});if(I.forEach(function(D){D.prop("zIndex",5);var E=D.getChildren();E?.forEach(function(R){R.prop("zIndex",8)})}),d){var w=d.getData();if(w.type==="Loop"){var A=d.getChildren();A?.forEach(function(D){D.isEdge()?D.prop("zIndex",15):D.prop("zIndex",20)}),d.prop("zIndex",10)}else d.prop("zIndex",99)}};f.use(new yo.H({sharp:!0,clean:100})).use(new mo.N).use(new go.T).use(new ho.A({enabled:!0,beforeAddCommand:function(d,y){var I,w;return!(kr||jr||y.key==="ports"||y.key==="ports/items"||y.key==="zIndex"||y.key==="tools"||(I=y.key)!==null&&I!==void 0&&I.startsWith("attrs/line")||(w=y.key)!==null&&w!==void 0&&w.startsWith("attrs"))}})).use(new Co.Y({enabled:!0,multiple:!1,rubberband:!1,showNodeSelectionBox:!1,showEdgeSelectionBox:!1,pointerEvents:"none"}));var b=function(d){var y,I,w,A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"active",D=arguments.length>2?arguments[2]:void 0,E=x()(x()({},d),{},{attrs:x()(x()({},d.attrs),{},{circle:x()(x()({},((y=d.attrs)===null||y===void 0?void 0:y.circle)||{}),{},{stroke:D||"#5147FF",fill:D||"#5147FF"})})}),R={normal:x()(x()({},E),{},{attrs:x()(x()({},E.attrs),{},{circle:x()(x()({},E.attrs.circle),{},{r:3}),icon:x()(x()({},((I=d.attrs)===null||I===void 0?void 0:I.icon)||{}),{},{width:0,height:0,opacity:0}),hoverCircle:{pointerEvents:"visiblePainted"}})}),active:x()(x()({},E),{},{attrs:x()(x()({},E.attrs),{},{circle:x()(x()({},E.attrs.circle),{},{r:8}),icon:x()(x()({},((w=d.attrs)===null||w===void 0?void 0:w.icon)||{}),{},{width:10,height:10,x:-5,y:-5,opacity:1}),hoverCircle:{pointerEvents:"none"}})})};return R[A]};f.on("node:mouseenter",function(C){var d,y,I=C.node,w=I.getPorts(),A={in:"active",out:"active"};((d=I.getData())===null||d===void 0?void 0:d.type)==="LoopStart"&&(A.in="normal"),((y=I.getData())===null||y===void 0?void 0:y.type)==="LoopEnd"&&(A.out="normal");var D=w.map(function(E){var R,P=b(E,A[E.group||"in"],(R=E.attrs)===null||R===void 0||(R=R.circle)===null||R===void 0?void 0:R.fill);return P});I.prop("ports/items",D)}),f.on("node:mouseleave",function(C){var d=C.node,y=d.getPorts(),I=y.map(function(w){var A;return b(w,"normal",(A=w.attrs)===null||A===void 0||(A=A.circle)===null||A===void 0?void 0:A.fill)});d.prop("ports/items",I)}),f.on("node:port:click",function(C){var d,y=C.node,I=C.port,w=C.e,A=(d=y.getData())===null||d===void 0?void 0:d.loopNodeId;if(A){var D,E,R,P=I?.includes("in"),G=(D=y.getParent())===null||D===void 0?void 0:D.getData(),B=((E=y.getData())===null||E===void 0?void 0:E.id)===G.innerStartNodeId,Y=((R=y.getData())===null||R===void 0?void 0:R.id)===G.innerEndNodeId;if(B&&P||Y&&!P){$e.ZP.warning("\u5FAA\u73AF\u8282\u70B9\u7684\u5F00\u59CB\u548C\u7ED3\u675F\u8282\u70B9\u4E0D\u80FD\u5FEB\u6377\u6DFB\u52A0\u5176\u4ED6\u8282\u70B9");return}}h(f,w,y.getData(),I),f.select(y)}),f.on("edge:mouseenter",function(C){var d,y,I=C.edge,w=(d=I.getSourceCell())===null||d===void 0?void 0:d.getData(),A=(y=I.getTargetCell())===null||y===void 0?void 0:y.getData();w.type==="Loop"&&A.loopNodeId||w.loopNodeId&&A?.type==="Loop"||I.addTools([{name:"button",args:{markup:[{tagName:"circle",selector:"button",attrs:{r:8,stroke:"#5147FF",strokeWidth:1,fill:"#5147FF",cursor:"pointer"}},{tagName:"image",selector:"icon",attrs:{href:tr.Z,width:10,height:10,x:-5,y:-5,pointerEvents:"none"}}],distance:"50%",offset:{x:0,y:0},onClick:function(E){var R,P,G=E.e,B=(R=I.getSourceCell())===null||R===void 0?void 0:R.getData(),Y=(P=I.getTargetCell())===null||P===void 0?void 0:P.getData(),le=I.getSourcePortId();!B||!Y||(h(f,G,B,le,Y,I.id),v?.(),f.cleanSelection())}}}])}),f.on("edge:mouseleave",function(C){var d=C.edge;d.removeTools()}),f.on("node:moved",function(C){var d,y=C.node,I=C.e;I.stopPropagation();var w=y.getPosition(),A=w.x,D=w.y,E=y.getData(),R=((d=E.nodeConfig)===null||d===void 0?void 0:d.extension)||{};y.updateData({nodeConfig:x()(x()({},E.nodeConfig),{},{extension:x()(x()({},R),{},{x:A,y:D})})});var P=y.getData();if(E.loopNodeId){var G=f.getCellById(E.loopNodeId),B=G.getPosition(),Y=G.getChildren();if(Y&&Y.length){var le=gn()(Y),re;try{for(le.s();!(re=le.n()).done;){var Q=re.value;if(Q.isNode()){var O=Q.getData();O.id===E.id&&(O.nodeConfig.extension.x=A,O.nodeConfig.extension.y=D,a({nodeData:O,update:se.Yi.moved}))}}}catch(M){le.e(M)}finally{le.f()}}var U=G.getSize(),Z=G.getData();Z&&(Z.nodeConfig.extension.width=U.width,Z.nodeConfig.extension.height=U.height,Z.nodeConfig.extension.x=B.x,Z.nodeConfig.extension.y=B.y,Y&&Y.length&&(Z.innerNodes=Y.filter(function(M){return M?.isNode()}).map(function(M){return M.getData()})),a({nodeData:Z,update:se.Yi.moved}));return}if(P.type===i.C8.Loop){var ae=y.getChildren(),V=P.innerNodes||[];if(ae&&ae.length){var ne=gn()(ae),K;try{var z=function(){var F=K.value;if(F.isNode()){var T=F.getPosition(),H=F.getData();if(H.nodeConfig.extension.x=T.x,H.nodeConfig.extension.y=T.y,!V.find(function(de){return de.id===H.id}))V.push(H);else{var q=V.findIndex(function(de){return de.id===H.id});V[q]=H}}};for(ne.s();!(K=ne.n()).done;)z()}catch(M){ne.e(M)}finally{ne.f()}}E.innerNodes=V,E.nodeConfig.extension.x=A,E.nodeConfig.extension.y=D;var W=y.getSize();E.nodeConfig.extension.width=W.width,E.nodeConfig.extension.height=W.height,a({nodeData:P,update:se.Yi.moved});return}a({nodeData:P,update:se.Yi.moved}),S(y)}),f.on("node:mouseleave",function(){m()}),f.on("edge:removed",function(){m(),Gn(f)}),f.on("blank:click",function(){var C=f.getSelectedCells();f.unselect(C),f.cleanSelection(),v?.()}),f.on("edge:click",function(C){var d=C.edge;d.attr("line/stroke","#37D0FF"),v?.()}),f.on("edge:unselected",function(C){var d=C.edge;d.attr("line/stroke","#5147FF")}),f.on("node:custom:save",function(C){var d=C.data,y=C.payload;c(d,y)}),f.on("node:selected",function(C){var d=C.node;S(d);var y=d.getData();if(!y.isFocus){var I=x()(x()({},y),{},{id:d.id});r(I)}}),f.on("node:mousedown",function(C){var d=C.node,y=d.getData();y.isFocus&&(d.updateData({isFocus:!1}),f.cleanSelection()),f.select(d)});var k=function(d,y){var I,w,A=d.getSourcePortId(),D=(I=d.getSourceNode())===null||I===void 0?void 0:I.getData(),E=(w=d.getTargetNode())===null||w===void 0?void 0:w.getData(),R=ar(d.getSourceNode(),A);if(it(D,R)){var P,G,B=(0,ke.Xh)(D),Y=((P=B.nodeConfig)===null||P===void 0?void 0:P.exceptionHandleConfig)||{},le=Y.exceptionHandleNodeIds,re=le===void 0?[]:le;if(re.includes(E.id))return!0;re.push(E.id);var Q=x()(x()({},((G=B.nodeConfig)===null||G===void 0?void 0:G.exceptionHandleConfig)||{}),{},{exceptionHandleNodeIds:re});return B.nodeConfig.exceptionHandleConfig=Q,y(B),!0}return!1};f.on("edge:mousedown",function(){f.cleanSelection(),v?.()}),f.on("edge:connected",function(C){var d,y,I=C.isNew,w=C.edge;if(m(),w.setRouter("manhattan"),!!I){var A=f.getEdges(),D=w.getTargetCellId(),E=w.getSourcePortId(),R=w.getTargetPortId(),P=(d=w.getSourceNode())===null||d===void 0?void 0:d.getData(),G=(y=w.getTargetNode())===null||y===void 0?void 0:y.getData();if(!(!P||!G||!E||!R)){var B=Wa(w,A);if(B!==!1){w.remove(),B&&typeof B=="string"&&$e.ZP.warning(B);return}var Y=k(w,function(Q){l({nodeData:Q,targetNodeId:G.id.toString()}),f.addEdge(w),rt(w),w.toFront(),Gn(f)});if(!Y){if(P.type==="Loop"||G.type==="Loop"){console.log(E);var le=Va(P,G);if(le&&typeof le!="string"){l({nodeData:le,targetNodeId:G.id.toString()}),f.addEdge(w),rt(w),w.toFront();return}}if(P.type===i.C8.Condition||P.type===i.C8.IntentRecognition||P.type===i.C8.QA&&P.nodeConfig.answerType===i.J4.SELECT){var re=Ba(P,G,E);l({nodeData:re,targetNodeId:G.id.toString()})}else o({type:se.I3.created,targetId:D,sourceNode:P,id:w.id});f.addEdge(w),rt(w),setTimeout(function(){P.loopNodeId||G.loopNodeId?w.prop("zIndex",15):w.prop("zIndex",1),Gn(f)},0)}}}}),f.on("scale",function(C){var d=C.sx;s(d)});var g=function(){setTimeout(function(){f.disableHistory();try{f.getEdges().forEach(function(d){rt(d)}),Gn(f),f.getNodes().forEach(function(d){var y=d.getData();if(y&&ir(y)){var I=bn(y);d.prop("ports",I)}})}finally{f.enableHistory()}},0)};return f.on("history:undo",g),f.on("history:redo",g),f.on("node:change:size",function(C){var d=C.node,y=d.getChildren();y&&y.length&&d.prop("originSize",d.getSize())}),f.on("node:change:position",function(C){var d,y=C.node;y.getData().type!=="Loop"&&y.toFront();var I=y.getParent(),w=y.getData();if(!I&&w.loopNodeId){var A=f.getCellById(w.loopNodeId);A&&A.isNode()&&(I=A,I instanceof En.NB&&On(I))}I&&I.isNode()&&((d=I.getData())===null||d===void 0?void 0:d.type)==="Loop"&&On(I)}),Xa({graph:f,changeZIndex:S}),f},Ho=Mo,Ar=860,Dr=240,Uo=40,$o=600,zo=98,Xo=["nodeConfig"],At="graph-container",Qo=(0,j.forwardRef)(function(p,t){var e=p.graphParams,r=p.changeDrawer,a=p.changeEdge,o=p.changeCondition,l=p.copyNode,s=p.removeNode,u=p.changeZoom,c=p.createNodeByPortOrEdge,v=p.onSaveNode,N=p.onClickBlank,h=p.onInit,f=p.onRefresh,m=uo.Z.useApp(),S=m.modal,b=m.message;Go();var k=(0,j.useRef)(null),g=(0,j.useRef)(null),C=(0,j.useRef)(!1);function d(){var K=k.current;if(K){var z=document.createElement("div");z.id=At,K?.appendChild(z)}}var y=function(z){var W=g.current.getNodes().filter(function(M){var F=M.getData();return z(F)});return W.length&&W.forEach(function(M){var F;M.prop("zIndex",4);var T=M.getData();if((F=T.innerNodes)!==null&&F!==void 0&&F.length){var H=M.getPosition();T.innerNodes.forEach(function(q){var de,ce=x()(x()({},q),{},{nodeConfig:x()(x()({},q.nodeConfig),{},{extension:x()(x()({},(de=q.nodeConfig)===null||de===void 0?void 0:de.extension),{},{x:function(X){var fe=(X=q.nodeConfig)===null||X===void 0||(X=X.extension)===null||X===void 0?void 0:X.x,Ne=H?.x||0;return fe!==void 0?fe<Ne?Ne+fe:fe:Ne+(q.type===i.C8.LoopStart?Uo:q.type===i.C8.LoopEnd?$o:0)}(),y:function(X){var fe=(X=q.nodeConfig)===null||X===void 0||(X=X.extension)===null||X===void 0?void 0:X.y,Ne=H?.y||0;return fe!==void 0?fe<Ne?Ne+fe:fe:Ne+zo}()})})}),ge=fr(T.id,ce),Ce=g.current.addNode(ge);M.addChild(Ce)})}}),W},I=function(z){var W=z.map(function(M){var F=M.source.split("-")[0],T=M.target.split("-")[0],H=g.current.getCellById(F),q=g.current.getCellById(T);return!H||!q?(console.warn("[GraphContainer] \u8FB9\u7684\u6E90\u8282\u70B9(".concat(F,")\u6216\u76EE\u6807\u8282\u70B9(").concat(T,")\u4E0D\u5B58\u5728\uFF0C\u8DF3\u8FC7\u521B\u5EFA\u8FB9")),null):pr(M)}).filter(Boolean);g.current.addEdges(W),Gn(g.current)},w=function(z,W){var M=g.current.container,F=M?.getBoundingClientRect(),T=F&&z.x>=F.left&&z.x<=F.right&&z.y>=F.top&&z.y<=F.bottom,H=T?g.current.clientToGraph(z.x,z.y):{x:z.x,y:z.y},q=hn(W),de=q.width,ce=q.height,ge=T?H.x:H.x-de/2,Ce=T?H.y:H.y-ce/2,X=g.current.addNode({shape:W.shape,id:W.id,x:ge,y:Ce,width:de,height:ce,data:x()({},W),resizable:!0,zIndex:99,ports:bn(W)});if(W.loopNodeId){var fe=g.current.getCellById(X.id),Ne=g.current.getCellById(W.loopNodeId);Ne.addChild(fe),On(Ne);var De=Ne.getSize(),Ze=Ne.getPosition(),Me=Ne.getData();Me.nodeConfig.extension=x()(x()({},Me.nodeConfig.extension),{},{width:De.width,height:De.height,x:Ze.x,y:Ze.y}),o({nodeData:Me})}},A=function(z,W){if(g.current){w(z,W);var M=y(function(T){return T.id===W.id&&T.type==="Loop"});if(M.length){var F=[];M.forEach(function(T){var H=T.getData();F=F.concat(Wn([H],!1)),H.innerNodes&&H.innerNodes.length>0&&(F=F.concat(Wn(H.innerNodes,!1)))}),I(F)}}},D=function(z,W){if(!(!g.current||!W)){var M=g.current.getCellById(z);if(M&&M.isNode()){var F=M.getPosition();if(F&&(W.nodeConfig||(W.nodeConfig={extension:{}}),W.nodeConfig.extension=x()(x()({},W.nodeConfig.extension),{},{x:F.x,y:F.y})),ir(W)){var T=bn(W);if(W.type===i.C8.QA||W.type===i.C8.Condition){var H=lt({data:W,ports:T.items,type:se.yn.update}),q=H.width,de=H.height;M.setSize(q,de)}M.prop("ports",T)}M.updateData(W)}}},E=function(z,W,M){if(g.current){var F=g.current.getCellById(M);if(!(!F||!F.isNode())){var T=F.getData();if(T){var H=T.nodeConfig,q=hr()(T,Xo),de=Object.keys(z).reduce(function(Ce,X){return typeof X=="string"&&X&&(Ce[X]=W[X]),Ce},{});D(M,x()(x()({},q),{},{nodeConfig:(0,ke.Gm)((0,ke.Xh)(H),de)}));var ce=q.loopNodeId;if(ce){var ge=g.current.getCellById(ce.toString());ge&&On(ge)}}}}},R=function(z,W){if(g.current&&(g.current.removeCell(z),W&&W.loopNodeId)){var M=g.current.getCellById(W.loopNodeId);On(M)}},P=function(z){if(g.current){var W=g.current.getCellById(z);if(W&&W.isEdge()){var M=W.getSourceNode();if(M){var F=M.getData().nextNodeIds;F&&M.updateData({nextNodeIds:F.filter(function(T){return T!==Number(W.getTargetNode().id)})})}}g.current.removeCell(z)}},G=function(z,W,M){var F=z.split("-")[0],T=W.split("-")[0];if(!g.current.getCellById(F)||!g.current.getCellById(T)){console.warn("[GraphContainer] \u65E0\u6CD5\u521B\u5EFA\u8FB9\uFF1A\u6E90\u8282\u70B9(".concat(F,")\u6216\u76EE\u6807\u8282\u70B9(").concat(T,")\u5728\u753B\u5E03\u4E2D\u672A\u627E\u5230"));return}var H=pr({source:z,target:W,zIndex:M?25:1});g.current&&g.current.addEdge(H)},B=function(z){var W=g.current.getCellById(z);if(!(!W||!g.current)){W.updateData({isFocus:!1}),g.current.cleanSelection();var M=g.current.getSelectedCells();g.current.unselect(M),g.current.select(W)}},Y=function(z,W){var M=g.current.getCellById(z);if(!(!M||!g.current)){var F=M.getData();M.updateData({isFocus:!0,runResults:[].concat(Ee()((F.runResults||[]).filter(function(T){return T.status!==i.Ss.EXECUTING})),[W])}),g.current.select(M)}},le=function(){if(g.current){var z=g.current.getNodes();z.forEach(function(W){W.updateData({runResults:[]})})}},re=function(){g.current&&g.current.trigger("blank:click")},Q=function(z){g.current&&g.current.zoomTo(Number(z))},O=function(){g.current&&g.current.zoomToFit({padding:{top:146,left:18,right:18,bottom:18},maxScale:1,minScale:.2,preserveAspectRatio:!0,useCellGeometry:!0})},U=function(){if(g.current&&e.nodeList.length>0){var z,W;Fr(!0),(z=(W=g.current).cleanHistory)===null||z===void 0||z.call(W),g.current.clearCells();var M=e.nodeList.filter(function(q){return!q.loopNodeId}),F=M.map(function(q){return to(q)});g.current.fromJSON({nodes:F}),y(function(q){return q.type===i.C8.Loop}),I(e.edgeList);var T=!1,H=function(){T||(T=!0,O(),setTimeout(function(){var de,ce;(de=g.current)===null||de===void 0||(ce=de.cleanHistory)===null||ce===void 0||ce.call(de),Fr(!1),h()},100))};g.current.once("render:done",function(){setTimeout(H,50)}),setTimeout(function(){T||(console.warn("[GraphContainer] render:done not fired, forcing init complete"),H())},800)}},Z=function(){if(!g.current)return{x:0,y:0,width:0,height:0};var z=g.current.getGraphArea();return{x:z.x,y:z.y,width:z.width,height:z.height}},ae=function(){return g.current};(0,j.useImperativeHandle)(t,function(){return{getCurrentViewPort:Z,graphAddNode:A,graphUpdateNode:D,graphUpdateByFormData:E,graphDeleteNode:R,graphDeleteEdge:P,graphChangeZoom:Q,graphChangeZoomToFit:O,drawGraph:U,graphSelectNode:B,graphCreateNewEdge:G,getGraphRef:ae,graphTriggerBlankClick:re,graphActiveNodeRunResult:Y,graphResetRunResult:le}});var V=(0,j.useCallback)(function(){var K=xe()(ee()().mark(function z(W){var M;return ee()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,o(W);case 2:return M=T.sent,M||f(),T.abrupt("return",M);case 5:case"end":return T.stop()}},z)}));return function(z){return K.apply(this,arguments)}}(),[o,f]),ne=(0,j.useCallback)(function(){var K=xe()(ee()().mark(function z(W){var M;return ee()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,a(W);case 2:return M=T.sent,M||f(),T.abrupt("return",M);case 5:case"end":return T.stop()}},z)}));return function(z){return K.apply(this,arguments)}}(),[a,f]);return(0,j.useEffect)(function(){if(k.current){d(),g.current=Ho({containerId:At,changeDrawer:r,changeCondition:o,changeNodeConfigWithRefresh:V,changeEdgeConfigWithRefresh:ne,changeZoom:u,createNodeByPortOrEdge:c,onSaveNode:v,onClickBlank:N});var K=po({graph:g.current,changeEdgeConfigWithRefresh:ne,copyNode:l,changeNodeConfigWithRefresh:V,removeNode:s,modal:S,message:b});return function(){setTimeout(function(){K(),g.current&&g.current.dispose()},100)}}},[]),(0,j.useEffect)(function(){e.nodeList.length===0&&(C.current=!1)},[e.nodeList]),(0,j.useEffect)(function(){e.nodeList.length>0&&(U(),C.current=!0)},[e]),(0,n.jsx)("div",{ref:k,id:At})}),Ko=Qo,Pl=L(17002),Tr=L(74520),Jo=L(54995),on=L(32139),Yo=L(49235),dt=L(99833),fn=L(44689),Rr=L(3790),je=L(9504),Ve={"xagi-nav-style2":"xagi-nav-style2___s5QNt",text:"text___j0Yq3","page-container":"page-container___OJ2Vh",exceptionItem:"exceptionItem___kQiNB",exceptionItemHeader:"exceptionItemHeader___ZpsFc",exceptionItemTitle:"exceptionItemTitle___lSLBr",exceptionItemTip:"exceptionItemTip___MlOkn",exceptionItemForm:"exceptionItemForm___cOC9A",exceptionItemRow:"exceptionItemRow___qrcM_",exceptionItemFormItem:"exceptionItemFormItem___iMuDv","ant-form-item-required":"ant-form-item-required___dtonV",timeoutItem:"timeoutItem____JXHN",retryItem:"retryItem___i9Okh",handleTypeItem:"handleTypeItem___UO1Sp",exceptionContentItem:"exceptionContentItem___zdbQE",exceptionItemInput:"exceptionItemInput___j2uNt",exceptionItemSelect:"exceptionItemSelect___hwFmn","ant-select-selection-item":"ant-select-selection-item___GE40L","ant-select-selection-placeholder":"ant-select-selection-placeholder___Ggenx",disabled:"disabled___LWVHv",exceptionItemContentWrapper:"exceptionItemContentWrapper___hJrCh",exceptionItemContentLabel:"exceptionItemContentLabel___F9_MH",editorWrapper:"editorWrapper___xGG8l"},qo="",_o=(0,j.memo)(function(p){var t=p.name,e=p.timeout,r=e===void 0?180:e,a=p.retryCount,o=a===void 0?0:a,l=p.exceptionHandleType,s=l===void 0?i.Xy.INTERRUPT:l,u=p.disabled,c=u===void 0?!1:u,v=p.specificContent,N=p.exceptionHandleNodeIds,h=(0,Re.useModel)("workflowV3"),f=h.setIsModified,m=J.Z.useFormInstance(),S=(0,j.useMemo)(function(){return nr},[]),b=(0,j.useMemo)(function(){return Ca},[]),k=(0,j.useState)(s),g=me()(k,2),C=g[0],d=g[1],y=(0,j.useState)(wt(v)||qo),I=me()(y,2),w=I[0],A=I[1],D=(0,j.useState)(!1),E=me()(D,2),R=E[0],P=E[1];(0,j.useEffect)(function(){if(m){var Q=x()(x()({timeout:r,retryCount:o,exceptionHandleType:s},s===i.Xy.SPECIFIC_CONTENT&&{specificContent:wt(v)}),s===i.Xy.EXECUTE_EXCEPTION_FLOW&&{exceptionHandleNodeIds:N});m.setFieldsValue(pe()({},t,Q))}},[m,t,r,o,s,v,N]);var G=(0,Yo.L)({specificContent:m.getFieldValue([t,"specificContent"])||"",fieldName:t,watchField:"outputArgs"});(0,j.useEffect)(function(){A(wt(G))},[G]),(0,j.useEffect)(function(){m&&(d(s),s!==i.Xy.EXECUTE_EXCEPTION_FLOW&&m.setFieldValue([t,"exceptionHandleNodeIds"],[]))},[m,t,s]),(0,j.useEffect)(function(){m&&C!==i.Xy.EXECUTE_EXCEPTION_FLOW&&m.setFieldValue([t,"exceptionHandleNodeIds"],[])},[m,t,C]);var B=(0,j.useCallback)((0,tt.debounce)(function(){f(!0)},100),[]),Y=function(O){m.setFieldValue([t,"specificContent"],O),B()},le=function(O){if(d(O),O===i.Xy.SPECIFIC_CONTENT)try{Y(v||"")}catch{}else Y("")},re=function(O){if(m)try{JSON.parse(O),Y(O)}catch{}};return(0,n.jsxs)("div",{className:We()(Ve.exceptionItem),children:[(0,n.jsxs)("div",{className:We()(Ve.exceptionItemHeader),children:[(0,n.jsx)("span",{className:We()(Ve.exceptionItemTitle),children:"\u5F02\u5E38\u5904\u7406"}),(0,n.jsx)(on.Z,{title:"\u53EF\u8BBE\u7F6E\u5F02\u5E38\u5904\u7406\uFF0C\u5305\u62EC\u8D85\u65F6\u3001\u91CD\u8BD5\u3001\u5F02\u5E38\u5904\u7406\u65B9\u5F0F\u3002\u5F00\u542F\u6D41\u5F0F\u8F93\u51FA\u540E\uFF0C\u4E00\u65E6\u5F00\u59CB\u8F93\u51FA\u6570\u636E\uFF0C\u5373\u4F7F\u51FA\u73B0\u5F02\u5E38\u4E5F\u65E0\u6CD5\u91CD\u8BD5\u6216\u8005\u8DF3\u8F6C\u5F02\u5E38\u5206\u652F\u3002",icon:(0,n.jsx)(fn.Z,{})})]}),(0,n.jsxs)("div",{className:We()(Ve.exceptionItemForm),children:[(0,n.jsxs)("div",{className:We()(Ve.exceptionItemRow),children:[(0,n.jsx)(J.Z.Item,{name:[t,"timeout"],label:(0,n.jsxs)("span",{className:"flex items-center",children:["\u8D85\u65F6\u65F6\u95F4",(0,n.jsx)(on.Z,{title:"\u8BBE\u7F6E\u8282\u70B9\u6267\u884C\u7684\u6700\u5927\u7B49\u5F85\u65F6\u95F4",icon:(0,n.jsx)(fn.Z,{})})]}),className:We()(Ve.exceptionItemFormItem,Ve.timeoutItem),rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D85\u65F6\u65F6\u95F4"}],children:(0,n.jsx)(Ge.Z,{size:"small",suffix:"s",type:"number",className:We()(Ve.exceptionItemInput)})}),(0,n.jsx)(J.Z.Item,{name:[t,"retryCount"],label:"\u91CD\u8BD5\u6B21\u6570",className:We()(Ve.exceptionItemFormItem,Ve.retryItem),children:(0,n.jsx)(Ke.default,{size:"small",options:b,className:We()(Ve.exceptionItemSelect,pe()({},Ve.disabled,c)),disabled:c,placeholder:"\u4E0D\u91CD\u8BD5"})}),(0,n.jsx)(J.Z.Item,{name:[t,"exceptionHandleType"],label:"\u5F02\u5E38\u5904\u7406\u65B9\u5F0F",className:We()(Ve.exceptionItemFormItem,Ve.handleTypeItem),children:(0,n.jsx)(Ke.default,{size:"small",options:S,className:We()(Ve.exceptionItemSelect,pe()({},Ve.disabled,c)),disabled:c,placeholder:"\u4E2D\u65AD\u6D41\u7A0B",onChange:le})})]}),C===i.Xy.SPECIFIC_CONTENT&&(0,n.jsxs)("div",{className:We()(Ve.exceptionItemContentWrapper),children:[(0,n.jsxs)("div",{className:We()(Ve.exceptionItemContentLabel),children:[(0,n.jsx)("span",{children:"\u81EA\u5B9A\u4E49\u8FD4\u56DE\u5185\u5BB9"}),(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(Rr.Z,{}),size:"small",type:"text",onClick:function(){return P(!0)}})]}),(0,n.jsx)(J.Z.Item,{name:[t,"specificContent"],className:We()(Ve.exceptionItemFormItem,Ve.exceptionContentItem),rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u81EA\u5B9A\u4E49\u8FD4\u56DE\u5185\u5BB9"},{validator:function(O,U){if(!U)return Promise.resolve();try{return JSON.parse(U),Promise.resolve()}catch{return Promise.reject(new Error("\u8BF7\u8F93\u5165\u6709\u6548\u7684JSON\u683C\u5F0F"))}}}],children:(0,n.jsx)("div",{className:We()(Ve.editorWrapper),children:(0,n.jsx)(Tr.Z,{codeLanguage:dt.vQ.JSON,height:"150px",value:w,codeOptimizeVisible:!1,onChange:re})})})]}),(0,n.jsx)(Jo.Z,{disabledSwitchLanguage:!0,value:w,language:dt.vQ.JSON,visible:R,onClose:function(){return P(!1)},onChange:function(O){var U=O.code;re(U)}})]})]})},function(p,t){return $a(p,t)}),Hn=L(79425),wn=L(95822),Dt=L(29400),ei=L(72716),Sn=L(54139),ni=L(46819),en=L(16621),Un=L(20860),Tt=L(70183),ct=L(51430),$n=L(7010),Xe=L(92448),ti=L(21514),ft=L(86743),Je=L(63876),Lr=L(29328),Ye=function(t){var e=t.title,r=t.fieldConfigs,a=t.form,o=t.inputItemName,l=o===void 0?"inputArgs":o,s=t.showCopy,u=s===void 0?!1:s,c=t.disabledAdd,v=t.disabledDelete,N=t.disabledInput,h=t.isLoop,f=(0,Re.useModel)("workflowV3"),m=f.volid,S=r.reduce(function(b,k){return b[k.name]=null,b},{});return(0,j.useEffect)(function(){m&&a.validateFields()},[m]),(0,n.jsx)("div",{className:"form-list-style",children:(0,n.jsx)(J.Z.List,{name:l,children:function(k,g){var C=g.add,d=g.remove;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"dis-sb ",children:[(0,n.jsx)("span",{className:"node-title-style gap-6 flex items-center",children:e}),!c&&(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(en.Z,{}),onClick:function(){return C(S)},size:"small",type:"text"})]}),k.map(function(y,I){var w=a.getFieldValue([l,y.name,"bindValueType"]);return(0,n.jsxs)("div",{children:[I===0&&(0,n.jsxs)("div",{className:"font-color-gray07 font-12 mt-6",children:[(0,n.jsx)("span",{children:"\u53C2\u6570\u540D"}),(0,n.jsx)("span",{style:{marginLeft:"22%"},children:"\u53D8\u91CF\u503C"})]}),(0,n.jsx)(J.Z.Item,{children:(0,n.jsxs)("div",{className:"dis-left",children:[(0,n.jsx)(J.Z.Item,{label:"\u53C2\u6570\u540D",name:[y.name,"name"],noStyle:!0,children:(0,n.jsx)(Ge.Z,{size:"small",style:{width:"30%",marginRight:"10px"},placeholder:"\u8BF7\u8F93\u5165\u53C2\u6570\u540D",disabled:N})}),(0,n.jsx)(J.Z.Item,{name:[y.name,"bindValue"],noStyle:!0,children:(0,n.jsx)(Vn.Z,{form:a,fieldName:[].concat(Ee()(Array.isArray(l)?l:[l]),[y.name,"bindValue"]),style:{flex:1,marginRight:"10px"},referenceType:w,isLoop:h})}),(0,n.jsx)(J.Z.Item,{name:[y.name,"bindType"],noStyle:!0,hidden:!0,children:(0,n.jsx)(Ge.Z,{type:"hidden"})}),u&&(0,n.jsx)(Je.Z,{content:(0,n.jsx)(J.Z.Item,{name:[y.name,"description"],noStyle:!0,children:(0,n.jsx)(Ge.Z.TextArea,{autoSize:{minRows:3,maxRows:5}})}),trigger:"click",children:(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(ti.Z,{}),className:"margin-right",size:"small",type:"text"})}),!v&&(0,n.jsx)(J.Z.Item,{name:[y.name,"require"],noStyle:!0,children:(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(ft.Z,{}),size:"small",type:"text",onClick:function(){return d(y.name)}})})]})},y.key)]},y.name)})]})}})})},ri=function(t){var e=t.title,r=t.inputItemName,a=r===void 0?"conditionArgs":r,o=t.disabledAdd,l=t.disabledDelete,s=t.disabledInput;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(J.Z.List,{name:a,children:function(c,v){var N=v.add,h=v.remove;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"dis-sb margin-bottom",children:[(0,n.jsx)("span",{className:"node-title-style",children:e}),!o&&(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(en.Z,{}),size:"small",type:"text",onClick:function(){return N({key:(0,Xe.Z)(),name:"",bindValue:"",dataType:i.Gi.String})}})]}),c.map(function(f,m){return(0,n.jsxs)("div",{children:[m===0&&(0,n.jsxs)("div",{className:"font-color-gray07",children:[(0,n.jsx)("span",{children:"\u53C2\u6570\u540D"}),(0,n.jsx)("span",{style:{marginLeft:"20%"},children:"\u53D8\u91CF\u503C"})]}),(0,n.jsx)(J.Z.Item,{children:(0,n.jsxs)("div",{className:"dis-left",children:[(0,n.jsx)(J.Z.Item,{label:"\u53C2\u6570\u540D",name:[f.name,"name"],noStyle:!0,children:(0,n.jsx)(Ge.Z,{size:"small",style:{width:"30%",marginRight:"10px"},placeholder:"\u8BF7\u8F93\u5165\u53C2\u6570\u540D",disabled:s})}),(0,n.jsx)(J.Z.Item,{label:"\u53D8\u91CF\u540D",name:[f.name,"bindValue"],noStyle:!0,children:(0,n.jsx)(Ge.Z,{placeholder:"\u8BF7\u8F93\u5165\u53C2\u6570\u503C",size:"small",style:{width:"55%",marginRight:"10px"}})}),!l&&(0,n.jsx)(J.Z.Item,{noStyle:!0,children:(0,n.jsx)(ft.Z,{onClick:function(){return h(f.name)}})})]})},f.key)]},f.key)})]})}})})},Cn=function(t){var e=t.treeData,r=(0,j.useState)([]),a=me()(r,2),o=a[0],l=a[1];(0,j.useEffect)(function(){var u=function c(v){var N=[];return v.forEach(function(h){h.subArgs&&h.subArgs.length>0&&(N.push(h.key),N.push.apply(N,Ee()(c(h.subArgs))))}),N};l(u(e))},[e]);var s=function u(c){return c.map(function(v){return x()(x()({},v),{},{title:(0,n.jsxs)("div",{className:"tree-custom-title-style",children:[(0,n.jsx)("span",{children:v.name}),(0,n.jsx)(Je.Z,{content:v.description||"\u6682\u65E0\u63CF\u8FF0",children:(0,n.jsx)(fn.Z,{style:{marginLeft:"4px",fontSize:12,cursor:"help"}})}),(0,n.jsx)(He.Z,{color:"#C9CDD4",style:{marginLeft:"5px"},children:Tn.zx[v.dataType]})]}),children:v.subArgs?u(v.subArgs):void 0})})};return(0,n.jsx)(Lr.Z,{showLine:!0,expandedKeys:o,onExpand:function(c){return l(c)},switcherIcon:(0,n.jsx)(br.Z,{}),treeData:s(e),defaultExpandAll:!0})},Vl=function(t){var e=t.options,r=t.placeholder,a=t.onChange,o=function(u){a&&a(u)},l=function(u){return _jsx(Select.Option,{value:u.value,children:_jsxs("span",{className:"option-container",children:[_jsx(Checkbox,{}),_jsx("span",{children:u.label})]})},u.value)};return _jsx(Select,{mode:"multiple",showSearch:!0,placeholder:r,optionLabelProp:"label",onChange:o,filterOption:function(u,c){var v;return c==null||(v=c.props.children)===null||v===void 0?void 0:v.toString().toLowerCase().includes(u?.toLowerCase())},popupRender:function(u){return _jsx("div",{className:"custom-dropdown",children:React.cloneElement(u,{className:"".concat(u.props.className," custom-menu")})})},tokenSeparators:[","],style:{width:"100%"},children:e.map(l)})},Pr=function(t){var e=t.form,r=t.title,a=t.field,o=t.inputItemName,l=o===void 0?"inputArgs":o,s=t.showIndex,u=t.limitAddLength,c=u===void 0?-1:u,v=(0,j.useState)(!1),N=me()(v,2),h=N[0],f=N[1],m=J.Z.useWatch(l,{form:e,preserve:!0});return(0,j.useEffect)(function(){c>-1&&f((m?.length||0)>=c)},[m,e,c]),(0,n.jsx)(J.Z.List,{name:l,children:function(b,k){var g=k.add,C=k.remove;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"dis-sb margin-bottom",children:[(0,n.jsx)("span",{className:"node-title-style",children:r}),(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(en.Z,{}),size:"small",type:"text",disabled:h,onClick:function(){var y=e.getFieldValue(l)||[],I=Math.max(0,y.length-1);g(pe()(pe()(pe()(pe()({},a,""),"index",y.length),"nextNodeIds",[]),"uuid",(0,Xe.Z)()),I),e.submit()}})]}),b.map(function(d,y){var I=!1;return e.getFieldValue([l,d.name,"intentType"])==="OTHER"&&(I=!0),e.getFieldValue([l,d.name,"content"])==="\u6B64\u9009\u9879\u7528\u6237\u4E0D\u53EF\u89C1\uFF0C\u7528\u6237\u56DE\u590D\u65E0\u5173\u5185\u5BB9\u65F6\u8D70\u6B64\u5206\u652F"&&(I=!0),(0,n.jsx)(J.Z.Item,{children:(0,n.jsxs)("div",{className:"dis-left",children:[s&&(0,n.jsx)(J.Z.Item,{noStyle:!0,name:[d.name,"index"],children:(0,n.jsx)("span",{className:"mr-16",children:et[y]})}),(0,n.jsx)(J.Z.Item,{name:[d.name,a],className:"flex-1",children:(0,n.jsx)(Ge.Z,{disabled:I,onBlur:function(){e.submit()}})}),!I&&b.length>2&&(0,n.jsx)(J.Z.Item,{noStyle:!0,children:(0,n.jsx)(ft.Z,{className:"ml-10",onClick:function(){C(d.name),e.submit()}})})]})},d.name+"_"+et[y])})]})}})},Bl=function(t){var e=t.form,r=t.title,a=t.inputItemName;return _jsx(_Fragment,{children:_jsx(Form.List,{name:a,children:function(l){return _jsxs(_Fragment,{children:[_jsx("span",{className:"node-title-style",children:r}),l.map(function(s,u){var c=e.getFieldValue([a,s.name,"bindValueType"]);return _jsxs("div",{children:[u===0&&_jsxs(_Fragment,{children:[_jsx("span",{children:"\u53C2\u6570\u540D"}),_jsx("span",{style:{marginLeft:"25%"},children:"\u53C2\u6570\u503C"})]}),_jsx(Form.Item,{children:_jsxs("div",{className:"dis-left",children:[_jsx(Form.Item,{noStyle:!0,name:[s.name,"bindValue"],children:_jsxs("div",{className:"dis-left node-form-label-style",children:[_jsx("span",{className:"margin-right-6 font-12 form-name-style",children:e.getFieldValue([a,s.name,"name"])}),_jsx(Popover,{placement:"right",content:e.getFieldValue([a,s.name,"description"]),children:_jsx(InfoCircleOutlined,{className:"margin-right-6 font-12"})})]})}),_jsx(Form.Item,{name:[s.name,"bindValue"],noStyle:!0,children:_jsx(InputOrReference,{form:e,fieldName:[a,s.name,"bindValue"],style:{width:"65%"},referenceType:c})})]})},s.key)]},s.name)})]})}})})},ai=L(57931),Rt=L(62237),nn={"xagi-nav-style2":"xagi-nav-style2___X8hIP",text:"text___TVA3B","page-container":"page-container___eeW6g","skill-list":"skill-list___pEOdl","skill-dispose-modal-style":"skill-dispose-modal-style___vjina","ant-modal-header":"ant-modal-header___NwL9z","ant-modal-content":"ant-modal-content___C5dof","ant-modal-footer":"ant-modal-footer___ggXxg","skill-item-dispose-mask":"skill-item-dispose-mask___omA5L","skill-item-container":"skill-item-container___Do4hA","skill-item-style":"skill-item-style___gtMgr","skill-item-icon":"skill-item-icon___gchYr","skill-item-content-style":"skill-item-content-style___w9N4v","skill-item-title-style":"skill-item-title-style___qsWuv","skill-item-desc-style":"skill-item-desc-style___jmwuM","mask-layer-style":"mask-layer-style___NapIc","skill-params-description":"skill-params-description___jacEX","skill-dispose-container":"skill-dispose-container___pDlz4","skill-dispose-left":"skill-dispose-left____qE1c","skill-dispose-left-title":"skill-dispose-left-title___RPFCM","skill-menu-style":"skill-menu-style___FRzE9","select-menu":"select-menu___XjaR9","skill-dispose-right":"skill-dispose-right___nB3aL","content-title-style":"content-title-style___mv4Qu","content-item-style":"content-item-style___Vgfc5","content-center-item-style":"content-center-item-style___ft1LU","content-right-item-style":"content-right-item-style___ZUfA4","output-style":"output-style___ZTrSW","output-remark-style":"output-remark-style___sGq0_","tree-title-style":"tree-title-style___Ffnyb",white:"white___Vx0nd","skill-tree":"skill-tree___tdekk","dis-no-wrap":"dis-no-wrap___uPbnB","database-tag-style":"database-tag-style___aS_GF","background-c9":"background-c9___YHDgm"},oi=L(2541),Vr=L(14258),zn={"xagi-nav-style2":"xagi-nav-style2___yVDW1",text:"text___a2yD7","page-container":"page-container___HQ9Pv","modal-container":"modal-container___DySPe",container:"container___VViGB",left:"left___FF5oy",right:"right___VDPxG",close:"close___Xab2W"},pt=We().bind(zn),ii=function(t){var e=t.open,r=t.inputArgBindConfigs,a=t.variables,o=t.onCancel,l=t.onSave,s=function(c){l(c)};return(0,n.jsx)(Ft.Z,{centered:!0,open:e,onCancel:o,className:pt(zn["modal-container"]),modalRender:function(){return(0,n.jsxs)("div",{className:pt(zn.container,"overflow-hide","flex","flex-col"),children:[(0,n.jsx)("div",{className:pt("flex-1",zn.right),children:(0,n.jsx)(oi.Z,{style:{paddingTop:"48px"},variables:a,inputArgBindConfigs:r,onSaveSet:s})}),(0,n.jsx)(Vr.Z,{className:pt(zn.close,"cursor-pointer"),onClick:o})]})}})},si=ii,Qe=We().bind(nn),Br=function(t,e){return t.length>e?t.slice(0,e)+"...":t},li=function(t){var e=t.params;return(0,n.jsx)("div",{style:{maxWidth:"300px"},children:(e||[]).map(function(r){return(0,n.jsxs)("div",{style:{padding:"3px 0"},children:[(0,n.jsxs)("div",{className:Qe("dis-left"),children:[(0,n.jsx)("span",{className:Qe("mr-16"),children:Br(r.name,30)}),(0,n.jsx)(He.Z,{color:"#C9CDD4",children:r.dataType})]}),(0,n.jsx)("p",{className:Qe(nn["skill-params-description"]),children:Br(r.description||"",70)})]},r.name)})})},Zr=function(t){var e=t.params,r=t.disabled,a=r===void 0?!1:r,o=t.removeItem,l=t.modifyItem,s=t.variables,u=s===void 0?[]:s,c=(0,j.useState)(null),v=me()(c,2),N=v[0],h=v[1],f=(0,j.useState)(!1),m=me()(f,2),S=m[0],b=m[1],k=(0,j.useState)(!1),g=me()(k,2),C=g[0],d=g[1],y=function(R){o(R)},I=function(R){l(x()(x()({},N),{},{inputArgBindConfigs:R.inputArgBindConfigs})),b(!1),h(null)},w=function(R){var P=R.inputArgBindConfigs,G=(0,ai.T6)(P||[]);h(x()(x()({},R),{},{inputArgBindConfigs:G})),b(!0)},A=function(R){return N?.typeId===R.typeId&&(N?.toolName||"")===(R.toolName||"")},D=(0,j.useCallback)(function(E,R,P){var G;return"".concat(R,"-").concat(E?.type,"-").concat((G=E?.typeId)!==null&&G!==void 0?G:P,"-").concat(E?.toolName||"")},[]);return(0,n.jsxs)("div",{className:Qe(nn["skill-list"],"relative"),children:[e.map(function(E,R){return(0,n.jsx)("div",{className:Qe(nn["skill-item-container"],R===0&&"margin-top-10"),children:(0,n.jsxs)("div",{className:Qe(nn["skill-item-style"],"dis-left"),style:{opacity:a?.5:1,cursor:a?"not-allowed":"pointer"},onMouseEnter:function(){h(E),d(!0)},onMouseLeave:function(){return d(!1)},children:[(0,n.jsx)("img",{src:E.icon||dr(E.targetType),alt:"",className:Qe(nn["skill-item-icon"])}),(0,n.jsxs)("div",{className:Qe(nn["skill-item-content-style"]),children:[(0,n.jsx)("div",{className:Qe(nn["skill-item-title-style"]),children:E.name}),(0,n.jsx)("div",{className:Qe(nn["skill-item-desc-style"]),children:E.description})]}),A(E)&&C&&(0,n.jsx)("div",{className:Qe(nn["mask-layer-style"]),children:(0,n.jsxs)("div",{className:Qe(nn["skill-item-dispose-style"],nn["skill-item-dispose-mask"]),children:[E.inputArgBindConfigs&&E.inputArgBindConfigs.length&&(0,n.jsx)(Je.Z,{content:(0,n.jsx)(li,{params:E.inputArgBindConfigs}),placement:"right",trigger:"hover",children:(0,n.jsx)(fn.Z,{className:Qe("white")})}),(0,n.jsx)(Je.Z,{content:"\u7F16\u8F91\u53C2\u6570",trigger:"hover",children:(0,n.jsx)(Rt.Z,{className:Qe("ml-12 cursor-pointer white"),onClick:function(){w(E),b(!0)}})}),!a&&(0,n.jsx)(Je.Z,{content:"\u79FB\u9664",trigger:"hover",children:(0,n.jsx)(ft.Z,{className:Qe("ml-12  white"),onClick:function(){return y(E)}})})]})})]})},D(E,"skill",R))}),(0,n.jsx)(si,{open:S,variables:u,inputArgBindConfigs:N?.inputArgBindConfigs,onSave:I,onCancel:function(){return b(!1)}},D(N,"setting",0))]})},ui=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"}],di=[{label:"\u65E0",value:i.lT.OTHER,style:{marginTop:3,marginBottom:3}},{label:"form-data",value:i.lT.FORM_DATA,style:{marginTop:3,marginBottom:3}},{label:"json",value:i.lT.JSON,style:{marginTop:3,marginBottom:3}},{label:"x-www-form-urlencoded",value:i.lT.X_WWW_FORM_URLENCODED,style:{marginTop:3,marginBottom:3}}],ci=Tn.Ne.filter(function(p){return[Se.qR.Plugin,Se.qR.Workflow,Se.qR.MCP].includes(p.key)}),fi=function(t){var e=t.form,r=t.id,a=t.nodeConfig,o=t.type,l=(0,j.useState)(!1),s=me()(l,2),u=s[0],c=s[1],v=(0,j.useState)(!1),N=me()(v,2),h=N[0],f=N[1],m=(0,j.useState)([]),S=me()(m,2),b=S[0],k=S[1],g=(0,j.useState)(!1),C=me()(g,2),d=C[0],y=C[1],I=(0,Re.useModel)("workflowV3"),w=I.setIsModified,A=I.referenceList,D=function(U,Z){var ae=U?.map(function(V){return{type:V.type,targetId:Number(V.typeId),status:Z(V),toolName:V.toolName||""}})||[];k(ae)},E=function(U){var Z=e.getFieldValue(Ue)||[];U.type=U.targetType,U.typeId=U.targetId,e.setFieldValue(Ue,Z.concat([U])),w(!0),e.submit(),y(!0)},R=function(U){var Z=e.getFieldValue(Ue);if(Z){var ae=Z.filter(function(V){return!(V.typeId===U.typeId&&(V.toolName||"")===(U.toolName||""))});e.setFieldValue(Ue,ae),w(!0),e.submit()}},P=function(U){var Z=e.getFieldValue(Ue);if(Z){var ae=Z.map(function(V){return V.typeId===U.typeId&&(V.toolName||"")===(U.toolName||"")?U:V});e.setFieldValue(Ue,ae),w(!0),e.submit()}},G=function(){c(!0)},B=e.getFieldValue(Ue);(0,j.useEffect)(function(){D(B,function(){return Se.BQ.Added})},[B]);var Y=J.Z.useWatch(se.dy.inputArgs,{form:e,preserve:!0}),le=((Y&&Y.length>0?Y:a?.inputArgs)||[]).filter(function(O){return!["",null,void 0].includes(O.name)});console.log("[LLMNode] variables:",le?.length,"referenceList argMapKeys:",Object.keys(A?.argMap||{}).length);var re=(0,j.useCallback)(function(){c(!1),d&&(y(!1),w(!0),e.submit())},[d,e,y,c]),Q=J.Z.useWatch(Ue,{form:e,preserve:!0})||[];return(0,n.jsxs)("div",{className:"model-node-style",children:[(0,n.jsx)(Dt.Dj,{form:e,modelConfig:a?.modelConfig}),(0,n.jsxs)("div",{className:"dis-sb",children:[(0,n.jsx)("span",{className:"node-title-style",children:"\u5DE5\u5177"}),(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(en.Z,{}),size:"small",onClick:G,type:"text"})]}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){return Q?(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Zr,{params:Q,skillName:Ue,variables:le,form:e,removeItem:R,modifyItem:P})}):(0,n.jsx)(Tt.Z,{})}}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:"\u8F93\u5165",fieldConfigs:ze,inputItemName:se.dy.inputArgs,form:e})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Hn.Z,{title:(0,n.jsxs)(n.Fragment,{children:["\u7CFB\u7EDF\u63D0\u793A\u8BCD",(0,n.jsx)(on.Z,{title:"\u4E3A\u5BF9\u8BDD\u63D0\u4F9B\u7CFB\u7EDF\u7EA7\u6307\u5BFC\uFF0C\u5982\u8BBE\u5B9A\u4EBA\u8BBE\u548C\u56DE\u590D\u903B\u8F91\u3002",icon:(0,n.jsx)(Un.Z,{})})]}),inputFieldName:"systemPrompt",onExpand:!0,onOptimize:!0,onOptimizeClick:function(){return f(!0)},placeholder:"\u7CFB\u7EDF\u63D0\u793A\u8BCD\uFF0C\u53EF\u4EE5\u4F7F\u7528{{\u53D8\u91CF\u540D}}\u3001{{\u53D8\u91CF\u540D.\u5B50\u53D8\u91CF\u540D}}\u3001 {{\u53D8\u91CF\u540D[\u6570\u7EC4\u7D22\u5F15]}}\u7684\u65B9\u5F0F\u5F15\u7528\u8F93\u5165\u53C2\u6570\u4E2D\u7684\u53D8\u91CF",variables:(0,Sn.z)(le,A?.argMap),skills:B})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Hn.Z,{title:(0,n.jsxs)(n.Fragment,{children:["\u7528\u6237\u63D0\u793A\u8BCD",(0,n.jsx)(on.Z,{title:"\u5411\u6A21\u578B\u63D0\u4F9B\u7528\u6237\u6307\u4EE4\uFF0C\u5982\u67E5\u8BE2\u6216\u4EFB\u4F55\u57FA\u4E8E\u6587\u672C\u8F93\u5165\u7684\u63D0\u95EE\u3002",icon:(0,n.jsx)(Un.Z,{})})]}),inputFieldName:"userPrompt",onExpand:!0,placeholder:"\u7528\u6237\u63D0\u793A\u8BCD\uFF0C\u53EF\u4EE5\u4F7F\u7528{{\u53D8\u91CF\u540D}}\u3001{{\u53D8\u91CF\u540D.\u5B50\u53D8\u91CF\u540D}}\u3001 {{\u53D8\u91CF\u540D[\u6570\u7EC4\u7D22\u5F15]}}\u7684\u65B9\u5F0F\u5F15\u7528\u8F93\u5165\u53C2\u6570\u4E2D\u7684\u53D8\u91CF",variables:(0,Sn.z)(le,A?.argMap),skills:B})}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,name:"outputArgs",children:(0,n.jsx)(wn.Z,{title:"\u8F93\u51FA",notShowTitle:!0,form:e,params:a?.outputArgs||[],inputItemName:"outputArgs"},"".concat(o,"-").concat(r,"-outputArgs"))}),(0,n.jsx)(It.Z,{checkTag:Se.qR.Plugin,onAdded:E,open:u,addSkillLoading:!1,onCancel:re,addComponents:b,tabs:ci}),(0,n.jsx)(ei.Z,{title:"\u63D0\u793A\u8BCD\u4F18\u5316",open:h,onCancel:function(){f(!1)},defaultValue:e.getFieldValue("systemPrompt")||"",onReplace:function(U){if(U){var Z=U;Z.includes("```")&&(Z=Z.replace(/```/g,"")),e.setFieldsValue({systemPrompt:Z||""}),w(!0),f(!1)}},targetId:r,type:ni.U.WORKFLOW_LLM_NODE})]})},pi=function(t){var e=t.form,r=(0,Re.useModel)("workflowV3"),a=r.referenceList;return(0,n.jsxs)("div",{className:"model-node-style",children:[(0,n.jsx)(J.Z.Item,{noStyle:!0,children:(0,n.jsx)(Dt.Dj,{form:e})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:"\u8F93\u5165",fieldConfigs:ze,inputItemName:se.dy.inputArgs,form:e})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Pr,{title:"\u610F\u56FE\u5339\u914D",form:e,field:"intent",hasUuid:!0,showIndex:!0,limitAddLength:26,inputItemName:se.dy.intentConfigs})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Hn.Z,{title:"\u8865\u5145\u63D0\u793A\u8BCD",inputFieldName:"extraPrompt",onExpand:!0,placeholder:"\u652F\u6301\u989D\u5916\u7684\u7CFB\u7EDF\u63D0\u793A\u8BCD\uFF0C\u5982\u5BF9\u610F\u56FE\u9009\u9879\u505A\u66F4\u8BE6\u7EC6\u7684\u4F8B\u5B50\u4EE5\u589E \u5F3A\u7528\u6237\u8F93\u51FA\u4E0E\u610F\u56FE\u5339\u914D\u7684\u6210\u529F\u7387\u3002",variables:(0,Sn.z)((J.Z.useWatch(se.dy.inputArgs,{form:e,preserve:!0})||[]).filter(function(o){return!["",null,void 0].includes(o.name)}),a?.argMap)})}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,children:function(){return e.getFieldValue("outputArgs")&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"node-title-style margin-bottom",children:"\u8F93\u51FA"}),(0,n.jsx)(Cn,{treeData:e.getFieldValue("outputArgs")})]})}})]})},vi=function(t){var e=t.form,r=t.nodeConfig,a=t.type,o=t.id,l=(0,Re.useModel)("workflowV3"),s=l.referenceList,u=function(v){var N=e.getFieldValue("options");if(v==="SELECT"&&(!N||!N.length)&&(N=[{uuid:(0,Xe.Z)(),index:0,content:"",nextNodeIds:[]},{uuid:(0,Xe.Z)(),index:1,content:"\u6B64\u9009\u9879\u7528\u6237\u4E0D\u53EF\u89C1\uFF0C\u7528\u6237\u56DE\u590D\u65E0\u5173\u5185\u5BB9\u65F6\u8D70\u6B64\u5206\u652F",nextNodeIds:[]}]),console.log("bb",v,e.getFieldValue("answerType")),v==="TEXT"){var h;N=(h=N)===null||h===void 0?void 0:h.map(function(f){return x()(x()({},f),{},{nextNodeIds:[]})})}e.setFieldsValue({answerType:v,options:N}),e.submit()};return(0,n.jsxs)("div",{className:"node-title-style",children:[(0,n.jsx)(Dt.Dj,{form:e}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:"\u8F93\u5165",fieldConfigs:ze,inputItemName:se.dy.inputArgs,form:e})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Hn.Z,{title:"\u63D0\u95EE\u95EE\u9898",inputFieldName:"question",onExpand:!0,placeholder:"\u53EF\u4F7F\u7528{{\u53D8\u91CF\u540D}}\u7684\u65B9\u5F0F\u5F15\u7528\u8F93\u5165\u53C2\u6570\u4E2D\u7684\u53D8\u91CF",variables:(0,Sn.z)((J.Z.useWatch(se.dy.inputArgs,{form:e,preserve:!0})||[]).filter(function(c){return!["",null,void 0].includes(c.name)}),s?.argMap)})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(J.Z.Item,{label:"\u56DE\u7B54\u7C7B\u578B",name:"answerType",children:(0,n.jsx)(ct.ZP.Group,{onChange:function(v){return u(v.target.value)},children:(0,n.jsxs)($n.Z,{direction:"vertical",children:[(0,n.jsx)(ct.ZP,{value:"TEXT",children:"\u76F4\u63A5\u56DE\u7B54"}),(0,n.jsx)(ct.ZP,{value:"SELECT",children:"\u9009\u9879\u56DE\u7B54"})]})})})}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){return e.getFieldValue("answerType")==="TEXT"?(0,n.jsx)(wn.Z,{title:"\u8F93\u51FA",form:e,params:r?.outputArgs||[],inputItemName:"outputArgs",showCheck:!0},"".concat(a,"-").concat(o,"-outputArgs")):null}}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){return e.getFieldValue("answerType")==="SELECT"?(0,n.jsx)(Pr,{title:"\u8BBE\u7F6E\u9009\u9879\u5185\u5BB9",form:e,field:"content",inputItemName:se.dy.options,hasUuid:!0,showIndex:!0}):null}})]})},gi=function(t){var e=t.form,r=t.nodeConfig,a=t.type,o=t.id,l=r?.body||[],s=r?.outputArgs||[];return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(J.Z.Item,{label:"\u8BF7\u6C42\u65B9\u6CD5\u4E0E\u8DEF\u5F84",children:(0,n.jsxs)("div",{className:"dis-sb",children:[(0,n.jsx)(J.Z.Item,{name:"method",noStyle:!0,children:(0,n.jsx)(Ke.default,{style:{width:"30%",marginRight:"10px"},options:ui,placeholder:"\u8BF7\u6C42\u65B9\u6CD5"})}),(0,n.jsx)(J.Z.Item,{name:"url",noStyle:!0,children:(0,n.jsx)(Ge.Z,{placeholder:"\u8BF7\u8F93\u5165url\u5730\u5740"})})]})})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(J.Z.Item,{name:"contentType",label:"\u8BF7\u6C42\u5185\u5BB9\u683C\u5F0F",children:(0,n.jsx)(ct.ZP.Group,{className:"margin-bottom",options:di})})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(J.Z.Item,{label:"\u8BF7\u6C42\u8D85\u65F6\u914D\u7F6E",name:"timeout",children:(0,n.jsx)(Ge.Z,{placeholder:"\u8BF7\u8F93\u5165\u8D85\u65F6\u914D\u7F6E\u65F6\u957F",addonAfter:"s"})})}),(0,n.jsxs)("div",{className:"has-child-node",children:[(0,n.jsx)("p",{className:"node-title-bold-style",children:"\u5165\u53C2"}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:"Header",fieldConfigs:ze,inputItemName:se.dy.headers,form:e})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:"Query",form:e,fieldConfigs:ze,inputItemName:se.dy.queries})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(wn.Z,{title:"Body",form:e,inputItemName:"body",isBody:!0,params:l},"".concat(a,"-").concat(o,"-body"))})]}),(0,n.jsx)(J.Z.Item,{name:"outputArgs",children:(0,n.jsx)(wn.Z,{title:"\u51FA\u53C2",form:e,inputItemName:"outputArgs",params:s},"".concat(a,"-").concat(o,"-outputArgs"))})]})},vt={ModelNode:fi,IntentionNode:pi,QuestionsNode:vi,HttpToolNode:gi},Lt=L(33797),Pt=L(41295),hi=function(t){var e=t.form,r=function(o){if(o.destination){var l=e.getFieldValue("conditionBranchConfigs"),s=l.length-2;if(!(o.destination.index>s)){var u=l.splice(o.source.index,1),c=me()(u,1),v=c[0];l.splice(o.destination.index,0,v);var N=l.map(function(h,f){return x()(x()({},h),{},{branchType:f===0?"IF":f===l.length-1?"ELSE":"ELSE_IF"})});e.setFieldsValue({conditionBranchConfigs:N}),e.submit()}}};return(0,n.jsx)(Pt.Z5,{onDragEnd:r,children:(0,n.jsx)(J.Z.List,{name:"conditionBranchConfigs",children:function(o,l){var s=l.add,u=l.remove;return(0,n.jsx)(Pt.bK,{droppableId:"conditionBranches",children:function(v){return(0,n.jsxs)("div",x()(x()({},v.droppableProps),{},{ref:v.innerRef,children:[(0,n.jsxs)("div",{className:"dis-sb margin-bottom",children:[(0,n.jsx)("span",{className:"node-title-style",children:"\u6761\u4EF6\u5206\u652F"}),(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(en.Z,{}),type:"text",onClick:function(){var h=e.getFieldValue("conditionBranchConfigs")||[],f=Math.max(0,h.length-1);s({uuid:(0,Xe.Z)(),conditionType:"AND",conditionArgs:[{compareType:"EQUAL",firstArg:{bindValue:""},secondArg:{bindValue:""}}],nextNodeIds:[],branchType:"ELSE_IF"},f),e.submit()}})]}),o.map(function(N,h){var f=h===o.length-1;if(!f){var m=e.getFieldValue(["conditionBranchConfigs",N.name]);return(0,n.jsx)(Pt._l,{draggableId:m.uuid,index:h,children:function(b){return(0,n.jsxs)("div",x()(x()({ref:b.innerRef},b.draggableProps),{},{className:"condition-card-style",children:[(0,n.jsxs)("div",{className:"dis-sb",children:[(0,n.jsxs)("div",x()(x()({className:"dis-left"},b.dragHandleProps),{},{style:{cursor:"grab",width:"100%"},children:[(0,n.jsx)("span",{className:"margin-right",children:er[m.branchType]}),(0,n.jsxs)(He.Z,{color:"#C9CDD4",children:["\u4F18\u5148\u7EA7",h+1]})]})),o.length>2&&(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(Lt.Z,{}),type:"text",onClick:function(){if(u(N.name),N.name===0){var g=e.getFieldValue("conditionBranchConfigs")||[],C=g.map(function(d,y){return x()(x()({},d),{},{branchType:y===0?"IF":y===g.length-1?"ELSE":"ELSE_IF"})});e.setFieldsValue({conditionBranchConfigs:C})}e.submit()}})]}),(0,n.jsxs)($n.Z,{children:[m.conditionArgs.length>1&&(0,n.jsx)(J.Z.Item,{noStyle:!0,shouldUpdate:function(g,C){var d,y;return((d=g.conditionBranchConfigs)===null||d===void 0||(d=d[N.name])===null||d===void 0?void 0:d.conditionArgs)!==((y=C.conditionBranchConfigs)===null||y===void 0||(y=y[N.name])===null||y===void 0?void 0:y.conditionArgs)},children:function(g){var C=g.getFieldValue,d=C(["conditionBranchConfigs",N.name,"conditionArgs"]);return d?.length>1&&(0,n.jsx)(J.Z.Item,{name:[N.name,"conditionType"],style:{marginTop:"-26px"},children:(0,n.jsx)(Ke.default,{style:{marginRight:"4px",width:54},options:[{label:"\u4E14",value:"AND"},{label:"\u6216",value:"OR"}]})})}}),h!==o.length-1&&(0,n.jsx)(J.Z.List,{name:[N.name,"conditionArgs"],children:function(g,C){return(0,n.jsxs)("div",{className:"position-relative",children:[(0,n.jsx)("div",{className:"dis-left",children:(0,n.jsx)("div",{className:"dis-col",children:g.map(function(d){var y=e.getFieldValue(["conditionBranchConfigs",N.name,"conditionArgs",d.name,"secondArg","bindValueType"]);return(0,n.jsxs)("div",{className:"dis-sb",children:[(0,n.jsx)(J.Z.Item,{name:[d.name,"compareType"],noStyle:!0,children:(0,n.jsx)(Ke.default,{popupMatchSelectWidth:!1,options:bo,optionLabelProp:"displayValue",style:{marginRight:"10px",width:54}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(J.Z.Item,{name:[d.name,"firstArg","bindValue"],children:(0,n.jsx)(Vn.Z,{isDisabled:!0,form:e,fieldName:["conditionBranchConfigs",N.name,"conditionArgs",d.name,"firstArg","bindValue"],placeholder:"\u8BF7\u5F15\u7528\u53C2\u6570",style:{width:g.length>1?150:180}})}),(0,n.jsx)(J.Z.Item,{name:[d.name,"secondArg","bindValue"],children:(0,n.jsx)(Vn.Z,{form:e,referenceType:y,style:{width:g.length>1?150:180},fieldName:["conditionBranchConfigs",N.name,"conditionArgs",d.name,"secondArg","bindValue"]})})]}),g.length>1&&(0,n.jsx)(je.ZP,{type:"text",icon:(0,n.jsx)(Lt.Z,{}),onClick:function(){C.remove(d.name)}})]},d.name)})})}),(0,n.jsx)(je.ZP,{type:"primary",onClick:function(){C.add({compareType:"EQUAL",firstArg:null,secondArg:null})},icon:(0,n.jsx)(en.Z,{}),children:"\u65B0\u589E"})]})}})]})]}))}},m.uuid)}return(0,n.jsx)("div",{className:"condition-card-style",children:"\u5426\u5219"},N.name)}),v.placeholder]}))}})}})})},mi=hi,Vt=L(61412),Ci=L(86265),yi=L(2214),Or=L(51249),xi=function(t){var e=t.form,r=t.type,a=t.nodeConfig,o=t.id,l=(0,j.useState)(!1),s=me()(l,2),u=s[0],c=s[1],v=(0,Re.useModel)("workflowV3"),N=v.setIsModified,h=v.referenceList,f=[{firstArg:{bindValue:null,bindValueType:null},secondArg:{bindValue:null,bindValueType:null},compareType:null},{firstArg:{bindValue:null,bindValueType:null},secondArg:{bindValue:null,bindValueType:null},compareType:null}],m=J.Z.useWatch(se.dy.inputArgs,{form:e,preserve:!0})||[],S=function(){c(!0)};return(0,j.useEffect)(function(){e.getFieldValue("conditionType")||e.setFieldValue("conditionType","AND")},[e.getFieldValue("conditionType")]),(0,n.jsxs)("div",{children:[r==="TableSQL"&&(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:"\u8F93\u5165",fieldConfigs:ze,inputItemName:se.dy.inputArgs,form:e})}),r!=="TableDataAdd"&&r!=="TableSQL"&&(0,n.jsxs)("div",{className:"node-item-style",children:[(0,n.jsx)("p",{className:"node-title-style",children:r==="TableDataDelete"?"\u5220\u9664\u6761\u4EF6":r==="TableDataUpdate"?"\u66F4\u65B0\u6761\u4EF6":"\u67E5\u8BE2\u6761\u4EF6"}),(0,n.jsx)(J.Z.Item,{children:(0,n.jsxs)($n.Z,{children:[(0,n.jsx)(J.Z.Item,{noStyle:!0,shouldUpdate:function(k,g){return k.conditionArgs!==g.conditionArgs},children:function(k){var g=k.getFieldValue,C=g("conditionArgs");return C?.length>1&&(0,n.jsx)(J.Z.Item,{name:"conditionType",style:{marginTop:"-26px"},initialValue:"AND",children:(0,n.jsx)(Ke.default,{style:{marginRight:"4px",width:54},options:[{label:"\u4E14",value:"AND"},{label:"\u6216",value:"OR"}]})})}}),(0,n.jsx)(J.Z.List,{name:"conditionArgs",initialValue:f,children:function(k,g){return(0,n.jsxs)("div",{className:"position-relative",children:[k.length>=1?(0,n.jsx)("div",{className:"dis-left",children:(0,n.jsx)("div",{className:"dis-col",children:k.map(function(C){var d=e.getFieldValue(["conditionArgs",C.name,"secondArg","bindValueType"]);return(0,n.jsxs)("div",{className:"dis-sb",children:[(0,n.jsx)(J.Z.Item,{name:[C.name,"compareType"],noStyle:!0,children:(0,n.jsx)(Ke.default,{popupMatchSelectWidth:!1,options:wo,optionLabelProp:"displayValue",style:{marginRight:"10px",width:54}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(J.Z.Item,{name:[C.name,"firstArg","bindValue"],children:(0,n.jsx)(Ke.default,{placeholder:"\u8BF7\u9009\u62E9",options:e.getFieldValue("tableFields"),fieldNames:{label:"name",value:"key"},style:{width:k.length>1?150:180}})}),(0,n.jsx)(J.Z.Item,{name:[C.name,"secondArg","bindValue"],children:(0,n.jsx)(Vn.Z,{form:e,referenceType:d,style:{width:k.length>1?150:180},fieldName:["conditionArgs",C.name,"secondArg","bindValue"]})})]}),(0,n.jsx)(je.ZP,{type:"text",icon:(0,n.jsx)(Lt.Z,{}),onClick:function(){g.remove(C.name)}})]},C.name)})})}):(0,n.jsx)(Tt.Z,{description:"\u5F53\u524D\u67E5\u8BE2\u6570\u636E\u4E3A\u7A7A"}),(0,n.jsx)(je.ZP,{type:"primary",onClick:function(){g.add({compareType:"EQUAL",firstArg:null,secondArg:null})},icon:(0,n.jsx)(en.Z,{}),children:"\u6DFB\u52A0\u6761\u4EF6"})]})}})]})})]}),(r==="TableDataAdd"||r==="TableDataUpdate")&&(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Vt.Z,{title:r==="TableDataAdd"?"\u8F93\u5165":"\u9009\u62E9\u66F4\u65B0\u5B57\u6BB5",form:e,options:e.getFieldValue("tableFields")||[],showAdd:r==="TableDataUpdate",params:e.getFieldValue("inputArgs")||[],showDelete:r==="TableDataUpdate",descText:"\u53D8\u91CF\u503C"})}),r==="TableDataQuery"&&(0,n.jsxs)("div",{className:"node-item-style",children:[(0,n.jsx)("div",{className:" margin-bottom",children:(0,n.jsx)("span",{className:"node-title-style ",children:"\u67E5\u8BE2\u4E0A\u9650"})}),(0,n.jsx)(J.Z.Item,{name:"limit",children:(0,n.jsx)(Or.Z,{min:1,max:1e3,placeholder:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u4E0A\u9650"})})]}),(0,n.jsxs)("div",{className:"node-item-style",children:[(0,n.jsx)("div",{className:"dis-sb margin-bottom ",children:(0,n.jsx)("span",{className:"node-title-style",children:"\u6570\u636E\u8868"})}),e.getFieldValue("tableId")?(0,n.jsx)(Ci.Z,{icon:e.getFieldValue("icon"),name:e.getFieldValue("name"),description:e.getFieldValue("description"),params:e.getFieldValue("tableFields").map(function(b){return b.name})||[],showParams:r==="TableSQL"}):null]}),r==="TableSQL"&&(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Hn.Z,{title:"SQL",inputFieldName:"sql",onExpand:!0,onOptimize:!0,onOptimizeClick:S,placeholder:"\u53EF\u4EE5\u4F7F\u7528{{\u53D8\u91CF\u540D}}\u3001{{\u53D8\u91CF\u540D.\u5B50\u53D8\u91CF\u540D}}\u3001 {{\u53D8\u91CF\u540D[\u6570\u7EC4\u7D22\u5F15]}}\u7684\u65B9\u5F0F\u5F15\u7528\u8F93\u51FA\u53C2\u6570\u4E2D\u7684\u53D8\u91CF",variables:(0,Sn.z)(m.filter(function(b){return!["",null,void 0].includes(b.name)}),h?.argMap)})}),r==="TableSQL"||r==="TableDataQuery"?(0,n.jsx)(J.Z.Item,{name:"inputArgs",children:(0,n.jsx)(wn.Z,{title:"\u8F93\u51FA",inputItemName:"outputArgs",params:a?.outputArgs||[],form:e,showCheck:!0,isNotAdd:!0},"".concat(r,"-").concat(o,"-outputArgs"))}):(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,children:function(){return e.getFieldValue("outputArgs")&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"node-title-style margin-bottom",children:"\u8F93\u51FA"}),(0,n.jsx)(Cn,{treeData:e.getFieldValue("outputArgs")})]})}}),(0,n.jsx)(yi.Z,{title:"\u751F\u6210sql\u8BED\u53E5",open:u,onCancel:function(){c(!1)},onReplace:function(k){if(k){var g=k;g.includes("```")&&(g=g.replace(/```/g,""));var C=g.startsWith("sql")?g.replace("sql","").trim():g.trim();e.setFieldsValue({sql:C||""}),N(!0)}},tableId:e.getFieldValue("tableId"),inputArgs:e.getFieldValue("inputArgs")})]})},Xn=xi,Gr=L(63960),Ni="\u68C0\u7D22\u5173\u952E\u8BCD",sn="knowledgeBaseConfigs",Wr="inputArgs",Ii=function(t){var e=t.form,r=t.type,a=t.id,o=(0,j.useState)(!1),l=me()(o,2),s=l[0],u=l[1],c=(0,Re.useModel)("workflowV3"),v=c.setIsModified,N=(0,j.useState)([]),h=me()(N,2),f=h[0],m=h[1],S=function(){u(!0)},b=function(I){var w=e.getFieldValue(sn)||[];I.type=I.targetType,I.knowledgeBaseId=I.targetId,e.setFieldValue(sn,w.concat(I)),v(!0),e.submit(),u(!1),m([].concat(Ee()(f),[{type:I.targetType,targetId:I.targetId,status:Se.BQ.Added}]))},k=function(I){var w=e.getFieldValue(sn);if(w){var A=w.filter(function(D){return D.knowledgeBaseId!==I.knowledgeBaseId});e.setFieldValue(sn,A),v(!0),e.submit()}},g=function(I){v(!0);var w=e.getFieldValue(sn);if(w){var A=w.map(function(D){return D.knowledgeBaseId===I.knowledgeBaseId?I:D});e.setFieldValue(sn,A),e.submit()}},C=e.getFieldValue(sn);(0,j.useEffect)(function(){var y=C?.map(function(I){return{type:I.type,targetId:I.knowledgeBaseId,status:Se.BQ.Added}})||[];m(y)},[C]);var d=(e?.getFieldValue(Wr)||[]).map(function(y){return x()(x()({},y),{},{description:y.description||Ni})});return(0,n.jsxs)("div",{className:"knowledge-node",children:[(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Vt.Z,{title:"\u8F93\u5165",form:e,params:d},"".concat(r,"-").concat(a,"-").concat(Wr))}),(0,n.jsxs)("div",{className:"node-item-style",children:[(0,n.jsxs)("div",{className:"dis-sb margin-bottom",children:[(0,n.jsx)("span",{className:"node-title-style",children:"\u77E5\u8BC6\u5E93"}),(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(en.Z,{}),size:"small",onClick:S})]}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){return e.getFieldValue(sn)?(0,n.jsx)(Zr,{skillName:sn,params:e.getFieldValue(sn),form:e,modifyItem:g,removeItem:k}):(0,n.jsx)(Tt.Z,{})}})]}),(0,n.jsxs)("div",{className:"knowledge-node-box node-item-style",children:[(0,n.jsxs)("div",{className:"dis-sb mb-16",children:[(0,n.jsxs)("div",{className:"knowlegenow-left-title flex items-center",children:[(0,n.jsx)("span",{children:"\u641C\u7D22\u7B56\u7565"}),(0,n.jsx)(on.Z,{title:"\u4ECE\u77E5\u8BC6\u5E93\u4E2D\u83B7\u53D6\u77E5\u8BC6\u7684\u68C0\u7D22\u65B9\u5F0F\uFF0C\u4E0D\u540C\u7684\u68C0\u7D22\u7B56\u7565\u53EF\u4EE5\u66F4\u6709\u6548\u5730\u627E\u5230\u6B63\u786E\u7684\u4FE1\u606F\uFF0C\u63D0\u9AD8\u5176\u751F\u6210\u7684\u7B54\u6848\u7684\u51C6\u786E\u6027\u548C\u53EF\u7528\u6027",icon:(0,n.jsx)(fn.Z,{})})]}),(0,n.jsx)(J.Z.Item,{name:["searchStrategy"],noStyle:!0,children:(0,n.jsx)(Ke.default,{className:"flex-1",options:[{label:"\u8BED\u4E49",value:"SEMANTIC"},{label:"\u6DF7\u5408",value:"MIXED"},{label:"\u5168\u6587",value:"FULL_TEXT"}]})})]}),(0,n.jsxs)("div",{className:"dis-sb mb-16",children:[(0,n.jsxs)("div",{className:"knowlegenow-left-title flex items-center",children:[(0,n.jsx)("span",{children:"\u6700\u5927\u53EC\u56DE\u6570\u91CF"}),(0,n.jsx)(on.Z,{title:"\u4ECE\u77E5\u8BC6\u5E93\u4E2D\u8FD4\u56DE\u7ED9\u5927\u6A21\u578B\u7684\u6700\u5927\u6BB5\u843D\u6570\uFF0C\u6570\u503C\u8D8A\u5927\u8FD4\u56DE\u7684\u5185\u5BB9\u8D8A\u591A",icon:(0,n.jsx)(fn.Z,{})})]}),(0,n.jsx)(J.Z.Item,{name:["maxRecallCount"],noStyle:!0,children:(0,n.jsx)(Gr.Z,{min:1,max:20,step:1,marks:{1:1,20:20},className:"flex-1"})})]}),(0,n.jsxs)("div",{className:"dis-sb ",children:[(0,n.jsxs)("div",{className:"knowlegenow-left-title flex items-center",children:[(0,n.jsx)("span",{children:"\u6700\u5C0F\u5339\u914D\u5EA6"}),(0,n.jsx)(on.Z,{title:"\u6839\u636E\u8BBE\u7F6E\u7684\u5339\u914D\u5EA6\u9009\u53D6\u6BB5\u843D\u8FD4\u56DE\u7ED9\u5927\u6A21\u578B\uFF0C\u4F4E\u4E8E\u8BBE\u5B9A\u5339\u914D\u5EA6\u7684\u5185\u5BB9\u4E0D\u4F1A\u88AB\u53EC\u56DE",icon:(0,n.jsx)(fn.Z,{})})]}),(0,n.jsx)(J.Z.Item,{name:"matchingDegree",noStyle:!0,children:(0,n.jsx)(Gr.Z,{min:.01,max:.99,step:.01,marks:{.01:.01,.99:.99},className:"flex-1"})})]})]}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,children:function(){return e.getFieldValue("outputArgs")&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"node-title-style margin-bottom",children:"\u8F93\u51FA"}),(0,n.jsx)(Cn,{treeData:e.getFieldValue("outputArgs")})]})}}),(0,n.jsx)(It.Z,{checkTag:Se.qR.Knowledge,onAdded:b,open:s,onCancel:function(){return u(!1)},addComponents:f,hideTop:[Se.qR.Table,Se.qR.Agent,Se.qR.Plugin,Se.qR.Workflow,Se.qR.MCP]})]})},Ei={KnowledgeNode:Ii},bi=L(6898),Mr=L(54816),Hr=L(55654),Bt=L(73981),Ur=L(44384),wi=function(t){var e=t.form,r=t.nodeId,a=(0,Re.useModel)("workflowV3"),o=a.setIsModified,l=a.referenceList,s=a.getValue,u=J.Z.useWatch("variableGroups",{form:e,preserve:!0})||[],c=J.Z.useWatch("inputArgs",{form:e,preserve:!0}),v=j.useRef(!1),N=j.useRef(r),h=j.useRef(!1);(0,j.useEffect)(function(){r!==void 0&&N.current!==r&&(v.current=!1,h.current=!0,N.current=r)},[r]),(0,j.useEffect)(function(){if(!(v.current&&!h.current)&&c!=null&&c.length){var A=c.some(function(R){var P=R.dataType===i.Gi.Object||R.dataType===i.Gi.Array_Object,G=(R.subArgs||R.children||[]).some(function(B){return B.bindValue});return P&&G}),D=Object.keys(l?.argMap||{});if(!(A&&D.length===0)){var E=c.map(function(R){return{id:R.key||(0,Xe.Z)(),name:R.name||"Group",dataType:R.dataType||i.Gi.String,inputs:(R.subArgs||R.children||[]).map(function(P){var G,B,Y,le=P.bindValue||"",re=l==null||(G=l.argMap)===null||G===void 0?void 0:G[le],Q=re?.subArgs||re?.children||[];return{key:P.key||(0,Xe.Z)(),name:P.name||"",dataType:P.dataType||i.Gi.String,description:P.description||"",require:(B=P.require)!==null&&B!==void 0?B:!1,systemVariable:(Y=P.systemVariable)!==null&&Y!==void 0?Y:!1,bindValue:le,bindValueType:P.bindValueType||"Reference",subArgs:Q.length>0?Q:P.subArgs||P.children||[]}})||[]}});E.length>0&&(v.current=!0,h.current=!1,e.setFieldsValue({variableGroups:E}))}}},[c,e,l]),(0,j.useEffect)(function(){if(v.current){if(!u||u.length===0){e.setFieldsValue({inputArgs:[],outputArgs:[]});return}var A=function R(P){var G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return!P||P.length===0?[]:P.map(function(B,Y){var le,re,Q="out_".concat(G,"_").concat(Y,"_").concat((0,Xe.Z)());return{name:B.name||"",dataType:B.dataType||i.Gi.String,description:B.description||"",require:(le=B.require)!==null&&le!==void 0?le:!1,systemVariable:(re=B.systemVariable)!==null&&re!==void 0?re:!1,bindValue:"",key:Q,subArgs:R(B.subArgs||B.children,Q)}})},D=u.map(function(R){var P={key:R.id||R.name||(0,Xe.Z)(),name:R.name||"Group",dataType:R.dataType||i.Gi.String,description:"".concat(R.name||"Group"," ").concat(Tn.zx[R.dataType||i.Gi.String]||""),require:!1,systemVariable:!1,bindValue:""};return Array.isArray(R.inputs)&&R.inputs.length>0&&(P.subArgs=R.inputs.map(function(G){var B,Y;return{key:G.key||(0,Xe.Z)(),name:G.name||"",dataType:G.dataType||i.Gi.String,description:G.description||"",require:(B=G.require)!==null&&B!==void 0?B:!1,systemVariable:(Y=G.systemVariable)!==null&&Y!==void 0?Y:!1,bindValue:G.bindValue||"",bindValueType:G.bindValueType||"Reference",subArgs:G.subArgs||[]}})),P}),E=u.map(function(R){var P=R.dataType===i.Gi.Object||R.dataType===i.Gi.Array_Object,G=(R.inputs||[]).find(function(le){return le.bindValue}),B={name:R.name||"Group",dataType:R.dataType||i.Gi.String,description:"".concat(R.name||"Group"," ").concat(Tn.zx[R.dataType||i.Gi.String]||""),require:!1,systemVariable:!1,bindValue:"",key:R.id||R.name||(0,Xe.Z)()},Y=G?.subArgs||G?.children;return P&&Y&&Y.length>0&&(B.subArgs=A(Y)),B});e.setFieldsValue({inputArgs:D,outputArgs:E})}},[u,e]);var f=function(D){e.setFieldsValue({variableGroups:D}),o(!0)},m=function(){var D={key:(0,Xe.Z)(),name:"",bindValue:"",bindValueType:"Reference",dataType:i.Gi.String,description:"",require:!1,systemVariable:!1},E={id:(0,Xe.Z)(),name:"Group".concat(u.length+1),dataType:i.Gi.String,inputs:[D]};f([].concat(Ee()(u),[E]))},S=function(D){var E=u.filter(function(R,P){return P!==D});f(E)},b=function(D,E){var R=u.map(function(P,G){return G===D?x()(x()({},P),E):P});f(R)},k=function(D){var E=u[D],R={key:(0,Xe.Z)(),name:"",bindValue:"",bindValueType:"Reference",dataType:i.Gi.String,description:"",require:!1,systemVariable:!1};b(D,{inputs:[].concat(Ee()(E.inputs||[]),[R])})},g=function(D,E){var R=u[D],P=(R.inputs||[]).filter(function(Y,le){return le!==E});if(E===0&&P.length>0){var G=P[0],B=G.dataType||i.Gi.String;b(D,{inputs:P,dataType:B})}else P.length===0?b(D,{inputs:P,dataType:i.Gi.String}):b(D,{inputs:P})},C=function(D,E,R){var P,G=u[D],B=l==null||(P=l.argMap)===null||P===void 0?void 0:P[R];if(B){var Y=B.dataType||i.Gi.String,le=B.name||"",re=B.subArgs||B.children||[],Q={bindValue:R,bindValueType:"Reference",dataType:Y,name:le,subArgs:re},O=(G.inputs||[]).map(function(U,Z){return Z===E?x()(x()({},U),Q):U});E===0||(G.inputs||[]).filter(function(U){return U.bindValue}).length===0?b(D,{inputs:O,dataType:Y}):b(D,{inputs:O})}},d=function(D,E){var R=u[D],P=(R.inputs||[]).map(function(B,Y){return Y===E?x()(x()({},B),{},{bindValue:"",bindValueType:"Input",name:"",subArgs:[]}):B});if(E===0){var G=P.find(function(B,Y){return Y>0&&B.bindValue});G&&G.dataType?b(D,{inputs:P,dataType:G.dataType}):b(D,{inputs:P,dataType:i.Gi.String})}else b(D,{inputs:P})},y=function(D){var E,R=(D.inputs||[]).find(function(P){return P.bindValue});return(E=R?.dataType)!==null&&E!==void 0?E:void 0},I=function(D){return new Set((D.inputs||[]).map(function(E){return E.bindValue}).filter(Boolean))},w=function(D){var E=D.dataType||i.Gi.String;return Tn.zx[E]||E};return{variableGroups:u,referenceList:l,getValue:s,handleAddGroup:m,handleRemoveGroup:S,handleUpdateGroup:b,handleAddInput:k,handleRemoveInput:g,handleReferenceSelect:C,handleClearReference:d,getGroupAllowedType:y,getSelectedKeys:I,getGroupTypeDisplay:w}},Zt=L(21862),Si=L(58176),ki=function(t){var e=t.displayValue,r=t.allowedType,a=t.selectedKeys,o=t.previousNodes,l=t.onSelect,s=t.onClear,u=(0,j.useRef)(0),c=(0,j.useState)(!1),v=me()(c,2),N=v[0],h=v[1],f=function b(k,g,C,d){return k.map(function(y){var I=y.key||"",w=C.has(I)||g&&y.dataType!==g,A=y.children?b(y.children,g,C,d):void 0,D="".concat(d,"_").concat(I,"__").concat(u.current++);return x()(x()({},y),{},{key:D,originalKey:I,disabled:w,children:A})}).filter(function(y){return!C.has(y.originalKey||"")})},m=function(k){var g=k.disabled;return(0,n.jsxs)("div",{className:"tree-custom-title-style tree-title-container ".concat(g?"disabled":""),children:[(0,n.jsx)("span",{children:k.name}),(0,n.jsx)(Je.Z,{content:k.description||"\u6682\u65E0\u63CF\u8FF0",children:(0,n.jsx)(fn.Z,{style:{marginLeft:"4px",fontSize:12,cursor:"help"}})}),(0,n.jsx)(He.Z,{color:"#C9CDD4",style:{marginLeft:8,fontSize:10,lineHeight:"14px"},children:k.dataType})]})},S=function(k){return k!=null&&k.length?k.map(function(g){var C=f(g.outputArgs||[],r,a,String(g.id));return{key:g.id,label:g.name.length>12?g.name.slice(0,12)+"...":g.name,icon:st(g.type),popupClassName:"inputOrReferencePopup",children:[{key:"".concat(g.id,"-tree"),label:(0,n.jsx)("div",{className:"tree-container",onClick:function(y){return y.stopPropagation()},children:(0,n.jsx)(Lr.Z,{onSelect:function(y,I){var w=I.node;w.originalKey&&(l(w.originalKey),h(!1))},defaultExpandAll:!0,treeData:C,fieldNames:{title:"name",key:"key",children:"children"},titleRender:m,blockNode:!0,className:"custom-tree-style custom-tree"})})}]}}):[{key:"no-data",label:(0,n.jsx)("div",{className:"no-data-tip",children:"\u672A\u6DFB\u52A0\u4E0A\u7EA7\u8282\u70B9\u8FDE\u7EBF\u6216\u4E0A\u7EA7\u8282\u70B9\u65E0\u53C2\u6570"}),disabled:!0}]};return(0,n.jsxs)("div",{className:"dis-sb variable-selector-container",children:[e?(0,n.jsx)(He.Z,{closable:!0,onClose:s,className:"input-or-reference-tag text-ellipsis variable-tag",color:"#C9CDD4",children:e.length>15?(0,n.jsx)(Je.Z,{content:e,placement:"topRight",children:(0,n.jsx)("span",{className:"tag-text-style",children:e})}):(0,n.jsx)("span",{className:"tag-text-style",children:e})}):(0,n.jsx)("span",{className:"placeholder-text",children:"\u9009\u62E9\u53D8\u91CF"}),(0,n.jsx)(Si.Z,{menu:{items:S(o)},trigger:["click"],open:N,onOpenChange:h,overlayStyle:{minWidth:200},placement:"bottomRight",children:(0,n.jsx)(Rt.Z,{style:{cursor:"pointer"},className:"input-reference-icon-style"})})]})},ji=ki,Fi=function(t){var e=t.group,r=t.groupIndex,a=t.previousNodes,o=t.getValue,l=t.getGroupTypeDisplay,s=t.getGroupAllowedType,u=t.getSelectedKeys,c=t.onUpdateGroup,v=t.onRemoveGroup,N=t.onAddInput,h=t.onRemoveInput,f=t.onReferenceSelect,m=t.onClearReference;return(0,n.jsxs)("div",{className:"form-list-style group-item-container",children:[(0,n.jsxs)("div",{className:"dis-sb group-header",children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",flex:1},children:[(0,n.jsx)(Ge.Z,{size:"small",placeholder:"\u5206\u7EC4\u540D\u79F0",value:e.name,onChange:function(b){return c(r,{name:b.target.value})},className:"group-name-input"}),(0,n.jsx)(He.Z,{color:"#C9CDD4",className:"group-type-tag",children:l(e)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(en.Z,{}),onClick:function(){return N(r)},size:"small",type:"text",className:"action-button"}),(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(Zt.Z,{}),onClick:function(){return v(r)},size:"small",type:"text",className:"action-button"})]})]}),(e.inputs||[]).map(function(S,b){return(0,n.jsxs)("div",{className:"dis-sb variable-reference-item",children:[(0,n.jsx)(ji,{displayValue:S.bindValue?o(S.bindValue):"",allowedType:s(e),selectedKeys:u(e),previousNodes:a,onSelect:function(g){return f(r,b,g)},onClear:function(){return m(r,b)}}),(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(Zt.Z,{}),size:"small",type:"text",onClick:function(){return h(r,b)},className:"remove-input-button"})]},S.key||b)}),(!e.inputs||e.inputs.length===0)&&(0,n.jsx)("div",{className:"group-empty-tip",children:"\u70B9\u51FB + \u6DFB\u52A0\u53D8\u91CF\u5F15\u7528"})]})},Ai=Fi,Di=function(t){var e=t.form,r=t.id,a=[{label:"\u8FD4\u56DE\u6BCF\u4E2A\u5206\u7EC4\u4E2D\u7B2C\u4E00\u4E2A\u975E\u7A7A\u7684\u503C",value:"FIRST_NON_NULL"}],o=(0,j.useRef)(0),l=function w(A){return!A||A.length===0?[]:A.map(function(D){return x()(x()({},D),{},{key:"".concat(D.key||D.name,"_").concat(o.current++),subArgs:w(D.subArgs)})})},s=wi({form:e,nodeId:r}),u=s.variableGroups,c=s.referenceList,v=s.getValue,N=s.handleAddGroup,h=s.handleRemoveGroup,f=s.handleUpdateGroup,m=s.handleAddInput,S=s.handleRemoveInput,b=s.handleReferenceSelect,k=s.handleClearReference,g=s.getGroupAllowedType,C=s.getSelectedKeys,d=s.getGroupTypeDisplay,y=J.Z.useWatch("outputArgs",{form:e,preserve:!0})||[],I=(0,j.useMemo)(function(){return o.current=0,l(y)},[y]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"node-item-style",children:[(0,n.jsx)("div",{className:"node-title-style margin-bottom",children:"\u805A\u5408\u7B56\u7565"}),(0,n.jsx)(J.Z.Item,{name:"aggregationStrategy",children:(0,n.jsx)("select",{className:"ant-select ant-select-sm aggregation-strategy-select",children:a.map(function(w){return(0,n.jsx)("option",{value:w.value,children:w.label},w.value)})})})]}),(0,n.jsxs)("div",{className:"node-item-style",children:[(0,n.jsxs)("div",{className:"dis-sb margin-bottom",children:[(0,n.jsx)("span",{className:"node-title-style",children:"\u5206\u7EC4\u914D\u7F6E"}),(0,n.jsx)(je.ZP,{onClick:N,icon:(0,n.jsx)(en.Z,{}),size:"small",type:"text"})]}),u.map(function(w,A){return(0,n.jsx)(Ai,{group:w,groupIndex:A,previousNodes:c.previousNodes||[],getValue:v,getGroupTypeDisplay:d,getGroupAllowedType:g,getSelectedKeys:C,onUpdateGroup:f,onRemoveGroup:h,onAddInput:m,onRemoveInput:S,onReferenceSelect:b,onClearReference:k},w.id||A)}),u.length===0&&(0,n.jsx)("div",{className:"empty-state-tip",children:"\u70B9\u51FB + \u6DFB\u52A0\u5206\u7EC4"})]}),I.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"node-title-style margin-bottom",children:"\u8F93\u51FA"}),(0,n.jsx)(Cn,{treeData:I})]})]})},Ti=Di,Ri=function(t){var e=t.form,r=t.nodeConfig,a=t.id,o=t.type;return(0,n.jsx)(J.Z.Item,{name:"inputArgs",children:(0,n.jsx)(wn.Z,{title:"\u8F93\u5165",inputItemName:"inputArgs",params:r?.inputArgs||[],form:e,showCheck:!0},"".concat(o,"-").concat(a,"-inputArgs"))})},Li=function(t){var e=t.form;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:"\u8F93\u5165",fieldConfigs:ze,inputItemName:se.dy.inputArgs,form:e,disabledAdd:!0,disabledDelete:!0,disabledInput:!0})}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,children:function(){return e.getFieldValue("outputArgs")&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"node-title-style margin-bottom",children:"\u8F93\u51FA"}),(0,n.jsx)(Cn,{treeData:e.getFieldValue("outputArgs")})]})}})]})},Pi=function(t){var e=t.form,r=t.type,a=(0,Re.useModel)("workflowV3"),o=a.referenceList,l=[{label:"\u8FD4\u56DE\u53D8\u91CF",value:"VARIABLE"},{label:"\u8FD4\u56DE\u6587\u672C",value:"TEXT"}],s=J.Z.useWatch(se.dy.outputArgs,{form:e,preserve:!0})||[];return(0,n.jsxs)(n.Fragment,{children:[r==="End"&&(0,n.jsx)("div",{className:"dis-center",children:(0,n.jsx)(J.Z.Item,{name:"returnType",children:(0,n.jsx)(Bt.Z,{options:l,style:{marginBottom:"10px"}})})}),(0,n.jsx)("div",{className:e.getFieldValue("returnType")!=="VARIABLE"?"node-item-style":"",children:(0,n.jsx)(Ye,{title:"\u8F93\u51FA\u53D8\u91CF",form:e,fieldConfigs:ze,showCopy:!0,inputItemName:se.dy.outputArgs})}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,children:function(){return e.getFieldValue("returnType")!=="VARIABLE"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"dis-sb margin-bottom",children:(0,n.jsxs)("span",{className:"node-title-style gap-6 flex items-center",children:["\u8F93\u51FA\u5185\u5BB9",(0,n.jsx)(on.Z,{title:"\u53EF\u4EE5\u5728\u4EE5\u4E0B\u8F93\u5165\u6846\u4E2D\u91CD\u65B0\u7EC4\u7EC7\u8F93\u51FA\u5185\u5BB9\uFF0C\u5927\u6A21\u578B\u5C06\u4F18\u5148\u4F7F\u7528\u8F93\u5165\u6846\u4E2D\u7684\u5185\u5BB9\u3002",icon:(0,n.jsx)(Un.Z,{})})]})}),(0,n.jsx)(J.Z.Item,{name:"content",getValueFromEvent:function(v){return typeof v=="string"?(0,Hr.extractTextFromHTML)(v):""},children:(0,n.jsx)(Mr.Z,{placeholder:"\u53EF\u4EE5\u4F7F\u7528{{\u53D8\u91CF\u540D}}\u3001{{\u53D8\u91CF\u540D.\u5B50\u53D8\u91CF\u540D}}\u3001{{\u53D8\u91CF\u540D[\u6570\u7EC4 \u7D22\u5F15]}}\u7684\u65B9\u5F0F\u5F15\u7528\u8F93\u51FA\u53C2\u6570\u4E2D\u7684\u53D8\u91CF",style:{minHeight:"80px",marginBottom:"10px"},variables:(0,Sn.z)(s.filter(function(c){return!["",null,void 0].includes(c.name)}),o?.argMap)})})]})}})]})},Vi=function(t){var e=t.form;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"node-item-style",children:[(0,n.jsxs)("span",{className:"node-title-style margin-bottom gap-6 flex items-center",children:["\u5FAA\u73AF\u8BBE\u7F6E",(0,n.jsx)(on.Z,{title:"\u5982\u679C\u5F15\u7528\u6570\u7EC4\uFF0C\u5FAA\u73AF\u6B21\u6570\u4E3A\u6570\u7EC4\u7684\u957F\u5EA6\uFF1B\u5982\u679C\u6307\u5B9A\u6B21\u6570\uFF0C\u5FAA\u73AF\u6B21\u6570\u4E3A\u6307\u5B9A\u7684\u6B21\u6570\uFF1B\u5982\u679C\u9009\u62E9\u65E0\u9650\u5FAA\u73AF\uFF0C\u9700\u914D\u5408\u201C\u7EC8\u6B62\u5FAA\u73AF\u201D\u8282\u70B9\u5B8C\u6210\u5FAA\u73AF\u6D41\u7A0B\u3002",icon:(0,n.jsx)(Un.Z,{})})]}),(0,n.jsx)(J.Z.Item,{name:"loopType",children:(0,n.jsx)(Ke.default,{options:Eo,style:{width:"100%",marginBottom:"10px"}})})]}),(0,n.jsx)(J.Z.Item,{noStyle:!0,shouldUpdate:function(a,o){return a.loopType!==o.loopType},children:function(){var a=e.getFieldValue("loopType");return a==="SPECIFY_TIMES_LOOP"?(0,n.jsxs)("div",{className:"node-item-style",children:[(0,n.jsx)("div",{className:"node-title-style margin-bottom",children:"\u5FAA\u73AF\u6B21\u6570"}),(0,n.jsx)(J.Z.Item,{name:"loopTimes",children:(0,n.jsx)(Or.Z,{size:"small",style:{width:"100%",marginBottom:"10px"},placeholder:"\u8BF7\u8F93\u5165\u5FAA\u73AF\u6B21\u6570\uFF0C\u5E76\u4E14\u503C\u4E3A\u6B63\u6574\u6570",min:1,precision:0})})]}):a==="ARRAY_LOOP"?(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:"\u5FAA\u73AF\u6570\u7EC4",fieldConfigs:ze,inputItemName:se.dy.inputArgs,form:e})}):null}}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:(0,n.jsxs)(n.Fragment,{children:["\u4E2D\u95F4\u53D8\u91CF",(0,n.jsx)(on.Z,{title:"\u53D8\u91CF\u53EF\u5728\u591A\u6B21\u5FAA\u73AF\u4E2D\u5B9E\u73B0\u5171\u4EAB\uFF0C\u53EF\u7528\u4E8E\u5728\u591A\u6B21\u5FAA\u73AF\u4E2D\u4F20\u9012\u53D8\u91CF\u3002",icon:(0,n.jsx)(Un.Z,{})})]}),fieldConfigs:ze,inputItemName:se.dy.variableArgs,form:e,isVariable:!0})}),(0,n.jsx)(Ye,{title:"\u8F93\u51FA",fieldConfigs:ze,inputItemName:se.dy.outputArgs,form:e,isLoop:!0})]})},Bi=function(t){var e=t.form,r=Ia,a=e.getFieldValue("configType"),o=a===se.Do.SET_VARIABLE;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J.Z.Item,{name:"configType",style:{display:"flex",justifyContent:"center"},children:(0,n.jsx)(Bt.Z,{options:r})}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){return o?(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:"\u8BBE\u7F6E\u53D8\u91CF",fieldConfigs:ze,inputItemName:se.dy.inputArgs,form:e})}):null}}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){return o?null:(0,n.jsx)(ri,{title:"\u8F93\u51FA\u53D8\u91CF",fieldConfigs:ze,inputItemName:se.dy.outputArgs,form:e})}}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){return o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"node-title-style margin-bottom",children:"\u8F93\u51FA"}),(0,n.jsx)(Cn,{treeData:[{name:"isSuccess",dataType:i.Gi.Boolean,description:"",require:!0,systemVariable:!1,bindValue:"",key:"outputArray"}]})]}):null}})]})},Zi=function(t){var e=t.form,r=(0,Re.useModel)("workflowV3"),a=r.referenceList,o=[{label:"\u5B57\u7B26\u4E32\u62FC\u63A5",value:"CONCAT"},{label:"\u5B57\u7B26\u4E32\u5206\u5272",value:"SPLIT"}],l=(0,j.useState)([{value:"\\n",label:"\u6362\u884C (\\n)"},{value:"\\t",label:"\u5236\u8868\u7B26 (\\t)"},{value:"\u3002",label:"\u53E5\u53F7 (\u3002)"},{value:",",label:"\u9017\u53F7 (,)"},{value:";",label:"\u5206\u53F7 (;)"},{value:"&nbsp;",label:"\u7A7A\u683C ( )"}]),s=me()(l,2),u=s[0],c=s[1],v=(0,j.useState)({label:"",value:""}),N=me()(v,2),h=N[0],f=N[1],m=J.Z.useWatch(se.dy.inputArgs,{form:e,preserve:!0})||[],S=function(k){if(k.preventDefault(),!(h.label===""||h.value==="")){var g={label:"".concat(h.label,"(").concat(h.value,")"),value:h.value};c([].concat(Ee()(u),[g])),f({label:"",value:""}),localStorage.setItem("arrayLinkSetting",JSON.stringify([].concat(Ee()(u),[g])))}};return(0,j.useEffect)(function(){var b=localStorage.getItem("arrayLinkSetting");b&&c(JSON.parse(b))},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J.Z.Item,{name:"textHandleType",style:{display:"flex",justifyContent:"center"},children:(0,n.jsx)(Bt.Z,{options:o})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:"\u8F93\u5165",fieldConfigs:ze,inputItemName:se.dy.inputArgs,form:e})}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){return e.getFieldValue("textHandleType")==="CONCAT"?(0,n.jsxs)("div",{className:"node-item-style",children:[(0,n.jsxs)("div",{className:"dis-sb margin-bottom",children:[(0,n.jsx)("span",{className:"node-title-style",children:"\u5B57\u7B26\u4E32\u62FC\u63A5"}),(0,n.jsx)(Je.Z,{placement:"topRight",content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"node-title-style",children:"\u6570\u7EC4\u8FDE\u63A5\u7B26\u8BBE\u7F6E"}),(0,n.jsx)("p",{children:"\u4F7F\u7528\u4EE5\u4E0B\u7B26\u53F7\u6765\u81EA\u52A8\u8FDE\u63A5\u6570\u7EC4\u4E2D\u7684\u6BCF\u4E2A\u9879\u76EE"}),(0,n.jsx)("p",{className:"array-link-setting-select-label",children:"\u8FDE\u63A5\u7B26"}),(0,n.jsx)(J.Z.Item,{name:"join",children:(0,n.jsx)(Ke.default,{options:u,allowClear:!0,placeholder:"\u8BF7\u9009\u62E9\u8FDE\u63A5\u7B26\u53F7",popupRender:function(g){return(0,n.jsxs)(n.Fragment,{children:[g,(0,n.jsx)(Ur.Z,{style:{margin:"8px 0"}}),(0,n.jsx)("div",{style:{padding:"8px"},className:"dis-sb",children:(0,n.jsxs)($n.Z,{children:[(0,n.jsx)(Ge.Z,{value:h.label,placeholder:"\u9009\u9879\u540D\u79F0",onChange:function(d){return f({value:h.value,label:d.target.value})},onKeyDown:function(d){return d.stopPropagation()}}),(0,n.jsx)(Ge.Z,{value:h.value,placeholder:"\u9009\u9879\u503C",onChange:function(d){return f({label:h.label,value:d.target.value})},onKeyDown:function(d){return d.stopPropagation()}}),(0,n.jsx)(je.ZP,{type:"primary",onClick:S,children:"\u6DFB\u52A0"})]})})]})},style:{width:"100%",marginBottom:"10px"}})})]}),trigger:"click",children:(0,n.jsx)(je.ZP,{type:"text",icon:(0,n.jsx)(Rt.Z,{}),size:"small"})})]}),(0,n.jsx)(J.Z.Item,{name:"text",getValueFromEvent:function(g){return typeof g=="string"?(0,Hr.extractTextFromHTML)(g):""},children:(0,n.jsx)(Mr.Z,{placeholder:"\u53EF\u4EE5\u4F7F\u7528{{\u53D8\u91CF\u540D}}\u7684\u65B9\u5F0F\u5F15\u7528\u8F93\u5165\u53C2\u6570\u4E2D\u7684\u53D8\u91CF",style:{minHeight:"80px"},variables:(0,Sn.z)(m.filter(function(k){return!["",null,void 0].includes(k.name)}),a?.argMap)})})]}):null}}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){return e.getFieldValue("textHandleType")==="SPLIT"?(0,n.jsxs)("div",{className:"node-item-style",children:[(0,n.jsx)("span",{className:"node-title-style",children:"\u5206\u9694\u7B26"}),(0,n.jsx)(J.Z.Item,{name:"splits",children:(0,n.jsx)(Ke.default,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9\u5206\u5272\u7B26\u53F7",mode:"multiple",maxTagCount:3,popupRender:function(g){return(0,n.jsxs)(n.Fragment,{children:[g,(0,n.jsx)(Ur.Z,{style:{margin:"8px 0"}}),(0,n.jsx)("div",{style:{padding:"8px"},className:"dis-sb",children:(0,n.jsxs)($n.Z,{children:[(0,n.jsx)(Ge.Z,{value:h.label,placeholder:"\u9009\u9879\u540D\u79F0",onChange:function(d){return f({value:h.value,label:d.target.value})},onKeyDown:function(d){return d.stopPropagation()}}),(0,n.jsx)(Ge.Z,{value:h.value,placeholder:"\u9009\u9879\u503C",onChange:function(d){return f({label:h.label,value:d.target.value})},onKeyDown:function(d){return d.stopPropagation()}}),(0,n.jsx)(je.ZP,{type:"primary",onClick:S,children:"\u6DFB\u52A0"})]})})]})},options:u})})]}):null}}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,children:function(){return e.getFieldValue("outputArgs")&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"node-title-style margin-bottom",children:"\u8F93\u51FA"}),(0,n.jsx)(Cn,{treeData:e.getFieldValue("textHandleType")==="CONCAT"?[{name:"output",dataType:i.Gi.String,description:"",require:!0,systemVariable:!1,bindValue:"",key:"outputArray"}]:[{name:"output",dataType:i.Gi.Array_String,description:"",require:!0,systemVariable:!1,bindValue:"",key:"outputString"}]})]})}})]})},Oi=function(t){var e=t.form,r=t.nodeConfig,a=t.type,o=t.id,l=(0,j.useState)(!1),s=me()(l,2),u=s[0],c=s[1],v=(0,Re.useModel)("workflowV3"),N=v.setIsModified,h=e.getFieldValue("codeLanguage")===dt.vQ.JavaScript?"codeJavaScript":"codePython",f=e.getFieldValue("codeLanguage")||dt.vQ.JavaScript;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Ye,{title:"\u8F93\u5165",fieldConfigs:ze,inputItemName:se.dy.inputArgs,form:e})}),(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"dis-sb margin-bottom",children:[(0,n.jsx)("span",{className:"node-title-style ",children:"\u4EE3\u7801"}),(0,n.jsx)(je.ZP,{icon:(0,n.jsx)(Rr.Z,{}),size:"small",type:"text",onClick:function(){return c(!0)}})]}),(0,n.jsx)(Tr.Z,{form:e,value:e.getFieldValue(h),onChange:function(S){e.setFieldValue(h,S),N(!0)},codeLanguage:f,height:"180px"})]})}),(0,n.jsx)(wn.Z,{title:"\u8F93\u51FA",params:r?.outputArgs||[],form:e,inputItemName:"outputArgs"},"".concat(a,"-").concat(o,"-outputArgs")),(0,n.jsx)(bi.Z,{form:e,isShow:u,close:function(){return c(!1)}})]})},yn={StartNode:Ri,EndNode:Pi,CycleNode:Vi,VariableNode:Bi,VariableAggregationNode:Ti,CodeNode:Oi,TextProcessingNode:Zi,DocumentExtractionNode:Li},Gi=function(t){var e=t.form;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,children:function(){return e.getFieldValue("inputArgs")&&(0,n.jsx)("div",{className:"node-item-style",children:(0,n.jsx)(Vt.Z,{form:e,title:"\u8F93\u5165",params:e.getFieldValue("inputArgs")})})}}),(0,n.jsx)(J.Z.Item,{shouldUpdate:!0,children:function(){return e.getFieldValue("outputArgs")&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"node-title-style margin-bottom",children:"\u8F93\u51FA"}),(0,n.jsx)(Cn,{treeData:e.getFieldValue("outputArgs")})]})}})]})},Wi={PluginInNode:Gi},Mi=yn.StartNode,$r=yn.EndNode,Hi=yn.CycleNode,Ui=yn.VariableNode,$i=yn.VariableAggregationNode,zi=yn.TextProcessingNode,Xi=yn.CodeNode,Qi=yn.DocumentExtractionNode,Ki=vt.ModelNode,Ji=vt.IntentionNode,Yi=vt.QuestionsNode,qi=vt.HttpToolNode,gt=Wi.PluginInNode,_i=Ei.KnowledgeNode,es=function(){return(0,n.jsx)("div",{className:"node-title-style",children:"\u7528\u4E8E\u7EC8\u6B62\u5F53\u524D\u5FAA\u73AF\uFF0C\u6267\u884C\u4E0B\u6B21\u5FAA\u73AF"})},ns=function(){return(0,n.jsx)("div",{className:"node-title-style",children:"\u7528\u4E8E\u7ACB\u5373\u7EC8\u6B62\u5F53\u524D\u6240\u5728\u7684\u5FAA\u73AF\uFF0C\u8DF3\u51FA\u5FAA\u73AF\u4F53"})},ts=function(t,e){var r,a=t.type,o={type:t.type,id:t.id,form:e,nodeConfig:t.nodeConfig},l=(r={},pe()(pe()(pe()(pe()(pe()(pe()(pe()(pe()(pe()(pe()(r,i.C8.Start,(0,n.jsx)(Mi,x()({},o))),i.C8.DocumentExtraction,(0,n.jsx)(Qi,x()({},o))),i.C8.End,(0,n.jsx)($r,x()({},o))),i.C8.Output,(0,n.jsx)($r,x()({},o))),i.C8.Loop,(0,n.jsx)(Hi,x()({},o))),i.C8.Variable,(0,n.jsx)(Ui,x()({},o))),i.C8.VariableAggregation,(0,n.jsx)($i,x()({},o))),i.C8.TextProcessing,(0,n.jsx)(zi,x()({},o))),i.C8.LLM,(0,n.jsx)(Ki,x()({},o))),i.C8.Plugin,(0,n.jsx)(gt,x()({},o))),pe()(pe()(pe()(pe()(pe()(pe()(pe()(pe()(pe()(pe()(r,i.C8.Workflow,(0,n.jsx)(gt,x()({},o))),i.C8.LongTermMemory,(0,n.jsx)(gt,x()({},o))),i.C8.MCP,(0,n.jsx)(gt,x()({},o))),i.C8.Code,(0,n.jsx)(Xi,x()({},o))),i.C8.QA,(0,n.jsx)(Yi,x()({},o))),i.C8.HTTPRequest,(0,n.jsx)(qi,x()({},o))),i.C8.Knowledge,(0,n.jsx)(_i,x()({},o))),i.C8.Condition,(0,n.jsx)(mi,x()({},o))),i.C8.IntentRecognition,(0,n.jsx)(Ji,x()({},o))),i.C8.LoopBreak,(0,n.jsx)(ns,{})),pe()(pe()(pe()(pe()(pe()(pe()(r,i.C8.LoopContinue,(0,n.jsx)(es,{})),i.C8.TableDataAdd,(0,n.jsx)(Xn,x()({},o))),i.C8.TableDataDelete,(0,n.jsx)(Xn,x()({},o))),i.C8.TableDataUpdate,(0,n.jsx)(Xn,x()({},o))),i.C8.TableDataQuery,(0,n.jsx)(Xn,x()({},o))),i.C8.TableSQL,(0,n.jsx)(Xn,x()({},o))));return l[a]||(0,n.jsx)(n.Fragment,{})},rs=function(t){var e=t.data,r=(0,j.useMemo)(function(){return{exceptionHandleType:i.Xy.INTERRUPT,timeout:180,retryCount:0,name:"exceptionHandleConfig"}},[]),a=(0,j.useState)(r),o=me()(a,2),l=o[0],s=o[1];return(0,j.useEffect)(function(){return s(function(u){return x()(x()({},u),e||{})}),function(){s(r)}},[]),(0,n.jsx)(_o,x()({},l))};function as(p){var t,e=p.params,r=J.Z.useFormInstance(),a=ot(e);return(0,n.jsxs)(n.Fragment,{children:[ts(e,r),a&&(0,n.jsx)(rs,{data:(t=e.nodeConfig)===null||t===void 0?void 0:t.exceptionHandleConfig})]})}var os=L(62849),is=L(92126),ss=L(73813),ls=[{label:"\u653E\u5927 10%",value:"+"},{label:"\u7F29\u5C0F 10%",value:"-"},{label:"\u7F29\u653E\u5230\u9002\u914D\u753B\u5E03",value:-1},{label:(0,n.jsx)("div",{style:{borderTop:"1px solid #d9d9d9",marginTop:"15px",height:0,width:"90%",marginLeft:"5%"}}),value:"divider",disabled:!0,style:{padding:0,cursor:"default"}},{label:"\u7F29\u653E\u5230 50%",value:.5},{label:"\u7F29\u653E\u5230 100%",value:1},{label:"\u7F29\u653E\u5230 150%",value:1.5},{label:"\u7F29\u653E\u5230 200%",value:2}],us=function(t){var e=t.zoomSize,r=e===void 0?1:e,a=t.dragChild,o=t.handleTestRun,l=t.changeGraph,s=t.foldWrapItem,u=t.testRunLoading,c=(0,j.useState)(!1),v=me()(c,2),N=v[0],h=v[1],f=(0,j.useState)(0),m=me()(f,2),S=m[0],b=m[1],k=function(C){h(C),b(0)};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"absolute-box",children:[(0,n.jsxs)("div",{className:"action-section",children:[(0,n.jsx)(je.ZP,{type:"text",style:{marginRight:2},icon:(0,n.jsx)(Zt.Z,{}),onClick:function(){var C=-10,d=Math.round(r*100),y=d+C,I=Math.max(20,Math.min(300,y)),w=I/100;l(Number(w))}}),(0,n.jsx)(Ke.default,{options:ls,value:"".concat(Math.round(r*100),"%"),onChange:function(C){var d;if(typeof C=="string"&&["+","-"].includes(C)){var y=C==="+"?10:-10,I=Math.round(r*100),w=I+y,A=Math.max(20,Math.min(300,w));d=A/100}else d=C;l(Number(d))},style:{width:80,marginRight:2,height:28},popupMatchSelectWidth:!1,optionLabelProp:"displayValue",size:"small"}),(0,n.jsx)(je.ZP,{type:"text",style:{marginRight:12},icon:(0,n.jsx)(en.Z,{}),onClick:function(){var C=10,d=Math.round(r*100),y=d+C,I=Math.max(20,Math.min(300,y)),w=I/100;l(Number(w))}}),(0,n.jsx)(Je.Z,{content:"\u7F29\u653E\u5230\u9002\u914D\u753B\u5E03",trigger:["hover"],mouseEnterDelay:1,children:(0,n.jsx)(je.ZP,{type:"text",style:{marginRight:12},icon:(0,n.jsx)(os.Z,{}),onClick:function(){return l(-1)}})}),(0,n.jsx)(Je.Z,{content:(0,n.jsx)(Cr,{isLoop:s.type===i.C8.Loop,dragChild:function(C,d){b(S+1),a(C,d,S)}}),trigger:["click"],open:N,onOpenChange:k,children:(0,n.jsx)(je.ZP,{onMouseEnter:function(){return h(!0)},icon:(0,n.jsx)(en.Z,{}),type:"primary",onClick:function(){return h(!0)},children:"\u6DFB\u52A0\u8282\u70B9"})})]}),(0,n.jsxs)("div",{className:"action-section",style:{marginLeft:18},children:[(0,n.jsx)(is.Z,{title:"\u8C03\u8BD5",style:{paddingRight:12,paddingLeft:12}}),(0,n.jsx)(je.ZP,{loading:u,icon:(0,n.jsx)(ss.Z,{}),variant:"solid",color:"green",onClick:o,children:"\u8BD5\u8FD0\u884C"})]})]})})},ds=us,cs=L(38683),zr=500,fs=function(t){return(t||"").length>zr?t.slice(0,zr)+"...":t},ps=function(t){var e=t.visible,r=t.errorList,a=t.show,o=t.onClose,l=t.onClickItem,s=t.nodeList,u=(0,Re.useModel)("workflowV3"),c=u.setVolid,v=cs.Z.useToken(),N=v.token;return(0,n.jsxs)("div",{style:{right:e?"388px":"10px",display:a?"flex":"none",flexDirection:"column"},className:"error-list-style dis-col",children:[(0,n.jsxs)("div",{className:"dis-sb error-list-header",style:{height:"48px"},children:[(0,n.jsx)("span",{children:"\u9519\u8BEF\u5217\u8868"}),(0,n.jsx)(je.ZP,{type:"text",icon:(0,n.jsx)(Vr.Z,{}),onClick:function(){o(),c(!1)}})]}),r&&(0,n.jsx)("div",{className:"error-list-content",children:r.map(function(h){if(h&&h.nodeId){var f=s.find(function(m){return m.id===h.nodeId});return f?(0,n.jsxs)("div",{className:"dis-left error-list-item hover-box",onClick:function(){l(f),c(!0)},children:[(0,n.jsx)("div",{className:"image-div-style",children:st(f.type)}),(0,n.jsxs)("div",{className:"content-error-item-width",children:[(0,n.jsx)("p",{className:"error-node-name",children:f.name||"\u6682\u65E0"}),h.error.length>110?(0,n.jsx)(Je.Z,{content:(0,n.jsx)("p",{children:fs(h.error)}),trigger:"hover",mouseEnterDelay:.5,placement:"top",open:void 0,children:(0,n.jsx)("p",{className:"error-text",children:h.error})}):(0,n.jsx)("p",{className:"error-text",children:h.error})]})]},h.nodeId):null}else return h?(0,n.jsx)("div",{className:"dis-left error-list-item",children:h.error.length>3e3?(0,n.jsx)(Je.Z,{content:(0,n.jsx)("p",{children:h.error}),trigger:"hover",mouseEnterDelay:.5,placement:"top",open:void 0,children:(0,n.jsx)("p",{className:"error-text",children:h.error})}):(0,n.jsx)("p",{className:"error-text text-ellipsis-2",style:{fontSize:12,color:N.colorError},children:h.error})},h.error):null})})]})},vs=ps,ln=L(63814),gs=L(86834),hs=L(64267),ms=L(61606),Cs=L(89858),ys=L(28793),xs=L(4093),Ns=L(7036),Ot=L(68108),Is=function(t){var e=t.isValidLoading,r=t.info,a=t.onToggleVersionHistory,o=t.setShowCreateWorkflow,l=t.showPublish,s=t.canUndo,u=s===void 0?!1:s,c=t.canRedo,v=c===void 0?!1:c,N=t.onUndo,h=t.onRedo,f=t.onManualSave,m=(0,Re.useParams)(),S=m.spaceId,b=(0,Re.useModel)("workflowV3"),k=b.saveStatus,g=b.saveError,C=b.lastSaveTime,d=r.name,y=r.icon,I=r.publishStatus,w=r.modified,A=r.description,D=r.publishDate,E=/mac/i.test(navigator.userAgent),R=E?"Cmd+Z":"Ctrl+Z",P=E?"Cmd+Shift+Z":"Ctrl+Shift+Z",G=j.useState(!1),B=me()(G,2),Y=B[0],le=B[1],re=j.useRef(null);j.useEffect(function(){return k===ln.X.Saving?re.current=setTimeout(function(){le(!0)},300):(re.current&&(clearTimeout(re.current),re.current=null),le(!1)),function(){re.current&&clearTimeout(re.current)}},[k]);var Q=(0,j.useMemo)(function(){if(r){var U;return!(r!=null&&(U=r.permissions)!==null&&U!==void 0&&U.includes(i.jE.Publish))}else return!1},[r]),O=function(){var Z,ae;switch(k){case ln.X.Saving:if(!Y){var V,ne;return(0,n.jsxs)(He.Z,{color:"default",bordered:!1,children:["\u5DF2\u81EA\u52A8\u4FDD\u5B58"," ",(0,nt.hK)((V=(ne=C?.toString())!==null&&ne!==void 0?ne:w)!==null&&V!==void 0?V:new Date().toString())]})}return(0,n.jsx)(He.Z,{color:"processing",bordered:!1,icon:(0,n.jsx)(Et.Z,{}),children:"\u4FDD\u5B58\u4E2D..."});case ln.X.Saved:return(0,n.jsxs)(He.Z,{color:"default",bordered:!1,children:["\u5DF2\u81EA\u52A8\u4FDD\u5B58"," ",(0,nt.hK)((Z=(ae=C?.toString())!==null&&ae!==void 0?ae:w)!==null&&Z!==void 0?Z:new Date().toString())]});case ln.X.Failed:return(0,n.jsxs)("div",{className:"flex items-center gap-8",style:{marginRight:8},children:[(0,n.jsx)(Ot.Z,{title:g||"\u4FDD\u5B58\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u8FDE\u63A5",children:(0,n.jsx)(He.Z,{color:"error",bordered:!1,icon:(0,n.jsx)(hs.Z,{}),children:"\u4FDD\u5B58\u5931\u8D25"})}),f&&(0,n.jsx)(je.ZP,{type:"default",onClick:f,size:"small",children:"\u70B9\u51FB\u91CD\u8BD5\u4FDD\u5B58"})]});case ln.X.Unsaved:return(0,n.jsxs)("div",{className:"flex items-center gap-8",style:{marginRight:8},children:[(0,n.jsx)(He.Z,{color:"warning",bordered:!1,children:"\u6709\u672A\u4FDD\u5B58\u7684\u66F4\u6539"}),f&&(0,n.jsx)(je.ZP,{type:"default",onClick:f,size:"small",children:"\u70B9\u51FB\u7ACB\u5373\u4FDD\u5B58"})]});default:return(0,n.jsxs)(He.Z,{color:"default",bordered:!1,children:["\u5DF2\u81EA\u52A8\u4FDD\u5B58 ",(0,nt.hK)(w??new Date().toString())]})}};return(0,n.jsxs)("div",{className:"fold-header-style flex items-center gap-20",children:[(0,n.jsxs)("div",{className:"dis-left flex-1",children:[(0,n.jsx)(ms.Z,{className:"back-icon-style",onClick:function(){return(0,gs.bC)("/space/".concat(S,"/library"))}}),(0,n.jsx)("img",{src:y||dr(Se.qR.Workflow),alt:"",className:"header-icon-style"}),(0,n.jsx)("div",{className:"dis-col header-content-style ",children:(0,n.jsxs)("div",{className:"dis-left",children:[(0,n.jsx)("strong",{className:"header-name-style",children:d}),(0,n.jsx)(Je.Z,{content:A,children:(0,n.jsx)(fn.Z,{className:"mr-6",style:{fontSize:"16px"}})}),I==="Published"&&(0,n.jsx)(Je.Z,{content:"\u5DF2\u53D1\u5E03",children:(0,n.jsx)(Er.Z,{className:"mr-6",style:{color:"#00B23C",fontSize:"16px"}})}),(0,n.jsx)(Cs.Z,{onClick:o,style:{fontSize:"16px"}})]})})]}),(0,n.jsxs)("div",{className:"header-tag-style flex items-center gap-8",children:[O(),D===null&&(0,n.jsx)(He.Z,{color:"#EBECF5",style:{color:"rgba(15,21,40,0.82)"},children:"\u672A\u53D1\u5E03"}),D!==null&&D!==w&&(0,n.jsx)(He.Z,{bordered:!1,color:"volcano",children:"\u6709\u66F4\u65B0\u672A\u53D1\u5E03"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-8 mr-12",style:{display:"flex",gap:"16px"},children:[(0,n.jsx)(Ot.Z,{title:"\u64A4\u9500 (".concat(R,")"),children:(0,n.jsx)(ys.Z,{style:{fontSize:"18px",color:u?"rgba(0, 0, 0, 0.85)":"rgba(0, 0, 0, 0.25)",cursor:u?"pointer":"not-allowed"},onClick:u?N:void 0})}),(0,n.jsx)(Ot.Z,{title:"\u91CD\u505A (".concat(P,")"),children:(0,n.jsx)(xs.Z,{style:{fontSize:"18px",color:v?"rgba(0, 0, 0, 0.85)":"rgba(0, 0, 0, 0.25)",cursor:v?"pointer":"not-allowed"},onClick:v?h:void 0})})]}),(0,n.jsx)(Ns.Z,{className:"ico cursor-pointer",onClick:a}),(0,n.jsx)(je.ZP,{disabled:Q,onClick:l,type:"primary",loading:e,children:e?"\u6821\u9A8C\u4E2D":"\u53D1\u5E03"})]})},Es=Is,bs=function(t){var e,r,a=t.isValidLoading,o=t.info,l=t.setShowCreateWorkflow,s=t.setShowVersionHistory,u=t.handleShowPublish,c=t.showPublish,v=t.setShowPublish,N=t.canUndo,h=t.canRedo,f=t.onUndo,m=t.onRedo,S=t.onManualSave,b=t.onConfirm,k=t.onUpdateWorkflow,g=t.handleConfirmPublishWorkflow,C=t.globalLoadingTime,d=t.graphParams,y=t.graphRef,I=t.handleNodeClick,w=t.nodeChangeEdge,A=t.changeNode,D=t.deleteNode,E=t.copyNode,R=t.changeZoom,P=t.createNodeByPortOrEdge,G=t.handleSaveNode,B=t.handleClickBlank,Y=t.handleInitLoading,le=t.handleRefreshGraph,re=t.dragChild,Q=t.foldWrapItem,O=t.changeGraph,U=t.testRunAll,Z=t.testRunLoading,ae=t.visible,V=t.handleDrawerClose,ne=t.showNameInput,K=t.changeFoldWrap,z=t.handleOperationsChange,W=t.form,M=t.doSubmitFormData,F=t.throttledHandleGraphUpdate,T=t.createdItem,H=t.onAdded,q=t.open,de=t.setOpen,ce=t.workflowCreatedTabs,ge=t.workflowId,Ce=t.runTest,X=t.testRunResult,fe=t.handleClearRunResult,Ne=t.loading,De=t.stopWait,Ze=t.formItemValue,Me=t.testRunParams,un=t.errorParams,we=t.setErrorParams,tn=t.handleErrorNodeClick,Nn=t.spaceId,Ut=t.showCreateWorkflow,ht=t.showVersionHistory;return(0,n.jsxs)("div",{id:"container",children:[(0,n.jsx)(Es,{isValidLoading:a,info:o??{},onToggleVersionHistory:function(){return s(!0)},setShowCreateWorkflow:function(){return l(!0)},showPublish:u,canUndo:N,canRedo:h,onUndo:f,onRedo:m,onManualSave:S}),(0,n.jsx)(Fa.Z,{spinning:C>0,indicator:(0,n.jsx)(Et.Z,{spin:!0}),wrapperClassName:"spin-workflow-global-style",children:(0,n.jsx)(Ko,{graphParams:d,ref:y,changeDrawer:I,changeEdge:w,changeCondition:A,removeNode:D,copyNode:E,changeZoom:R,createNodeByPortOrEdge:P,onSaveNode:G,onClickBlank:B,onInit:Y,onRefresh:le})}),(0,n.jsx)(ds,{dragChild:re,foldWrapItem:Q,changeGraph:O,handleTestRun:U,testRunLoading:Z,zoomSize:(e=o==null||(r=o.extension)===null||r===void 0?void 0:r.size)!==null&&e!==void 0?e:1}),(0,n.jsx)(ba.Z,{className:"fold-wrap-style",lineMargin:!0,title:Q.name,visible:ae,onClose:V,description:Q.description,backgroundColor:kt(Q.type),icon:st(Q.type),showNameInput:ne,changeFoldWrap:K,otherAction:(0,n.jsx)(wa.Z,{onChange:z,testRun:ma.includes(Q.type),nodeType:Q.type,action:Q.type!==i.C8.Start&&Q.type!==i.C8.End}),children:(0,n.jsx)("div",{className:"dispose-node-style",children:(0,n.jsx)(J.Z,{form:W,layout:"vertical",onFinishFailed:M,onFinish:M,initialValues:Q.nodeConfig,clearOnDestroy:!0,onValuesChange:function(Kn){F(Kn,W.getFieldsValue(!0))},children:(0,n.jsx)(as,{params:Q},"".concat(Q.type,"-").concat(Q.id,"-nodePanelDrawer"))},"".concat(Q.type,"-").concat(Q.id,"-form"))})},"".concat(Q.type,"-").concat(Q.id,"-foldWrap")),(0,n.jsx)(It.Z,{checkTag:T,onAdded:H,open:q,tabs:ce,addComponents:[{type:Se.qR.Workflow,targetId:ge,status:Se.BQ.Added}],onCancel:function(){return de(!1)}}),(0,n.jsx)(ka.Z,{node:Q,run:Ce,testRunResult:X,clearRunResult:fe,loading:Ne,stopWait:De,formItemValue:Ze,testRunParams:Me}),(0,n.jsx)(Ea.Z,x()({onConfirm:b,onUpdate:k,onCancel:function(){return l(!1)},open:Ut,type:i.jA.Update},o)),(0,n.jsx)(vs,{visible:ae,errorList:un.errorList,show:un.show,onClose:function(){return we(x()(x()({},un),{},{errorList:[],show:!1}))},onClickItem:tn,nodeList:d.nodeList}),(0,n.jsx)(Sa.Z,{mode:Se.qR.Workflow,targetId:ge,spaceId:Nn,category:o?.category,open:c,onCancel:function(){return v(!1)},onConfirm:g}),(0,n.jsx)(ja.Z,{targetId:ge,targetName:o?.name,targetType:Se.qR.Workflow,permissions:o?.permissions||[],visible:ht,isDrawer:!0,onClose:function(){return s(!1)},renderActions:function(Kn){return(0,n.jsx)(Aa.Z,{data:Kn,onRefresh:le,onClose:function(){return s(!1)}})}})]})},ws=bs;function Ss(p){var t=p.run,e=p.doNext,r=p.delay,a=r===void 0?500:r,o=(0,Re.useModel)("workflowV3"),l=o.isModified,s=o.setUpdateLoading,u=(0,j.useRef)(!1),c=(0,j.useRef)(!0),v=(0,j.useCallback)(xe()(ee()().mark(function h(){return ee()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(c.current){m.next=2;break}return m.abrupt("return");case 2:if(!u.current){m.next=4;break}return m.abrupt("return");case 4:return m.prev=4,u.current=!0,s(!0),m.next=9,t();case 9:e?.(),m.next=14;break;case 12:m.prev=12,m.t0=m.catch(4);case 14:return m.prev=14,s(!1),u.current=!1,m.finish(14);case 18:case"end":return m.stop()}},h,null,[[4,12,14,18]])})),[t,e,s]),N=(0,_t.z)(function(){return v()},a,{leading:!0,trailing:!0});(0,j.useEffect)(function(){l&&c.current&&N()},[l,N]),(0,j.useEffect)(function(){return c.current=!0,function(){c.current=!1,u.current=!1}},[])}var ks=L(25298),Xr=L.n(ks),js=L(17069),Qr=L.n(js),Zl=function(p){return p.ADD_NODE="ADD_NODE",p.DELETE_NODE="DELETE_NODE",p.UPDATE_NODE="UPDATE_NODE",p.ADD_EDGE="ADD_EDGE",p.DELETE_EDGE="DELETE_EDGE",p.MOVE_NODE="MOVE_NODE",p.BATCH="BATCH",p}({}),be=function(p){return p.Normal="normal",p.Condition="condition",p.Intent="intent",p.QAOption="qa_option",p.Exception="exception",p.Loop="loop",p}({}),Fs=function(){function p(){Xr()(this,p),pe()(this,"meta",null),pe()(this,"originalDetails",null),pe()(this,"isDirty",!1),pe()(this,"listeners",[])}return Qr()(p,[{key:"initialize",value:function(e){this.originalDetails=(0,ke.Xh)(e),this.meta={id:e.id,name:e.name,description:e.description,spaceId:e.spaceId,icon:e.icon,publishStatus:e.publishStatus,extension:e.extension,scope:e.scope,category:e.category,permissions:e.permissions},this.isDirty=!1}},{key:"updateMeta",value:function(e){if(!this.meta){console.error("[SaveService] \u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u66F4\u65B0\u5143\u6570\u636E");return}this.meta=x()(x()({},this.meta),e),this.originalDetails&&(e.name!==void 0&&(this.originalDetails.name=e.name),e.description!==void 0&&(this.originalDetails.description=e.description),e.icon!==void 0&&(this.originalDetails.icon=e.icon)),this.markDirty()}},{key:"reset",value:function(){this.meta=null,this.originalDetails=null,this.isDirty=!1}},{key:"markDirty",value:function(){this.isDirty=!0,this.notifyListeners()}},{key:"clearDirty",value:function(){this.isDirty=!1}},{key:"hasPendingChanges",value:function(){return this.isDirty}},{key:"buildPayload",value:function(e){var r,a;if(!this.meta||!this.originalDetails)return console.error("[SaveService] \u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u6784\u5EFA\u4FDD\u5B58\u6570\u636E"),null;var o=this.extractNodes(e);if(o.length===0||!o.some(function(N){return N.type==="Start"}))return console.warn("[SaveService] \u753B\u5E03\u65E0\u6709\u6548\u8282\u70B9\uFF0C\u5C1D\u8BD5\u4F7F\u7528 workflowProxy \u6570\u636E\u4FDD\u5B58"),null;var l=this.extractEdges(e),s=this.computeConnections(o,l),u=s.find(function(N){return N.type==="Start"}),c=s.find(function(N){return N.type==="End"}),v=x()(x()(x()({},this.originalDetails),this.meta),{},{nodes:s,startNode:u||this.originalDetails.startNode,endNode:c||this.originalDetails.endNode,inputArgs:(u==null||(r=u.nodeConfig)===null||r===void 0?void 0:r.inputArgs)||this.originalDetails.inputArgs,outputArgs:(c==null||(a=c.nodeConfig)===null||a===void 0?void 0:a.outputArgs)||this.originalDetails.outputArgs,modified:new Date().toISOString()});return v}},{key:"extractNodes",value:function(e){return e.getNodes().map(function(r){var a=r.getData(),o=r.getPosition(),l=r.getSize(),s=(0,ke.Xh)(a);return s.nodeConfig||(s.nodeConfig={}),s.nodeConfig.extension||(s.nodeConfig.extension={}),s.nodeConfig.extension=x()(x()({},s.nodeConfig.extension),{},{x:o.x,y:o.y,width:l.width,height:l.height}),s})}},{key:"extractEdges",value:function(e){var r=e.getEdges();return r.map(function(a){var o=a.getSource(),l=a.getTarget(),s,u,c,v;return typeof o=="string"?s=o:o&&Mn()(o)==="object"?(s=o.cell||"",c=o.port):s="",typeof l=="string"?u=l:l&&Mn()(l)==="object"?(u=l.cell||"",v=l.port):u="",c||(c=a.getSourcePortId()||void 0),v||(v=a.getTargetPortId()||void 0),{source:s,target:u,sourcePort:c,targetPort:v}}).filter(function(a){return a.source&&a.target})}},{key:"computeConnections",value:function(e,r){var a=this,o=new Map;return e.forEach(function(l){o.set(String(l.id),(0,ke.Xh)(l))}),o.forEach(function(l){l.nextNodeIds=[],a.clearBranchNextNodeIds(l)}),r.forEach(function(l){var s=String(l.source),u=Number(l.target),c=o.get(s);if(c){var v=a.parseSourcePort(l.sourcePort,c);a.addConnectionToNode(c,u,v)}}),Array.from(o.values())}},{key:"clearBranchNextNodeIds",value:function(e){var r,a,o,l,s;e.type===i.C8.Condition&&(r=e.nodeConfig)!==null&&r!==void 0&&r.conditionBranchConfigs&&e.nodeConfig.conditionBranchConfigs.forEach(function(u){u.nextNodeIds=[]}),e.type===i.C8.IntentRecognition&&(a=e.nodeConfig)!==null&&a!==void 0&&a.intentConfigs&&e.nodeConfig.intentConfigs.forEach(function(u){u.nextNodeIds=[]}),e.type===i.C8.QA&&((o=e.nodeConfig)===null||o===void 0?void 0:o.answerType)===i.J4.SELECT&&(l=e.nodeConfig)!==null&&l!==void 0&&l.options&&e.nodeConfig.options.forEach(function(u){u.nextNodeIds=[]}),(s=e.nodeConfig)!==null&&s!==void 0&&s.exceptionHandleConfig&&(e.nodeConfig.exceptionHandleConfig.exceptionHandleNodeIds=[])}},{key:"parseSourcePort",value:function(e,r){var a;if(!e)return{type:be.Normal};if(e.includes("-exception-out"))return{type:be.Exception};if(r.type===i.C8.Loop&&e.includes("-in"))return{type:be.Loop};if(r.type===i.C8.Condition||r.type===i.C8.IntentRecognition||r.type===i.C8.QA&&((a=r.nodeConfig)===null||a===void 0?void 0:a.answerType)===i.J4.SELECT){var o=String(r.id),l=e;return e.startsWith(o+"-")&&(l=e.substring(o.length+1)),l.endsWith("-out")&&(l=l.substring(0,l.length-4)),r.type===i.C8.Condition?{type:be.Condition,uuid:l}:r.type===i.C8.IntentRecognition?{type:be.Intent,uuid:l}:{type:be.QAOption,uuid:l}}return{type:be.Normal}}},{key:"addConnectionToNode",value:function(e,r,a){switch(a.type){case be.Condition:{var o,l=(o=e.nodeConfig)===null||o===void 0?void 0:o.conditionBranchConfigs,s=l?.find(function(S){return S.uuid===a.uuid});return s?(s.nextNodeIds||(s.nextNodeIds=[]),s.nextNodeIds.includes(r)||s.nextNodeIds.push(r),!0):!1}case be.Intent:{var u,c=(u=e.nodeConfig)===null||u===void 0?void 0:u.intentConfigs,v=c?.find(function(S){return S.uuid===a.uuid});return v?(v.nextNodeIds||(v.nextNodeIds=[]),v.nextNodeIds.includes(r)||v.nextNodeIds.push(r),!0):!1}case be.QAOption:{var N,h=(N=e.nodeConfig)===null||N===void 0?void 0:N.options,f=h?.find(function(S){return S.uuid===a.uuid});return f?(f.nextNodeIds||(f.nextNodeIds=[]),f.nextNodeIds.includes(r)||f.nextNodeIds.push(r),!0):!1}case be.Exception:{if(!e.nodeConfig)return!1;e.nodeConfig.exceptionHandleConfig||(e.nodeConfig.exceptionHandleConfig={});var m=e.nodeConfig.exceptionHandleConfig;return m.exceptionHandleNodeIds||(m.exceptionHandleNodeIds=[]),m.exceptionHandleNodeIds.includes(r)||m.exceptionHandleNodeIds.push(r),!0}case be.Loop:return!0;case be.Normal:default:return e.nextNodeIds||(e.nextNodeIds=[]),e.nextNodeIds.includes(r)||e.nextNodeIds.push(r),!0}}},{key:"subscribe",value:function(e){var r=this;return this.listeners.push(e),function(){r.listeners=r.listeners.filter(function(a){return a!==e})}}},{key:"notifyListeners",value:function(){this.listeners.forEach(function(e){return e()})}},{key:"getMeta",value:function(){return this.meta?x()({},this.meta):null}},{key:"getOriginalDetails",value:function(){return this.originalDetails?(0,ke.Xh)(this.originalDetails):null}}]),p}(),kn=new Fs,Ol=null;function As(p){var t=String(p),e;return t.length<3?e=t.padEnd(3,"0"):e=t.substring(0,3),Number(Date.now()+e)}function Be(p){if(p==null)return 0;var t=typeof p=="string"?parseInt(p,10):p;if(isNaN(t))return console.warn("[WorkflowProxy] \u65E0\u6548\u7684\u8282\u70B9 ID:",p),0;if(typeof p=="string"){var e=p.trim();if(e.length>=16&&!Number.isSafeInteger(Number(e)))return console.warn("[WorkflowProxy] \u8282\u70B9 ID \u8D85\u51FA\u5B89\u5168\u6574\u6570\u8303\u56F4\uFF0C\u7CBE\u5EA6\u4E22\u5931:",e),0}return t}var Ds=function(){function p(){Xr()(this,p),pe()(this,"workflowData",null),pe()(this,"workflowInfo",null),pe()(this,"pendingUpdates",[]),pe()(this,"isBackendReady",!1),pe()(this,"isDirty",!1),pe()(this,"maxHistorySize",50),pe()(this,"listeners",[])}return Qr()(p,[{key:"initialize",value:function(e){this.workflowData=(0,ke.Xh)(e),this.pendingUpdates=[],this.isDirty=!1,this.notify("mutation"),console.log("[V3 Proxy] \u8282\u70B9\u6570\u91CF:",e.nodes.length,"\u8FB9\u6570\u91CF:",e.edges.length),e.nodes.forEach(function(r){r.nextNodeIds&&r.nextNodeIds.length>0&&console.log("[V3 Proxy] \u8282\u70B9",r.id,r.name,"nextNodeIds:",r.nextNodeIds)})}},{key:"reset",value:function(){this.workflowData=null,this.workflowInfo=null,this.pendingUpdates=[],this.isDirty=!1,this.notify("reset")}},{key:"setWorkflowInfo",value:function(e){this.workflowInfo=(0,ke.Xh)(e)}},{key:"getWorkflowInfo",value:function(){return this.workflowInfo?(0,ke.Xh)(this.workflowInfo):null}},{key:"buildFullConfig",value:function(){var e,r;if(!this.workflowInfo||!this.workflowData)return null;this.validateDataConsistency();var a=this.workflowData.nodes,o=a.find(function(c){return c.type==="Start"}),l=a.find(function(c){return c.type==="End"}),s=(0,ke.Xh)(a).map(function(c){return c.icon&&Mn()(c.icon)==="object"&&(c.icon=null),c.systemVariables&&delete c.systemVariables,c}),u=x()(x()({},this.workflowInfo),{},{nodes:s,startNode:o?(0,ke.Xh)(o):this.workflowInfo.startNode,endNode:l?(0,ke.Xh)(l):this.workflowInfo.endNode,inputArgs:(o==null||(e=o.nodeConfig)===null||e===void 0?void 0:e.inputArgs)||this.workflowInfo.inputArgs,outputArgs:(l==null||(r=l.nodeConfig)===null||r===void 0?void 0:r.outputArgs)||this.workflowInfo.outputArgs,modified:new Date().toISOString()});return u.systemVariables&&delete u.systemVariables,u}},{key:"validateDataConsistency",value:function(){var e=this;if(this.workflowData){var r=this.workflowData,a=r.nodes,o=r.edges,l=new Set(a.map(function(u){return u.id})),s=[];o.forEach(function(u){var c=parseInt(u.source,10),v=parseInt(u.target,10);l.has(c)?l.has(v)||(console.warn("[WorkflowProxy] \u8FB9\u7684\u76EE\u6807\u8282\u70B9\u4E0D\u5B58\u5728: ".concat(u.target,", \u5C06\u79FB\u9664\u6B64\u8FB9")),s.push(u)):(console.warn("[WorkflowProxy] \u8FB9\u7684\u6E90\u8282\u70B9\u4E0D\u5B58\u5728: ".concat(u.source,", \u5C06\u79FB\u9664\u6B64\u8FB9")),s.push(u))}),s.length>0&&(this.workflowData.edges=o.filter(function(u){return!s.includes(u)}),console.log("[WorkflowProxy] \u5DF2\u79FB\u9664 ".concat(s.length," \u6761\u65E0\u6548\u8FB9"))),a.forEach(function(u){if(!(u.type===i.C8.Condition||u.type===i.C8.IntentRecognition||u.type===i.C8.QA)){var c=e.workflowData.edges.filter(function(h){return parseInt(h.source,10)===u.id}),v=new Set(c.filter(function(h){return!h.sourcePort||!h.sourcePort.includes("-exception-")}).map(function(h){return parseInt(h.target,10)})),N=new Set(u.nextNodeIds||[]);v.forEach(function(h){N.has(h)||(console.warn("[WorkflowProxy] \u8282\u70B9 ".concat(u.id," (").concat(u.name,") \u753B\u5E03\u6709\u8FB9\u5230 ").concat(h,"\uFF0C\u4F46 nextNodeIds \u7F3A\u5C11\u6B64\u8FDE\u63A5\uFF0C\u5DF2\u81EA\u52A8\u6DFB\u52A0")),u.nextNodeIds||(u.nextNodeIds=[]),u.nextNodeIds.push(h))}),N.forEach(function(h){v.has(h)||(console.warn("[WorkflowProxy] \u8282\u70B9 ".concat(u.id," (").concat(u.name,") nextNodeIds \u5305\u542B ").concat(h,"\uFF0C\u4F46\u753B\u5E03\u65E0\u5BF9\u5E94\u8FB9\uFF0C\u5DF2\u81EA\u52A8\u79FB\u9664")),u.nextNodeIds=(u.nextNodeIds||[]).filter(function(f){return f!==h}))})}})}}},{key:"getFullWorkflowData",value:function(){return this.workflowData?(0,ke.Xh)(this.workflowData):null}},{key:"getNodes",value:function(){return this.workflowData?(0,ke.Xh)(this.workflowData.nodes):[]}},{key:"getEdges",value:function(){return this.workflowData?(0,ke.Xh)(this.workflowData.edges):[]}},{key:"getSystemVariables",value:function(){var e;return(e=this.workflowData)!==null&&e!==void 0&&e.systemVariables?(0,ke.Xh)(this.workflowData.systemVariables):[]}},{key:"getNodeById",value:function(e){if(!this.workflowData)return null;var r=this.workflowData.nodes.find(function(a){return Be(a.id)===Be(e)});return r?(0,ke.Xh)(r):null}},{key:"hasPendingChanges",value:function(){return this.isDirty||this.pendingUpdates.length>0}},{key:"updateNode",value:function(e){if(!this.workflowData)return{success:!1,message:"\u5DE5\u4F5C\u6D41\u6570\u636E\u672A\u521D\u59CB\u5316"};var r=this.workflowData.nodes.findIndex(function(a){return Be(a.id)===Be(e.id)});return r>=0?(this.workflowData.nodes[r]=(0,ke.Xh)(e),console.log("[V3 Proxy] \u8282\u70B9\u66F4\u65B0\u6210\u529F:",e.id,e.name)):(this.workflowData.nodes.push((0,ke.Xh)(e)),console.log("[V3 Proxy] \u8282\u70B9\u65B0\u589E\uFF08\u901A\u8FC7\u66F4\u65B0\uFF09:",e.id,e.name)),this.recordUpdate({type:"node",action:"update",data:e,timestamp:Date.now()}),this.markDirty(),this.notify("mutation"),{success:!0,data:this.getFullWorkflowData()}}},{key:"addNode",value:function(e){if(!this.workflowData)return{success:!1,message:"\u5DE5\u4F5C\u6D41\u6570\u636E\u672A\u521D\u59CB\u5316"};var r=this.workflowData.nodes.find(function(a){return Be(a.id)===Be(e.id)});return r?{success:!1,message:"\u8282\u70B9 ".concat(e.id," \u5DF2\u5B58\u5728")}:(this.workflowData.nodes.push((0,ke.Xh)(e)),this.recordUpdate({type:"node",action:"add",data:e,timestamp:Date.now()}),this.markDirty(),this.notify("mutation"),{success:!0,data:this.getFullWorkflowData()})}},{key:"deleteNode",value:function(e){if(!this.workflowData)return{success:!1,message:"\u5DE5\u4F5C\u6D41\u6570\u636E\u672A\u521D\u59CB\u5316"};var r=this.workflowData.nodes.findIndex(function(o){return Be(o.id)===Be(e)});if(r<0)return{success:!1,message:"\u8282\u70B9 ".concat(e," \u4E0D\u5B58\u5728")};var a=this.workflowData.nodes.splice(r,1)[0];return this.workflowData.edges=this.workflowData.edges.filter(function(o){return o.source!==String(e)&&o.target!==String(e)}),this.workflowData.nodes.forEach(function(o){var l,s,u,c,v;if(o.nextNodeIds&&o.nextNodeIds.includes(e)&&(o.nextNodeIds=o.nextNodeIds.filter(function(h){return h!==e})),o.type===i.C8.Condition&&(l=o.nodeConfig)!==null&&l!==void 0&&l.conditionBranchConfigs&&o.nodeConfig.conditionBranchConfigs.forEach(function(h){h.nextNodeIds&&h.nextNodeIds.includes(e)&&(h.nextNodeIds=h.nextNodeIds.filter(function(f){return f!==e}))}),o.type===i.C8.IntentRecognition&&(s=o.nodeConfig)!==null&&s!==void 0&&s.intentConfigs&&o.nodeConfig.intentConfigs.forEach(function(h){h.nextNodeIds&&h.nextNodeIds.includes(e)&&(h.nextNodeIds=h.nextNodeIds.filter(function(f){return f!==e}))}),o.type===i.C8.QA&&((u=o.nodeConfig)===null||u===void 0?void 0:u.answerType)===i.J4.SELECT&&(c=o.nodeConfig)!==null&&c!==void 0&&c.options&&o.nodeConfig.options.forEach(function(h){h.nextNodeIds&&h.nextNodeIds.includes(e)&&(h.nextNodeIds=h.nextNodeIds.filter(function(f){return f!==e}))}),(v=o.nodeConfig)!==null&&v!==void 0&&(v=v.exceptionHandleConfig)!==null&&v!==void 0&&v.exceptionHandleNodeIds){var N=o.nodeConfig.exceptionHandleConfig.exceptionHandleNodeIds;N.includes(e)&&(o.nodeConfig.exceptionHandleConfig.exceptionHandleNodeIds=N.filter(function(h){return h!==e}))}o.type===i.C8.Loop&&(Be(o.innerStartNodeId)===e&&(o.innerStartNodeId=-1),Be(o.innerEndNodeId)===e&&(o.innerEndNodeId=-1))}),this.recordUpdate({type:"node",action:"delete",data:a,timestamp:Date.now()}),this.markDirty(),this.notify("mutation"),{success:!0,data:this.getFullWorkflowData()}}},{key:"copyNode",value:function(e,r){var a;if(!this.workflowData)return{success:!1,message:"\u5DE5\u4F5C\u6D41\u6570\u636E\u672A\u521D\u59CB\u5316"};var o=this.workflowData.nodes.find(function(h){return Be(h.id)===Be(e)});if(!o)return{success:!1,message:"\u8282\u70B9 ".concat(e," \u4E0D\u5B58\u5728")};var l=(0,ke.Xh)(o);l.id=As(this.workflowData.workflowId);for(var s=this.workflowData.nodes.map(function(h){return h.name}),u="".concat(l.name,"_copy"),c=1;s.includes(u);)u="".concat(l.name,"_copy").concat(c),c++;if(l.name=u,(a=l.nodeConfig)!==null&&a!==void 0&&a.extension&&r){var v,N;l.nodeConfig.extension.x=(((v=o.nodeConfig)===null||v===void 0||(v=v.extension)===null||v===void 0?void 0:v.x)||0)+r.x,l.nodeConfig.extension.y=(((N=o.nodeConfig)===null||N===void 0||(N=N.extension)===null||N===void 0?void 0:N.y)||0)+r.y}return this.workflowData.nodes.push(l),this.recordUpdate({type:"node",action:"add",data:l,timestamp:Date.now()}),this.markDirty(),this.notify("mutation"),{success:!0,data:this.getFullWorkflowData(),newNode:l}}},{key:"updateNodePosition",value:function(e,r,a,o,l){if(!this.workflowData)return{success:!1,message:"\u5DE5\u4F5C\u6D41\u6570\u636E\u672A\u521D\u59CB\u5316"};var s=this.workflowData.nodes.find(function(u){return Be(u.id)===Be(e)});return s?(s.nodeConfig||(s.nodeConfig={}),s.nodeConfig.extension||(s.nodeConfig.extension={}),s.nodeConfig.extension.x=r,s.nodeConfig.extension.y=a,o!==void 0&&(s.nodeConfig.extension.width=o),l!==void 0&&(s.nodeConfig.extension.height=l),this.recordUpdate({type:"node",action:"move",data:s,timestamp:Date.now()}),this.markDirty(),this.notify("mutation"),{success:!0,data:this.getFullWorkflowData()}):{success:!1,message:"\u8282\u70B9 ".concat(e," \u4E0D\u5B58\u5728")}}},{key:"parseSourcePort",value:function(e,r){var a;if(!e)return{type:be.Normal};if(e.includes("-exception-out"))return{type:be.Exception};if(r.type===i.C8.Loop&&e.includes("-in"))return{type:be.Loop};if(r.type===i.C8.Condition||r.type===i.C8.IntentRecognition||r.type===i.C8.QA&&((a=r.nodeConfig)===null||a===void 0?void 0:a.answerType)===i.J4.SELECT){var o=e.split("-");if(o.length>=2){var l=String(r.id),s=e;return e.startsWith(l+"-")&&(s=e.substring(l.length+1)),s.endsWith("-out")&&(s=s.substring(0,s.length-4)),r.type===i.C8.Condition?{type:be.Condition,uuid:s}:r.type===i.C8.IntentRecognition?{type:be.Intent,uuid:s}:{type:be.QAOption,uuid:s}}}return{type:be.Normal}}},{key:"updateSpecialNodeConnection",value:function(e,r,a,o){var l=r.type,s=r.uuid;switch(l){case be.Condition:{var u,c=(u=e.nodeConfig)===null||u===void 0?void 0:u.conditionBranchConfigs;if(!c)return!1;var v=c.find(function(g){return g.uuid===s});return v?(v.nextNodeIds||(v.nextNodeIds=[]),o==="add"?v.nextNodeIds.includes(a)||v.nextNodeIds.push(a):v.nextNodeIds=v.nextNodeIds.filter(function(g){return g!==a}),!0):!1}case be.Intent:{var N,h=(N=e.nodeConfig)===null||N===void 0?void 0:N.intentConfigs;if(!h)return!1;var f=h.find(function(g){return g.uuid===s});return f?(f.nextNodeIds||(f.nextNodeIds=[]),o==="add"?f.nextNodeIds.includes(a)||f.nextNodeIds.push(a):f.nextNodeIds=f.nextNodeIds.filter(function(g){return g!==a}),!0):!1}case be.QAOption:{var m,S=(m=e.nodeConfig)===null||m===void 0?void 0:m.options;if(!S)return!1;var b=S.find(function(g){return g.uuid===s});return b?(b.nextNodeIds||(b.nextNodeIds=[]),o==="add"?b.nextNodeIds.includes(a)||b.nextNodeIds.push(a):b.nextNodeIds=b.nextNodeIds.filter(function(g){return g!==a}),!0):!1}case be.Exception:{if(!e.nodeConfig)return!1;e.nodeConfig.exceptionHandleConfig||(e.nodeConfig.exceptionHandleConfig={});var k=e.nodeConfig.exceptionHandleConfig;return k.exceptionHandleNodeIds||(k.exceptionHandleNodeIds=[]),o==="add"?k.exceptionHandleNodeIds.includes(a)||k.exceptionHandleNodeIds.push(a):k.exceptionHandleNodeIds=k.exceptionHandleNodeIds.filter(function(g){return g!==a}),!0}default:return!1}}},{key:"addEdge",value:function(e){if(!this.workflowData)return{success:!1,message:"\u5DE5\u4F5C\u6D41\u6570\u636E\u672A\u521D\u59CB\u5316"};var r=this.workflowData.edges.find(function(u){return u.source===e.source&&u.target===e.target&&(u.sourcePort||"")===(e.sourcePort||"")});if(r)return{success:!1,message:"\u8FB9\u5DF2\u5B58\u5728"};this.workflowData.edges.push((0,ke.Xh)(e));var a=Number(e.source),o=Number(e.target),l=this.workflowData.nodes.find(function(u){return Be(u.id)===a});if(l){var s=this.parseSourcePort(e.sourcePort,l);s.type!==be.Normal?(this.updateSpecialNodeConnection(l,s,o,"add"),console.log("[V3 Proxy] \u7279\u6B8A\u7AEF\u53E3\u8FDE\u7EBF\u6DFB\u52A0:",s.type,"uuid:",s.uuid,"->",o)):(l.nextNodeIds||(l.nextNodeIds=[]),l.nextNodeIds.includes(o)||l.nextNodeIds.push(o))}return this.recordUpdate({type:"edge",action:"add",data:e,timestamp:Date.now()}),this.markDirty(),this.notify("mutation"),{success:!0,data:this.getFullWorkflowData()}}},{key:"deleteEdge",value:function(e,r,a){if(!this.workflowData)return{success:!1,message:"\u5DE5\u4F5C\u6D41\u6570\u636E\u672A\u521D\u59CB\u5316"};var o=this.workflowData.edges.findIndex(function(h){var f=String(h.source)===String(e),m=String(h.target)===String(r);return a?f&&m&&(h.sourcePort||"")===a:f&&m});if(o<0)return{success:!1,message:"\u8FB9\u4E0D\u5B58\u5728"};var l=this.workflowData.edges.splice(o,1)[0],s=Number(e),u=Number(r),c=this.workflowData.nodes.find(function(h){return Be(h.id)===s});if(c){var v=a||l.sourcePort,N=this.parseSourcePort(v,c);N.type!==be.Normal?(this.updateSpecialNodeConnection(c,N,u,"remove"),console.log("[V3 Proxy] \u7279\u6B8A\u7AEF\u53E3\u8FDE\u7EBF\u5220\u9664:",N.type,"uuid:",N.uuid,"->",u)):c.nextNodeIds&&(c.nextNodeIds=c.nextNodeIds.filter(function(h){return h!==u}))}return this.recordUpdate({type:"edge",action:"delete",data:l,timestamp:Date.now()}),this.markDirty(),this.notify("mutation"),{success:!0,data:this.getFullWorkflowData()}}},{key:"updateNodeNextIds",value:function(e,r){if(!this.workflowData)return{success:!1,message:"\u5DE5\u4F5C\u6D41\u6570\u636E\u672A\u521D\u59CB\u5316"};var a=this.workflowData.nodes.find(function(o){return Be(o.id)===Be(e)});return a?(a.nextNodeIds=Ee()(r),this.markDirty(),this.notify("mutation"),{success:!0,data:this.getFullWorkflowData()}):{success:!1,message:"\u8282\u70B9 ".concat(e," \u4E0D\u5B58\u5728")}}},{key:"recordUpdate",value:function(e){this.pendingUpdates.push(e)}},{key:"markDirty",value:function(){this.isDirty=!0,this.workflowData&&(this.workflowData.modified=new Date().toISOString())}},{key:"getPendingFullData",value:function(){return this.isDirty?this.getFullWorkflowData():null}},{key:"getPendingUpdates",value:function(){return Ee()(this.pendingUpdates)}},{key:"clearPendingUpdates",value:function(){this.pendingUpdates=[],this.isDirty=!1}},{key:"setBackendReady",value:function(e){this.isBackendReady=e}},{key:"isReady",value:function(){return this.isBackendReady}},{key:"syncFromGraph",value:function(e,r){var a=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(this.workflowData){var l=new Map;e.forEach(function(N){return l.set(Be(N.id),(0,ke.Xh)(N))});var s=new Map,u=new Map,c=new Map;this.workflowData.nodes.forEach(function(N){var h,f,m,S,b,k=Be(N.id);if(s.set(k,[]),N.type===i.C8.Condition&&(h=N.nodeConfig)!==null&&h!==void 0&&h.conditionBranchConfigs){var g=new Map;N.nodeConfig.conditionBranchConfigs.forEach(function(y){g.set(y.uuid,[])}),u.set(k,g)}if(N.type===i.C8.IntentRecognition&&(f=N.nodeConfig)!==null&&f!==void 0&&f.intentConfigs){var C=new Map;N.nodeConfig.intentConfigs.forEach(function(y){C.set(y.uuid,[])}),u.set(k,C)}if(N.type===i.C8.QA&&((m=N.nodeConfig)===null||m===void 0?void 0:m.answerType)===i.J4.SELECT&&(S=N.nodeConfig)!==null&&S!==void 0&&S.options){var d=new Map;N.nodeConfig.options.forEach(function(y){d.set(y.uuid,[])}),u.set(k,d)}(b=N.nodeConfig)!==null&&b!==void 0&&b.exceptionHandleConfig&&c.set(k,[])}),r.forEach(function(N){var h=Number(N.source),f=Number(N.target),m=l.get(h);if(m)if(N.sourcePort){var S=a.parseSourcePort(N.sourcePort,m);switch(S.type){case be.Condition:case be.Intent:case be.QAOption:{if(S.uuid){var b=u.get(h);b||(b=new Map,u.set(h,b));var k=b.get(S.uuid);k||(k=[],b.set(S.uuid,k)),k.includes(f)||k.push(f)}break}case be.Exception:{var g=c.get(h);g||(g=[],c.set(h,g)),g.includes(f)||g.push(f);break}case be.Loop:break;case be.Normal:default:{var C=s.get(h);C||(C=[],s.set(h,C)),C.includes(f)||C.push(f);break}}}else{var d=s.get(h);d||(d=[],s.set(h,d)),d.includes(f)||d.push(f)}});var v=e.map(function(N){var h,f,m=N.id,S=(0,ke.Xh)(N),b=S.type===i.C8.Condition||S.type===i.C8.IntentRecognition||S.type===i.C8.QA&&((h=S.nodeConfig)===null||h===void 0?void 0:h.answerType)===i.J4.SELECT;b?S.nextNodeIds=[]:S.nextNodeIds=s.get(m)||[];var k=u.get(m);if(k){var g,C,d,y;S.type===i.C8.Condition&&(g=S.nodeConfig)!==null&&g!==void 0&&g.conditionBranchConfigs&&S.nodeConfig.conditionBranchConfigs.forEach(function(w){w.nextNodeIds=k.get(w.uuid)||[]}),S.type===i.C8.IntentRecognition&&(C=S.nodeConfig)!==null&&C!==void 0&&C.intentConfigs&&S.nodeConfig.intentConfigs.forEach(function(w){w.nextNodeIds=k.get(w.uuid)||[]}),S.type===i.C8.QA&&((d=S.nodeConfig)===null||d===void 0?void 0:d.answerType)===i.J4.SELECT&&(y=S.nodeConfig)!==null&&y!==void 0&&y.options&&S.nodeConfig.options.forEach(function(w){w.nextNodeIds=k.get(w.uuid)||[]})}var I=c.get(m);return I&&(f=S.nodeConfig)!==null&&f!==void 0&&f.exceptionHandleConfig&&(S.nodeConfig.exceptionHandleConfig.exceptionHandleNodeIds=I),S});this.workflowData.nodes=v,this.workflowData.edges=(0,ke.Xh)(r),o&&this.markDirty(),this.notify("mutation")}}},{key:"subscribe",value:function(e){var r=this;return this.listeners.push(e),function(){r.listeners=r.listeners.filter(function(a){return a!==e})}}},{key:"notify",value:function(e){this.listeners.forEach(function(r){return r(e)})}}]),p}(),Ae=new Ds,Gl=null;function Ts(p){var t=p.getGraph,e=p.onSave,r=p.hasUnsavedChanges,a=(0,j.useRef)(!1),o=(0,j.useCallback)(function(){return r?r():kn.hasPendingChanges()||Ae.hasPendingChanges()},[r]),l=(0,j.useCallback)(function(){var s=t();if(!s)return!1;try{var u=kn.buildPayload(s);if(u){var c=new Blob([JSON.stringify({workflowConfig:u})],{type:"application/json"});return navigator.sendBeacon("/api/workflow/save",c)}}catch(v){console.error("[useBeforeUnload] sendBeacon failed:",v)}return!1},[t]);(0,j.useEffect)(function(){var s=function(c){o()&&(c.preventDefault(),c.returnValue="",l())};return window.addEventListener("beforeunload",s),function(){window.removeEventListener("beforeunload",s)}},[o,l]),(0,j.useEffect)(function(){var s=function(){document.visibilityState==="hidden"&&o()&&(e&&!a.current?(a.current=!0,e().then(function(){console.log("[useBeforeUnload] \u9875\u9762\u9690\u85CF\u65F6\u4FDD\u5B58\u6210\u529F")}).catch(function(c){console.error("[useBeforeUnload] \u9875\u9762\u9690\u85CF\u65F6\u4FDD\u5B58\u5931\u8D25:",c)}).finally(function(){a.current=!1})):l())};return document.addEventListener("visibilitychange",s),function(){document.removeEventListener("visibilitychange",s)}},[o,l,e])}var Wl=null,Rs=function(t){var e=t.graphRef,r=t.debouncedSaveFullWorkflow,a=t.changeUpdateTime,o=t.getReference,l=t.setFoldWrapItem,s=t.getNodeConfig,u=t.updateCurrentNodeRef,c=(0,Re.useModel)("workflowV3"),v=c.getWorkflow,N=(0,j.useCallback)(function(){var f=xe()(ee()().mark(function m(S){var b,k,g,C,d,y,I,w,A,D,E,R,P=arguments;return ee()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(b=P.length>1&&P[1]!==void 0?P[1]:function(){return o(v("drawerForm").id)},k=S.type,g=S.targetId,C=S.sourceNode,d=S.id,e.current){B.next=4;break}return B.abrupt("return",!1);case 4:if(k!==se.I3.created){B.next=23;break}if(y={source:String(C.id),target:g},I=Ae.addEdge(y),!I.success){B.next=18;break}return a(),B.next=11,b();case 11:return w=Ae.getNodeById(C.id),A=w?.nextNodeIds||[],u("sourceNode",{nextNodeIds:A}),r(),B.abrupt("return",A);case 18:return d&&e.current.graphDeleteEdge(d),$e.ZP.error(I.message),B.abrupt("return",!1);case 21:B.next=38;break;case 23:if(k!==se.I3.deleted){B.next=38;break}if(D=Ae.deleteEdge(String(C.id),g),!D.success){B.next=36;break}return a(),B.next=29,b();case 29:return E=Ae.getNodeById(C.id),R=E?.nextNodeIds||[],u("sourceNode",{nextNodeIds:R}),r(),B.abrupt("return",R);case 36:return $e.ZP.error(D.message),B.abrupt("return",!1);case 38:return B.abrupt("return",!1);case 39:case"end":return B.stop()}},m)}));return function(m){return f.apply(this,arguments)}}(),[o,a,r,e,u,v]),h=(0,j.useCallback)(function(){var f=xe()(ee()().mark(function m(S){var b,k,g,C,d,y,I,w,A=arguments;return ee()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(k=S.nodeData,g=S.update,C=S.targetNodeId,d=A.length>1&&A[1]!==void 0?A[1]:function(){return o(v("drawerForm").id)},y=(0,ke.Xh)(k),I=g&&g===se.Yi.moved,y.id!==se.zQ.empty){E.next=6;break}return E.abrupt("return",!1);case 6:if((b=e.current)===null||b===void 0||b.graphUpdateNode(String(y.id),y),w=Ae.updateNode(y),!w.success){E.next=18;break}if(a(),!I){E.next=13;break}return r(),E.abrupt("return",!0);case 13:return C&&y.type==="Loop"&&s(Number(k.id)),y.id===v("drawerForm").id&&l(y),d(),r(),E.abrupt("return",!0);case 18:return console.error("[V3] \u8282\u70B9\u66F4\u65B0\u5931\u8D25:",w.message),E.abrupt("return",!1);case 20:case"end":return E.stop()}},m)}));return function(m){return f.apply(this,arguments)}}(),[o,a,r,e,v,l,s]);return{nodeChangeEdge:N,changeNode:h}},Ls=["nodeConfig"],Gt=function(t,e,r){if(!t){var a=r||0;return{x:(e?.x||0)+(e?.width||0)/2+a*16,y:(e?.y||0)+(e?.height||0)/2+a*16}}return"clientX"in t?{x:t.clientX,y:t.clientY}:t},pn=function(){},Ps=function(t){var e=t.workflowId,r=t.graphRef,a=t.currentNodeRef,o=t.foldWrapItem,l=t.setFoldWrapItem,s=t.setVisible,u=t.setOpen,c=t.setCreatedItem,v=t.setDragEvent,N=t.dragEvent,h=t.preventGetReference,f=t.timerRef,m=t.changeUpdateTime,S=t.debouncedSaveFullWorkflow,b=t.changeDrawer,k=t.getNodeConfig,g=t.getReference,C=t.changeNode,d=t.nodeChangeEdge,y=(0,j.useCallback)(function(O){return[i.C8.Condition,i.C8.IntentRecognition,i.C8.QA].includes(O)},[]),I=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z){var ae,V,ne,K,z,W,M,F,T;return ee()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return ae=Z.sourceNode,V=Z.portId,ne=Z.newNodeId,K=Z.targetNode,z=Z.isLoop,W=ro(ae,V,ne,K),q.next=4,C({nodeData:W},pn);case 4:M=q.sent,M&&(T=V.split("-").slice(0,-1).join("-"),(F=r.current)===null||F===void 0||F.graphCreateNewEdge(T,String(ne),z));case 6:case"end":return q.stop()}},U)}));return function(U){return O.apply(this,arguments)}}(),[C,r]),w=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z){var ae,V,ne,K,z,W,M,F,T;return ee()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return ae=Z.sourceNode,V=Z.portId,ne=Z.newNodeId,K=Z.targetNode,z=Z.isLoop,W=oo({sourceNode:ae,id:ne,targetNodeId:K?.id}),q.next=4,C({nodeData:W},pn);case 4:M=q.sent,M&&(T=V.split("-").slice(0,-1).join("-"),(F=r.current)===null||F===void 0||F.graphCreateNewEdge(T,String(ne),z));case 6:case"end":return q.stop()}},U)}));return function(U){return O.apply(this,arguments)}}(),[C,r]),A=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z){var ae,V,ne,K,z;return ee()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return ae=Z.newNodeId,V=Z.sourceNode,ne=Z.isLoop,M.next=3,d({type:se.I3.created,targetId:ae.toString(),sourceNode:V},pn);case 3:K=M.sent,K&&((z=r.current)===null||z===void 0||z.graphCreateNewEdge(String(V.id),String(ae),ne));case 5:case"end":return M.stop()}},U)}));return function(U){return O.apply(this,arguments)}}(),[d,r]),D=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z){var ae,V,ne,K,z,W,M,F;return ee()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(ae=Z.newNode,V=Z.targetNode,ne=Z.isLoop,K=vr(ae,V),z=K.nodeData,W=K.sourcePortId,W){H.next=5;break}return console.warn("[handleConditionalNodeConnection] sourcePortId \u4E3A\u7A7A\uFF0C\u8DF3\u8FC7\u8FDE\u7EBF\u521B\u5EFA"),H.abrupt("return");case 5:return H.next=7,C({nodeData:z},pn);case 7:M=H.sent,M&&((F=r.current)===null||F===void 0||F.graphCreateNewEdge(W,String(V.id),ne));case 9:case"end":return H.stop()}},U)}));return function(U){return O.apply(this,arguments)}}(),[C,r]),E=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z){var ae,V,ne,K,z,W;return ee()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return ae=Z.newNodeId,V=Z.targetNodeId,ne=Z.newNode,K=Z.isLoop,F.next=3,d({type:se.I3.created,targetId:V,sourceNode:ne},pn);case 3:z=F.sent,z&&((W=r.current)===null||W===void 0||W.graphCreateNewEdge(String(ae),V,K));case 5:case"end":return F.stop()}},U)}));return function(U){return O.apply(this,arguments)}}(),[d,r]),R=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z){var ae,V,ne,K,z,W,M,F,T,H,q,de;return ee()().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(ae=Z.newNode,V=Z.sourceNode,ne=Z.portId,K=Z.isLoop,z=ne.split("-")[0],!y(ae.type)){ge.next=10;break}return W=vr(ae,V),M=W.nodeData,F=W.sourcePortId,ge.next=6,C({nodeData:M},pn);case 6:T=ge.sent,T&&((H=r.current)===null||H===void 0||H.graphCreateNewEdge(F,V.id.toString(),K)),ge.next=14;break;case 10:return ge.next=12,d({type:se.I3.created,targetId:z,sourceNode:ae},pn);case 12:q=ge.sent,q&&((de=r.current)===null||de===void 0||de.graphCreateNewEdge(ae.id.toString(),z.toString(),K));case 14:case"end":return ge.stop()}},U)}));return function(U){return O.apply(this,arguments)}}(),[y,C,d,r]),P=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z){var ae,V,ne,K,z,W,M,F,T,H,q,de,ce,ge,Ce,X;return ee()().wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:if(V=Z.newNode,ne=Z.targetNode,K=Z.sourceNode,z=Z.edgeId,W=Z.isLoop,M=Z.portId,F=V.type===i.C8.QA&&((ae=V.nodeConfig)===null||ae===void 0?void 0:ae.answerType)!=="SELECT",!(y(V.type)&&!F)){Ne.next=7;break}return Ne.next=5,D({newNode:V,targetNode:ne,isLoop:W});case 5:Ne.next=9;break;case 7:return Ne.next=9,E({newNodeId:V.id,targetNodeId:String(ne.id),newNode:V,isLoop:W});case 9:if(T=M.split("-"),H=T.length>=3&&T.slice(1,-1).join("-").length>=8,q=H,!q){Ne.next=20;break}return de=ao(K,M,ne.id),Ne.next=16,C({nodeData:de},pn);case 16:ce=Ne.sent,ce&&((ge=r.current)===null||ge===void 0||ge.graphDeleteEdge(z)),Ne.next=24;break;case 20:return Ne.next=22,d({type:se.I3.deleted,targetId:ne.id.toString(),sourceNode:K},pn);case 22:Ce=Ne.sent,Ce&&((X=r.current)===null||X===void 0||X.graphDeleteEdge(z));case 24:case"end":return Ne.stop()}},U)}));return function(U){return O.apply(this,arguments)}}(),[r,y,D,E,d,C]),G=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z){var ae,V,ne,K,z,W,M,F,T,H,q,de,ce,ge;return ee()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if((ae=r.current)===null||ae===void 0||ae.graphAddNode(Z.nodeConfig.extension,Z),(V=r.current)===null||V===void 0||V.graphSelectNode(String(Z.id)),b(Z),!a.current){X.next=44;break}if(ne=a.current,K=ne.portId,z=ne.edgeId,W=ne.sourceNode,M=ne.targetNode,F=!!Z.loopNodeId,T=Z,H=K.endsWith("out"),q=K.includes(se.TG.exception),de=K.split("-"),ce=de.length>=3&&de.slice(1,-1).join("-").length>=8,ge=!q&&ce,X.prev=12,!q){X.next=18;break}return X.next=16,w({sourceNode:W,portId:K,newNodeId:Z.id,targetNode:M,isLoop:F});case 16:X.next=30;break;case 18:if(!ge){X.next=23;break}return X.next=21,I({sourceNode:W,portId:K,newNodeId:Z.id,targetNode:M,isLoop:F});case 21:X.next=30;break;case 23:if(!H){X.next=28;break}return X.next=26,A({newNodeId:Z.id,sourceNode:W,isLoop:F});case 26:X.next=30;break;case 28:return X.next=30,R({newNode:T,sourceNode:W,portId:K,isLoop:F});case 30:if(!M){X.next=33;break}return X.next=33,P({newNode:T,targetNode:M,sourceNode:W,edgeId:z,isLoop:F,portId:K});case 33:return X.next=35,g(Z.id);case 35:X.next=41;break;case 37:throw X.prev=37,X.t0=X.catch(12),console.error("\u5904\u7406\u8282\u70B9\u8FDE\u63A5\u65F6\u53D1\u751F\u9519\u8BEF:",X.t0),X.t0;case 41:return X.prev=41,a.current=null,X.finish(41);case 44:case"end":return X.stop()}},U,null,[[12,37,41,44]])}));return function(U){return O.apply(this,arguments)}}(),[r,a,b,I,w,A,R,P,g]),B=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z,ae){var V,ne,K,z,W,M,F,T,H,q,de,ce,ge,Ce,X,fe,Ne,De,Ze,Me;return ee()().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:if(V=JSON.parse(JSON.stringify(Z)),V.workflowId=e,V.extension=ae,ne=lt({data:V,ports:[],type:se.yn.create}),K=ne.width,z=ne.height,W=[i.C8.Condition,i.C8.QA,i.C8.IntentRecognition,i.C8.Loop],Z.type&&W.includes(Z.type)&&(M=Z.type===i.C8.Loop?Ar:K,F=Z.type===i.C8.Loop?Dr:z,V.extension=x()(x()({},ae),{},{height:F,width:M})),!(o.type===i.C8.Loop||o.loopNodeId)){we.next=13;break}if(V.type!==i.C8.Loop){we.next=10;break}return $e.ZP.warning("\u5FAA\u73AF\u4F53\u91CC\u8BF7\u4E0D\u8981\u518D\u6DFB\u52A0\u5FAA\u73AF\u4F53"),we.abrupt("return");case 10:V.loopNodeId=Number(o.loopNodeId)||Number(o.id),T=Ae.getNodeById(V.loopNodeId),T&&(H=T.nodeConfig.extension,V.extension=x()(x()({},V.extension),{},{x:(H?.x||0)+40,y:(H?.y||0)+110}));case 13:return a.current&&(q=a.current,de=q.sourceNode,ce=q.portId,de.loopNodeId?V.loopNodeId=de.loopNodeId:de.type===i.C8.Loop&&ce&&ce.includes("in")&&(V.loopNodeId=Number(de.id))),V.nodeConfig?V.extension||(V.extension=V.nodeConfig.extension):V.nodeConfig={extension:V.extension},Ce=null,we.prev=16,De=V.nodeConfigDto||V.nodeConfig?x()(x()(x()(x()({},V.nodeConfigDto),(X=V.nodeConfig)!==null&&X!==void 0&&X.toolName?{toolName:V.nodeConfig.toolName}:{}),(fe=V.nodeConfig)!==null&&fe!==void 0&&fe.mcpId?{mcpId:V.nodeConfig.mcpId}:{}),(Ne=V.nodeConfig)!==null&&Ne!==void 0&&Ne.knowledgeBaseConfigs?{knowledgeBaseConfigs:V.nodeConfig.knowledgeBaseConfigs}:{}):void 0,we.next=20,an._H({workflowId:e,type:V.type,typeId:V.typeId,name:V.name,shape:V.shape,description:V.description,loopNodeId:V.loopNodeId,extension:V.extension,nodeConfigDto:De});case 20:if(Ze=we.sent,!(Ze.code===cn.ZP.success&&Ze.data)){we.next=26;break}ge=Ze.data.id,Ce=Ze.data,we.next=29;break;case 26:return $e.ZP.error(Ze.message||"\u6DFB\u52A0\u8282\u70B9\u5931\u8D25"),console.error("[V3] \u6DFB\u52A0\u8282\u70B9 API \u5931\u8D25:",Ze.message),we.abrupt("return");case 29:we.next=36;break;case 31:return we.prev=31,we.t0=we.catch(16),$e.ZP.error("\u7F51\u7EDC\u5F02\u5E38\uFF0C\u6DFB\u52A0\u8282\u70B9\u5931\u8D25"),console.error("[V3] \u6DFB\u52A0\u8282\u70B9 API \u5F02\u5E38:",we.t0),we.abrupt("return");case 36:if(V.id=ge,Ce&&(V=x()(x()(x()({},V),Ce),{},{nodeConfig:x()(x()({},Ce.nodeConfig),{},{extension:V.extension})}),V.type===i.C8.Loop&&(V.nodeConfig.extension=x()(x()({},V.nodeConfig.extension),{},{width:Ar,height:Dr}),Ce.innerNodes&&Ce.innerNodes.length>0&&(V.innerNodes=Ce.innerNodes.map(function(tn){if(tn.type===i.C8.LoopStart||tn.type===i.C8.LoopEnd){var Nn;return x()(x()({},tn),{},{nodeConfig:x()(x()({},tn.nodeConfig),{},{extension:x()(x()({},(Nn=tn.nodeConfig)===null||Nn===void 0?void 0:Nn.extension),{},{x:void 0,y:void 0})})})}return tn})))),Me=Ae.addNode(V),!Me.success){we.next=51;break}return we.prev=40,we.next=43,G(V);case 43:S(),we.next=49;break;case 46:we.prev=46,we.t1=we.catch(40),console.error("\u5904\u7406\u8282\u70B9\u521B\u5EFA\u6210\u529F\u540E\u7684\u64CD\u4F5C\u5931\u8D25:",we.t1);case 49:we.next=52;break;case 51:console.warn("[V3] \u6DFB\u52A0\u8282\u70B9\u4EE3\u7406\u5C42\u5931\u8D25:",Me.message);case 52:case"end":return we.stop()}},U,null,[[16,31],[40,46]])}));return function(U,Z){return O.apply(this,arguments)}}(),[e,o,a,G,S]),Y=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z,ae){var V,ne,K,z,W,M,F,T,H,q,de,ce,ge,Ce,X,fe;return ee()().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.prev=0,De.next=3,an.rF(Z.id.toString());case 3:V=De.sent,V.code===cn.ZP.success&&V.data?(z=V.data,W=z.nodeConfig,M=hr()(z,Ls),F=W?.extension||{},T=Z.nodeConfig||{},H=T.toolName,q=T.mcpId,de=(ne=ae?.x)!==null&&ne!==void 0?ne:32,ce=(K=ae?.y)!==null&&K!==void 0?K:32,ge=x()(x()({},M),{},{shape:St(V.data.type),nodeConfig:x()(x()(x()({},W),H?{toolName:H,mcpId:q}:{}),{},{extension:x()(x()({},F),{},{x:(F.x||0)+de,y:(F.y||0)+ce})})}),Ce=Ae.addNode(ge),Ce.success?((X=r.current)===null||X===void 0||X.graphAddNode(ge.nodeConfig.extension,ge),(fe=r.current)===null||fe===void 0||fe.graphSelectNode(String(ge.id)),m()):console.warn("[V3] \u590D\u5236\u8282\u70B9\u4EE3\u7406\u5C42\u6DFB\u52A0\u5931\u8D25:",Ce.message)):$e.ZP.error(V.message||"\u590D\u5236\u5931\u8D25"),De.next=11;break;case 7:De.prev=7,De.t0=De.catch(0),console.error("[V3] \u590D\u5236\u8282\u70B9 API \u5F02\u5E38:",De.t0),$e.ZP.error("\u7F51\u7EDC\u5F02\u5E38\uFF0C\u590D\u5236\u8282\u70B9\u5931\u8D25");case 11:case"end":return De.stop()}},U,null,[[0,7]])}));return function(U,Z){return O.apply(this,arguments)}}(),[r,m]),le=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z,ae){var V,ne,K;return ee()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:s(!1),h.current=Number(Z),l({id:0,description:"",shape:i.K$.General,workflowId:e,type:i.C8.Start,nodeConfig:{},name:"",icon:""}),V=Ae.deleteNode(Number(Z)),V.success?(K=(ne=r.current)===null||ne===void 0?void 0:ne.getGraphRef(),K&&K.batchUpdate("delete-node",function(){var M;(M=r.current)===null||M===void 0||M.graphDeleteNode(String(Z)),V.data&&V.data.nodes.forEach(function(F){var T=K.getCellById(String(F.id));if(T&&T.isNode()){var H=T.getData();JSON.stringify(H.nextNodeIds)!==JSON.stringify(F.nextNodeIds)&&T.setData({nextNodeIds:F.nextNodeIds})}})}),f.current&&clearTimeout(f.current),m(),S(),ae&&(ae.type==="Loop"?b(null):k(ae.loopNodeId))):$e.ZP.error(V.message||"\u5220\u9664\u5931\u8D25");case 5:case"end":return W.stop()}},U)}));return function(U,Z){return O.apply(this,arguments)}}(),[e,r,s,l,h,f,m,S,b,k]),re=(0,j.useCallback)(function(O,U){if(!(U&&U!=="workflow")){var Z;if(O.targetType===Se.qR.Knowledge||O.targetType===Se.qR.Table){var ae=[x()(x()({},O),{},{type:i.C8.Knowledge,knowledgeBaseId:O.targetId})],V=sessionStorage.getItem("tableType");Z={name:O.name,shape:i.K$.General,description:O.description,type:O.targetType===Se.qR.Knowledge?i.C8.Knowledge:V||i.C8.TableDataQuery,typeId:O.targetId,nodeConfig:{knowledgeBaseConfigs:ae,extension:{}}}}else if(O.targetType===Se.qR.Workflow||O.targetType===Se.qR.Plugin){var ne=O.targetType===Se.qR.Workflow?i.C8.Workflow:i.C8.Plugin;Z={name:O.name,shape:i.K$.General,description:O.description,type:ne,typeId:O.targetId}}else if(O.targetType===Se.qR.MCP)Z={name:O.name,shape:i.K$.General,description:O.description,type:i.C8.MCP,typeId:O.targetId,nodeConfig:{toolName:O.toolName,mcpId:O.targetId}};else{$e.ZP.warning("\u6682\u4E0D\u652F\u6301\u8BE5\u7C7B\u578B\u7EC4\u4EF6");return}B(Z,N),sessionStorage.getItem("tableType")&&sessionStorage.removeItem("tableType"),u(!1)}},[B,N,u]),Q=(0,j.useCallback)(function(){var O=xe()(ee()().mark(function U(Z,ae,V){var ne,K,z,W,M,F;return ee()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(K=Z?.type||"",z=[i.C8.Plugin,i.C8.Workflow,i.C8.MCP].includes(K),W=["TableDataAdd","TableDataDelete","TableDataUpdate","TableDataQuery","TableSQL"].includes(K),M=(ne=r.current)===null||ne===void 0?void 0:ne.getCurrentViewPort(),!z){H.next=10;break}c(K),u(!0),v(Gt(ae,M,V)),H.next=20;break;case 10:if(!W){H.next=17;break}c(Se.qR.Table),u(!0),v(Gt(ae,M,V)),sessionStorage.setItem("tableType",K),H.next=20;break;case 17:return F=Gt(ae,M,V),H.next=20,B(Z,F);case 20:case"end":return H.stop()}},U)}));return function(U,Z,ae){return O.apply(this,arguments)}}(),[r,c,u,v,B]);return{isConditionalNode:y,handleSpecialPortConnection:I,handleExceptionPortConnection:w,handleOutputPortConnection:A,handleConditionalNodeConnection:D,handleNormalNodeConnection:E,handleInputPortConnection:R,handleTargetNodeConnection:P,handleNodeCreationSuccess:G,addNode:B,copyNode:Y,deleteNode:le,onAdded:re,dragChild:Q}},Kr=L(16722),Jr=L(81332),Vs=function(t){var e=t.workflowId,r=t.spaceId,a=t.graphRef,o=t.info,l=t.foldWrapItem,s=t.validWorkflow,u=t.onSaveWorkflow,c=t.getWorkflow,v=t.isModified,N=t.setIsModified,h=t.changeUpdateTime,f=t.setErrorParams,m=(0,Re.useModel)("model"),S=m.testRun,b=m.setTestRun,k=(0,j.useState)(!1),g=me()(k,2),C=g[0],d=g[1],y=(0,j.useState)(""),I=me()(y,2),w=I[0],A=I[1],D=(0,j.useState)(!1),E=me()(D,2),R=E[0],P=E[1],G=(0,j.useState)(!1),B=me()(G,2),Y=B[0],le=B[1],re=(0,j.useState)(null),Q=me()(re,2),O=Q[0],U=Q[1],Z=(0,j.useState)(null),ae=me()(Z,2),V=ae[0],ne=ae[1],K=(0,j.useCallback)(function(){var T;A(""),(T=a.current)===null||T===void 0||T.graphResetRunResult()},[a]),z=(0,j.useCallback)(function(){var T=xe()(ee()().mark(function H(q){var de,ce;return ee()().wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return de={nodeId:l.id,params:q},A(""),Ce.next=4,(0,Jr.W)({url:"".concat("","/api/workflow/test/node/execute"),method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem(Kr.LA)),Accept:" application/json, text/plain, */* "},body:de,onMessage:function(fe){fe.success?(fe.complete&&(fe.data&&fe.data.output&&A(fe.data.output),A(JSON.stringify(fe.data,null,2)),jt({spaceId:r,workflowId:e})),fe.data.status==="STOP_WAIT_ANSWER"&&(d(!1),le(!0),gr({spaceId:r,workflowId:e,value:JSON.stringify(q)}))):fe.message&&A(fe.message)},onError:function(fe){console.error("\u6D41\u5F0F\u8BF7\u6C42\u5F02\u5E38:",fe)},onOpen:function(fe){console.log("\u8FDE\u63A5\u5DF2\u5EFA\u7ACB",fe.status)},onClose:function(){d(!1)}});case 4:ce=Ce.sent,ce();case 6:case"end":return Ce.stop()}},H)}));return function(H){return T.apply(this,arguments)}}(),[l.id,r,e]),W=(0,j.useCallback)(function(){var T=xe()(ee()().mark(function H(q){var de;return ee()().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return d(!0),ge.next=3,(0,Jr.W)({url:"".concat("","/api/workflow/test/execute"),method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem(Kr.LA)),Accept:" application/json, text/plain, */* "},body:q,onMessage:function(X){if(X.data&&X.data.nodeId){var fe,Ne={requestId:X.requestId,options:x()(x()({},X.data.result),{},{nodeId:X.data.nodeId,nodeName:X.data.nodeName}),status:X.data.status};(fe=a.current)===null||fe===void 0||fe.graphActiveNodeRunResult(X.data.nodeId.toString(),Ne)}if(!X.success)f(function(Me){return X.data&&X.data.result?{errorList:[].concat(Ee()(Me.errorList),[X.data.result]),show:!0}:X.data?Me:{errorList:[].concat(Ee()(Me.errorList),[{error:X.message}]),show:!0}});else{if(X.complete){var De,Ze;X.data&&X.data.output&&(A(X.data.output),jt({spaceId:r,workflowId:e})),ne((De=X.nodeExecuteResultMap[(o==null||(Ze=o.startNode)===null||Ze===void 0?void 0:Ze.id).toString()])===null||De===void 0?void 0:De.data),A(JSON.stringify(X.data,null,2)),d(!1)}X.data.status==="STOP_WAIT_ANSWER"&&(d(!1),le(!0),gr({spaceId:r,workflowId:e,value:JSON.stringify(q)}),X.data.result&&U(X.data.result.data))}},onError:function(X){console.error("\u6D41\u5F0F\u8BF7\u6C42\u5F02\u5E38:",X)},onOpen:function(X){console.log("\u8FDE\u63A5\u5DF2\u5EFA\u7ACB",X.status)},onClose:function(){d(!1)}});case 3:de=ge.sent,de(),h();case 6:case"end":return ge.stop()}},H)}));return function(H){return T.apply(this,arguments)}}(),[a,r,e,o,h]),M=(0,j.useCallback)(xe()(ee()().mark(function T(){var H,q;return ee()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return H=setTimeout(function(){P(!0)},300),ce.prev=1,ce.next=4,s();case 4:q=ce.sent,q&&(A(""),b(!0)),ce.next=11;break;case 8:ce.prev=8,ce.t0=ce.catch(1),console.error("\u8BD5\u8FD0\u884C\u6240\u6709\u8282\u70B9\u5931\u8D25:",ce.t0);case 11:return ce.prev=11,clearTimeout(H),P(!1),ce.finish(11);case 15:case"end":return ce.stop()}},T,null,[[1,8,11,15]])})),[s]),F=(0,j.useCallback)(function(){var T=xe()(ee()().mark(function H(q,de){var ce,ge;return ee()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(f({errorList:[],show:!1}),K(),q!=="Start"){X.next=8;break}ge=so({spaceId:r,workflowId:e}),ge?(ce=x()(x()({},JSON.parse(ge)),de),le(!1),jt({spaceId:r,workflowId:e})):ce={workflowId:o?.id,params:de,requestId:(0,Xe.Z)()},W(ce),X.next=17;break;case 8:if(q!=="Code"){X.next=16;break}if(!v){X.next=13;break}return N(!1),X.next=13,u(c("drawerForm"));case 13:z(de),X.next=17;break;case 16:z(de);case 17:d(!0);case 18:case"end":return X.stop()}},H)}));return function(H,q){return T.apply(this,arguments)}}(),[K,r,e,o,W,v,N,u,c,z]);return{loading:C,setLoading:d,testRun:S,setTestRun:b,testRunResult:w,setTestRunResult:A,testRunLoading:R,stopWait:Y,setStopWait:le,testRunParams:O,setTestRunParams:U,formItemValue:V,setFormItemValue:ne,nodeTestRun:z,testRunAllNode:W,testRunAll:M,runTest:F,handleClearRunResult:K}},Bs=function(t){var e=t.graphRef,r=t.graphInstanceRef,a=t.debouncedSaveFullWorkflow,o=(0,j.useState)({canUndo:!1,canRedo:!1}),l=me()(o,2),s=l[0],u=l[1];(0,j.useEffect)(function(){var N=function(f){var m,S=document.activeElement,b=S instanceof HTMLInputElement||S instanceof HTMLTextAreaElement||S?.isContentEditable;if(!b){var k=f.metaKey||f.ctrlKey,g=(m=e.current)===null||m===void 0?void 0:m.getGraphRef();g&&(k&&f.key.toLowerCase()==="z"&&!f.shiftKey&&(f.preventDefault(),g.canUndo()?(mn(!0),g.undo(),setTimeout(function(){mn(!1)},200)):$e.ZP.warning("\u6CA1\u6709\u53EF\u64A4\u9500\u7684\u64CD\u4F5C")),(k&&f.key.toLowerCase()==="z"&&f.shiftKey||k&&f.key.toLowerCase()==="y")&&(f.preventDefault(),g.canRedo()?(mn(!0),g.redo(),setTimeout(function(){mn(!1)},200)):$e.ZP.warning("\u6CA1\u6709\u53EF\u91CD\u505A\u7684\u64CD\u4F5C")))}};return window.addEventListener("keydown",N),function(){return window.removeEventListener("keydown",N)}},[e]),(0,j.useEffect)(function(){var N=setInterval(function(){var h,f=(h=e.current)===null||h===void 0?void 0:h.getGraphRef();if(f){r.current=f,clearInterval(N);var m=function(){u({canUndo:f.canUndo(),canRedo:f.canRedo()})},S=function(){if(Ae){var k=f.getNodes().map(function(C){var d,y=C.getData(),I=C.getPosition(),w=C.getSize();return x()(x()({},y),{},{nodeConfig:x()(x()({},y.nodeConfig),{},{extension:x()(x()({},(d=y.nodeConfig)===null||d===void 0?void 0:d.extension),{},{x:I.x,y:I.y,width:w.width,height:w.height})})})}),g=f.getEdges().map(function(C){var d=C.getSource(),y=C.getTarget();return{id:C.id,source:d?.cell||d,target:y?.cell||y,sourcePort:d?.port||void 0,targetPort:y?.port||void 0,zIndex:C.getZIndex()}});Ae.syncFromGraph(k,g,!0),a()}};f.on("history:change",m),f.on("history:undo",function(){S()}),f.on("history:redo",function(){S()}),m()}},500);return function(){return clearInterval(N)}},[e,r,a]);var c=function(){var h,f=(h=e.current)===null||h===void 0?void 0:h.getGraphRef();f!=null&&f.canUndo()?(mn(!0),f.undo(),setTimeout(function(){mn(!1)},200)):$e.ZP.warning("\u6CA1\u6709\u53EF\u64A4\u9500\u7684\u64CD\u4F5C")},v=function(){var h,f=(h=e.current)===null||h===void 0?void 0:h.getGraphRef();f!=null&&f.canRedo()?(mn(!0),f.redo(),setTimeout(function(){mn(!1)},200)):$e.ZP.warning("\u6CA1\u6709\u53EF\u91CD\u505A\u7684\u64CD\u4F5C")};return{historyState:s,handleUndo:c,handleRedo:v}},Zs=function(t){var e=t.workflowId,r=t.handleInitLoading,a=(0,Re.useModel)("workflowV3"),o=a.setSpaceId,l=(0,j.useRef)(!1),s=(0,j.useState)(null),u=me()(s,2),c=u[0],v=u[1],N=(0,j.useState)({nodeList:[],edgeList:[]}),h=me()(N,2),f=h[0],m=h[1],S=(0,j.useCallback)(xe()(ee()().mark(function k(){var g,C,d;return ee()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.prev=0,I.next=3,an.ZP.getDetails(e);case 3:g=I.sent,g.code===cn.ZP.success&&(C=g.data.nodes||[],d=Wn(C),m({edgeList:d,nodeList:C})),I.next=10;break;case 7:I.prev=7,I.t0=I.catch(0),console.error("Failed to refresh graph data:",I.t0);case 10:case"end":return I.stop()}},k,null,[[0,7]])})),[e]),b=(0,j.useCallback)(function(){var k=xe()(ee()().mark(function g(C,d){var y;return ee()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:y=new Date,v(function(A){var D,E,R;return A?x()(x()({},A),{},{modified:y.toString(),name:(D=C.name)!==null&&D!==void 0?D:A.name,description:(E=C.description)!==null&&E!==void 0?E:A.description,icon:(R=C.icon)!==null&&R!==void 0?R:A.icon}):null}),d&&d();case 3:case"end":return w.stop()}},g)}));return function(g,C){return k.apply(this,arguments)}}(),[]);return(0,j.useEffect)(function(){var k=function(){var g=xe()(ee()().mark(function C(){var d,y,I,w;return ee()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!l.current){D.next=2;break}return D.abrupt("return");case 2:return l.current=!0,r(!0),D.prev=4,D.next=7,an.ZP.getDetails(e);case 7:d=D.sent,d.code===cn.ZP.success&&(y=d.data,v(y),o(y.spaceId),I=y.nodes||[],w=Wn(I),m({edgeList:w,nodeList:I}),Ae.initialize({workflowId:e,nodes:I,edges:w,systemVariables:y.systemVariables,modified:y.modified||new Date().toISOString()}),Ae.setWorkflowInfo(y),kn.initialize(y)),D.next=14;break;case 11:D.prev=11,D.t0=D.catch(4),console.error("Failed to fetch graph data:",D.t0);case 14:return D.prev=14,r(!1),D.finish(14);case 17:case"end":return D.stop()}},C,null,[[4,11,14,17]])}));return function(){return g.apply(this,arguments)}}();e&&k()},[e,r,o]),{info:c,setInfo:v,graphParams:f,setGraphParams:m,onConfirm:b,refreshGraphData:S}},Os=function(t){var e=t.graphRef,r=t.graphInstanceRef,a=t.changeUpdateTime,o=t.getReference,l=t.setFoldWrapItem,s=(0,Re.useModel)("workflowV3"),u=s.getWorkflow,c=s.setSaveStatus,v=s.setLastSaveTime,N=s.setSaveError,h=(0,j.useCallback)(xe()(ee()().mark(function S(){var b,k,g,C,d;return ee()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(I.prev=0,g=((b=e.current)===null||b===void 0||(k=b.getGraphRef)===null||k===void 0?void 0:k.call(b))||r?.current,g){I.next=5;break}return console.error("[V3] \u753B\u5E03\u672A\u521D\u59CB\u5316"),I.abrupt("return",!1);case 5:if(C=kn.buildPayload(g),C){I.next=15;break}if(console.warn("[V3] \u753B\u5E03\u6570\u636E\u65E0\u6548\uFF0C\u5C1D\u8BD5\u4F7F\u7528 workflowProxy \u6570\u636E"),C=Ae.buildFullConfig(),C){I.next=12;break}return console.error("[V3] \u6784\u5EFA\u4FDD\u5B58\u6570\u636E\u5931\u8D25\uFF0C\u65E0\u53EF\u7528\u6570\u636E\u6E90"),I.abrupt("return",!1);case 12:console.log("[V3] \u4F7F\u7528 workflowProxy \u6570\u636E\u4FDD\u5B58"),I.next=16;break;case 15:console.log("[V3] \u4F7F\u7528\u5355\u4E00\u6570\u636E\u6E90\u4FDD\u5B58, \u8282\u70B9\u6570:",C.nodes.length);case 16:return c(ln.X.Saving),I.next=19,an.ZP.saveWorkflow(C);case 19:if(d=I.sent,d.code!==cn.ZP.success){I.next=31;break}return kn.clearDirty(),Ae.clearPendingUpdates(),a(),c(ln.X.Saved),v(new Date),N(null),console.log("[V3] \u4FDD\u5B58\u6210\u529F \u2713"),I.abrupt("return",!0);case 31:return console.error("[V3] \u5DE5\u4F5C\u6D41\u4FDD\u5B58\u5931\u8D25:",d.message),c(ln.X.Failed),N(d.message||"\u4FDD\u5B58\u5931\u8D25"),I.abrupt("return",!1);case 35:I.next=43;break;case 37:return I.prev=37,I.t0=I.catch(0),console.error("[V3] \u5DE5\u4F5C\u6D41\u4FDD\u5B58\u5F02\u5E38:",I.t0),c(ln.X.Failed),N(I.t0 instanceof Error?I.t0.message:"\u7F51\u7EDC\u5F02\u5E38\uFF0C\u4FDD\u5B58\u5931\u8D25"),I.abrupt("return",!1);case 43:case"end":return I.stop()}},S,null,[[0,37]])})),[a,e,c,v,N]),f=(0,j.useMemo)(function(){return(0,tt.debounce)(xe()(ee()().mark(function S(){return ee()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!(kn.hasPendingChanges()||Ae.hasPendingChanges())){k.next=3;break}return k.next=3,h();case 3:case"end":return k.stop()}},S)})),1500)},[h]),m=(0,j.useCallback)(function(){var S=xe()(ee()().mark(function b(k,g){var C,d,y,I;return ee()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(k.id!==se.zQ.empty){A.next=2;break}return A.abrupt("return",!1);case 2:if(d=JSON.parse(JSON.stringify(k)),(C=e.current)===null||C===void 0||C.graphUpdateNode(String(d.id),d),y=Ae.updateNode(d),!y.success){A.next=15;break}if(c(ln.X.Unsaved),I=u("drawerForm"),k.id===I?.id&&(g?g(d):l&&l(d)),!(I!=null&&I.id)){A.next=12;break}return A.next=12,o(I.id);case 12:return a(),f(),A.abrupt("return",!0);case 15:return console.error("[V3] \u8282\u70B9\u914D\u7F6E\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25:",y.message),A.abrupt("return",!1);case 17:case"end":return A.stop()}},b)}));return function(b,k){return S.apply(this,arguments)}}(),[o,a,f,u,e,l,c]);return{saveFullWorkflow:h,debouncedSaveFullWorkflow:f,autoSaveNodeConfig:m}},Gs=function(t){var e=t.workflowId,r=t.info,a=t.graphRef,o=t.getWorkflow,l=t.setGraphParams,s=t.changeDrawer,u=t.setInfo,c=t.setErrorParams,v=t.doSubmitFormData,N=t.saveFullWorkflow,h=t.getDetails,f=(0,j.useState)(!1),m=me()(f,2),S=m[0],b=m[1],k=(0,j.useState)(!1),g=me()(k,2),C=g[0],d=g[1],y=(0,j.useCallback)(xe()(ee()().mark(function D(){var E,R,P,G,B,Y,le,re;return ee()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(!Ae.hasPendingChanges()){O.next=7;break}return O.next=3,N();case 3:if(R=O.sent,R){O.next=7;break}return console.error("[V3] \u5DE5\u4F5C\u6D41\u4FDD\u5B58\u5931\u8D25\uFF0C\u65E0\u6CD5\u8FDB\u884C\u6821\u9A8C"),O.abrupt("return",!1);case 7:if(o("isModified")!==!0){O.next=10;break}return O.next=10,v();case 10:return O.next=12,an.s_(e);case 12:return P=O.sent,G=P.data.nodes,B=Wn(G),l(function(U){return x()(x()({},U),{},{nodeList:G,edgeList:B})}),s(P.data.startNode),(E=a.current)===null||E===void 0||E.graphSelectNode(String(P.data.startNode.id)),O.next=20,an.$l(r?.id);case 20:if(Y=O.sent,Y.code!==cn.ZP.success){O.next=32;break}if(le=Y.data.filter(function(U){return!U.success}),le.length!==0){O.next=27;break}return O.abrupt("return",!0);case 27:return re=le.map(function(U){return{nodeId:U.nodeId,error:U.messages.join(",")}}),c({show:!0,errorList:re}),O.abrupt("return",!1);case 30:O.next=33;break;case 32:return O.abrupt("return",!1);case 33:case"end":return O.stop()}},D)})),[e,r,a,o,l,s,c,v,N]),I=(0,j.useCallback)(xe()(ee()().mark(function D(){var E,R,P;return ee()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(!Ae.hasPendingChanges()){B.next=3;break}return B.next=3,N();case 3:if(o("isModified")!==!0){B.next=6;break}return B.next=6,v();case 6:return B.next=8,an.$l(r?.id);case 8:if(E=B.sent,E.code!==cn.ZP.success){B.next=20;break}if(R=E.data.filter(function(Y){return!Y.success}),R.length!==0){B.next=15;break}return B.abrupt("return",!0);case 15:return P=R.map(function(Y){return{nodeId:Y.nodeId,error:Y.messages.join(",")}}),c({show:!0,errorList:P}),B.abrupt("return",!1);case 18:B.next=21;break;case 20:return B.abrupt("return",!1);case 21:case"end":return B.stop()}},D)})),[r,o,c,v,N]),w=(0,j.useCallback)(xe()(ee()().mark(function D(){var E,R;return ee()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return E=setTimeout(function(){b(!0)},300),G.next=3,I();case 3:return R=G.sent,G.next=6,h();case 6:R&&(d(!0),c(function(B){return x()(x()({},B),{},{errorList:[],show:!1})})),E&&clearTimeout(E),b(!1);case 9:case"end":return G.stop()}},D)})),[I,h,c]),A=(0,j.useCallback)(function(){d(!1);var D=new Date;u(function(E){return E?x()(x()({},E),{},{modified:D.toString(),publishDate:D.toString(),publishStatus:"Published"}):null})},[u]);return{isValidLoading:S,setIsValidLoading:b,showPublish:C,setShowPublish:d,validWorkflow:y,validPublishWorkflow:I,handleShowPublish:w,handleConfirmPublishWorkflow:A}},Ws=L(63606),Ms="EXECUTE_EXCEPTION_FLOW",Yr="INDEX";function qr(p){var t,e,r,a,o=new Set;(p.nextNodeIds||[]).forEach(function(s){s!==p.loopNodeId&&o.add(s)}),p.type===i.C8.Condition&&(t=p.nodeConfig)!==null&&t!==void 0&&t.conditionBranchConfigs&&p.nodeConfig.conditionBranchConfigs.forEach(function(s){var u;return(u=s.nextNodeIds)===null||u===void 0?void 0:u.forEach(function(c){return o.add(c)})}),p.type===i.C8.IntentRecognition&&(e=p.nodeConfig)!==null&&e!==void 0&&e.intentConfigs&&p.nodeConfig.intentConfigs.forEach(function(s){var u;return(u=s.nextNodeIds)===null||u===void 0?void 0:u.forEach(function(c){return o.add(c)})}),p.type===i.C8.QA&&(r=p.nodeConfig)!==null&&r!==void 0&&r.options&&p.nodeConfig.options.forEach(function(s){var u;return(u=s.nextNodeIds)===null||u===void 0?void 0:u.forEach(function(c){return o.add(c)})});var l=(a=p.nodeConfig)===null||a===void 0?void 0:a.exceptionHandleConfig;return l?.exceptionHandleType===Ms&&l.exceptionHandleNodeIds&&l.exceptionHandleNodeIds.forEach(function(s){return o.add(s)}),Array.from(o)}function Hs(p){var t=new Map;return p.forEach(function(e){var r=Number(e.id);t.set(r,e)}),t}function _r(p,t){var e=new Map;p.forEach(function(a){e.set(Number(a.id),[])});var r=function(o,l){var s=e.get(l);s&&!s.includes(o)&&s.push(o)};return p.forEach(function(a){var o=Number(a.id),l=qr(a);l.forEach(function(s){return r(o,s)})}),t&&t.length>0&&t.forEach(function(a){var o=parseInt(a.source,10),l=parseInt(a.target,10);!isNaN(o)&&!isNaN(l)&&r(o,l)}),e}function Us(p){var t=new Map;return p.forEach(function(e){t.set(Number(e.id),qr(e))}),t}function $s(p,t){for(var e=new Set,r=[p];r.length>0;){var a=r.pop(),o=t.get(a)||[];o.forEach(function(l){e.has(l)||(e.add(l),r.push(l))})}return e}function Wt(p,t){for(var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Set,r=[],a=Ee()(t.get(p)||[]);a.length>0;){var o=a.shift();if(!e.has(o)){e.add(o),r.push(o);var l=t.get(o)||[];l.forEach(function(s){e.has(s)||a.push(s)})}}return r}function Qn(p){return JSON.parse(JSON.stringify(p))}function zs(p){var t=Ee()(p.nodeConfig.outputArgs||[]),e=p.type===i.C8.Variable&&p.nodeConfig.configType==="SET_VARIABLE",r=t.some(function(a){return a.name==="isSuccess"});return e&&!r&&t.push({name:"isSuccess",dataType:i.Gi.Boolean,description:"\u53D8\u91CF\u8BBE\u7F6E\u7ED3\u679C",require:!1,systemVariable:!1,bindValueType:void 0,bindValue:"",key:"isSuccess",subArgs:[]}),t}function Mt(p){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];if(p.type===i.C8.Start){var e,r,a=((e=p.nodeConfig)===null||e===void 0||(e=e.inputArgs)===null||e===void 0?void 0:e.map(function(s){return x()(x()({},Qn(s)),{},{bindValueType:void 0,bindValue:""})}))||[],o=((r=p.nodeConfig)===null||r===void 0?void 0:r.outputArgs)||[];return[].concat(Ee()(a),Ee()(t),Ee()(o))}if(p.type===i.C8.Loop){var l=Ee()(p.nodeConfig.outputArgs||[]);return l.some(function(s){return s.name==="INDEX"})||l.push({name:"INDEX",dataType:i.Gi.Integer,description:"\u6570\u7EC4\u7D22\u5F15",require:!1,systemVariable:!0,bindValueType:void 0,bindValue:"",key:"INDEX",subArgs:[]}),l}return zs(p)}function Ml(p,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=[t].concat(_toConsumableArray(e)).join(".");return"".concat(p,".").concat(r)}function xn(p,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return t.map(function(r){var a=r.name||r.key||"",o=[].concat(Ee()(e),[a]),l="".concat(p,".").concat(o.join(".")),s=x()(x()({},r),{},{key:l}),u=r.subArgs||r.children;return u&&u.length>0&&(s.subArgs=xn(p,u,o),s.children=s.subArgs),s})}function vn(p,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r={};return t.forEach(function(a){var o=a.name||a.key||"",l=[].concat(Ee()(e),[o]),s="".concat(p,".").concat(l.join("."));r[s]=a;var u=a.subArgs||a.children;if(u&&u.length>0){var c=vn(p,u,l);Object.assign(r,c)}}),r}function Ht(p,t){var e=t.nodes,r=t.edges,a=t.systemVariables,o=a===void 0?[]:a,l=Hs(e),s=_r(e,r),u=Us(e),c=Number(p),v=$s(c,u),N=Wt(c,s).filter(function(F){return F!==c&&!v.has(F)}),h=[],f={},m=l.get(c);if(N.forEach(function(F){var T=l.get(F);if(T&&!(T.type===i.C8.LoopStart||T.type===i.C8.LoopEnd)&&!(m!=null&&m.loopNodeId&&T.id===m.loopNodeId)&&!(T.loopNodeId&&Number(T.loopNodeId)!==Number(m?.loopNodeId))&&!(m?.type===i.C8.Loop&&Number(T.loopNodeId)===Number(m.id))){var H=Mt(T,o),q;if(T.type===i.C8.Loop?q=H.map(function(Ce){var X=Ce.name==="INDEX"||Ce.name&&Ce.name.endsWith("_item")?"".concat(T.id,"-input"):T.id;return xn(X,[Ce])[0]}):q=xn(T.id,H),!(!q||q.length===0)){var de=Number(T.id);if(h.push({id:de,name:T.name,type:T.type,icon:T.icon,outputArgs:q}),T.type===i.C8.Loop){var ce=q.filter(function(Ce){return Ce.key.includes("-input")}),ge=q.filter(function(Ce){return!Ce.key.includes("-input")});ce.length>0&&Object.assign(f,vn("".concat(T.id,"-input"),ce)),ge.length>0&&Object.assign(f,vn(de,ge))}else Object.assign(f,vn(de,q))}}}),!m)return{previousNodes:h,innerPreviousNodes:[],argMap:f};var S=[];if(m.loopNodeId){var b=Number(m.loopNodeId),k=l.get(b);if(k){var g,C,d=Wt(b,s).filter(function(F){return F!==b&&!v.has(F)});d.forEach(function(F){var T=l.get(F);if(T&&!(T.type===i.C8.LoopStart||T.type===i.C8.LoopEnd||T.loopNodeId===b)&&!h.some(function(de){return de.id===F})){var H=Mt(T,o),q=xn(T.id,H);q.length!==0&&(h.push({id:T.id,name:T.name,type:T.type,icon:T.icon,outputArgs:q}),Object.assign(f,vn(T.id,q)))}});var y=[],I=[],w=x()({},f);(g=k.nodeConfig.inputArgs)===null||g===void 0||g.forEach(function(F){if(F.bindValueType==="Reference"){var T=w[F.bindValue||""];if(T&&typeof T.dataType=="string"&&T.dataType.startsWith("Array_")){var H=T.dataType.replace("Array_","")||"Object",q=i.Gi[H]||i.Gi.Object,de=x()(x()({},Qn(F)),{},{name:"".concat(F.name,"_item"),dataType:q,subArgs:T.subArgs?JSON.parse(JSON.stringify(T.subArgs)):T.subArgs});y.push(de)}}}),y.push({name:Yr,dataType:i.Gi.Integer,description:"\u6570\u7EC4\u7D22\u5F15",require:!1,systemVariable:!0,bindValueType:void 0,bindValue:"",key:Yr,subArgs:[]}),(C=k.nodeConfig.variableArgs)===null||C===void 0||C.forEach(function(F){var T=Qn(F);if(F.bindValueType==="Reference"){var H=w[F.bindValue||""];H&&(T.subArgs=H.subArgs?JSON.parse(JSON.stringify(H.subArgs)):H.subArgs)}I.push(T)});var A=xn("".concat(k.id,"-input"),y),D=xn("".concat(k.id,"-var"),I),E=[].concat(Ee()(A),Ee()(D));if(E.length>0){var R=h.findIndex(function(F){return Number(F.id)===b});if(R>-1){var P=h[R].outputArgs;E.forEach(function(F){P.some(function(T){return T.key===F.key})||P.push(F)})}else h.push({id:b,name:k.name,type:k.type,icon:k.icon,outputArgs:E});Object.assign(f,vn("".concat(k.id,"-input"),y)),Object.assign(f,vn("".concat(k.id,"-var"),I))}}}if(m.type===i.C8.Loop){var G;if(m.innerNodes){var B=new Map;m.innerNodes.forEach(function(F){return B.set(F.id,F)});var Y=_r(m.innerNodes),le=m.innerEndNodeId;if(le){var re=Wt(le,Y),Q=Number(m.id),O=re.map(function(F){return B.get(F)}).filter(function(F){return F!==void 0&&Number(F.loopNodeId)===Q&&F.type!==i.C8.LoopStart&&F.type!==i.C8.LoopEnd});O.forEach(function(F){var T=Mt(F,o);if(T.length!==0){var H=T.map(function(de){var ce=Qn(de);if(ce.originDataType=ce.dataType,!ce.dataType||typeof ce.dataType=="string"&&!ce.dataType.startsWith("Array_")){var ge=typeof ce.dataType=="string"&&ce.dataType?ce.dataType:"Object";ce.dataType="Array_".concat(ge)}else ce.dataType=i.Gi.Array_Object;return ce}),q=xn(F.id,H);S.push({id:F.id,name:F.name,type:F.type,icon:F.icon,outputArgs:q,loopNodeId:F.loopNodeId}),Object.assign(f,vn(F.id,H))}})}}var U=[],Z=x()({},f);if((G=m.nodeConfig.variableArgs)===null||G===void 0||G.forEach(function(F){var T=Qn(F);if(F.bindValueType==="Reference"){var H=Z[F.bindValue||""];H&&(T.subArgs=H.subArgs?JSON.parse(JSON.stringify(H.subArgs)):H.subArgs)}U.push(T)}),U.length>0){var ae=xn("".concat(m.id,"-var"),U);S.push({id:Number(m.id),name:m.name,type:m.type,icon:m.icon,outputArgs:ae}),Object.assign(f,vn("".concat(m.id,"-var"),U))}}var V=new Map,ne=e.find(function(F){return F.type===i.C8.Start});if(ne){var K=new Set,z=0,W=function F(T){if(!K.has(T)){K.add(T),V.set(T,z++);var H=u.get(T)||[];H.forEach(F)}};W(Number(ne.id))}var M=function(T,H){var q,de,ce=(q=V.get(T.id))!==null&&q!==void 0?q:Number.MAX_SAFE_INTEGER,ge=(de=V.get(H.id))!==null&&de!==void 0?de:Number.MAX_SAFE_INTEGER;return ce===ge?H.id-T.id:ge-ce};return h.sort(M),S.sort(M),{previousNodes:h,innerPreviousNodes:S,argMap:f}}function ea(p){if(!p||typeof p!="string")return null;var t=p.split(".");if(t.length<2)return null;var e=parseInt(t[0],10);return isNaN(e)?null:{nodeId:e,path:t.slice(1),fullPath:t.slice(1).join(".")}}function Xs(p,t){if(!p)return!0;var e=ea(p);return e?p in t:!1}function Qs(p,t){return!p||!t[p]?null:t[p]}function Ks(p,t){var e=[],r=p.toString(),a=t.nodeConfig.inputArgs||[];a.forEach(function(l,s){var u;(u=l.bindValue)!==null&&u!==void 0&&u.startsWith(r+".")&&e.push({field:"inputArgs[".concat(s,"].").concat(l.name),bindValue:l.bindValue})});var o=["systemPrompt","userPrompt","question","url","text","content"];return o.forEach(function(l){var s=t.nodeConfig[l];typeof s=="string"&&s.includes("{{".concat(r,"."))&&e.push({field:l,bindValue:s})}),e}function Js(p,t){var e=Ht(p,t),r=e.previousNodes;return r.map(function(a){return{nodeId:a.id,nodeName:a.name,nodeType:a.type,variables:a.outputArgs.map(function(o){return{key:"".concat(a.id,".").concat(o.name),name:o.name,dataType:o.dataType||"String",path:o.name,description:o.description}})}})}var Hl={calculateNodePreviousArgs:Ht,parseVariableReference:ea,isValidReference:Xs,getReferencedArg:Qs,findReferencesToNode:Ks,getAvailableVariables:Js},Ys=Tn.Ne.filter(function(p){return[Se.qR.Plugin,Se.qR.Workflow,Se.qR.Table,Se.qR.MCP].includes(p.key)}),qs=function(t){var e=x()({},t),r=Ee()(e.variableGroups||[]),a=/^variableGroups,(\d+),inputs$/,o=[];Object.keys(e).forEach(function(s){var u=s.match(a);if(u){var c=parseInt(u[1],10);console.log("[VariableAggregation] \u627E\u5230\u6241\u5E73\u5316\u952E: ".concat(s,", groupIndex: ").concat(c)),console.log("[VariableAggregation] \u6241\u5E73\u5316\u6570\u636E:",JSON.stringify(e[s],null,2)),r[c]&&(r[c]=x()(x()({},r[c]),{},{inputs:e[s]}),console.log("[VariableAggregation] \u5408\u5E76\u540E\u7684\u5206\u7EC4:",JSON.stringify(r[c],null,2))),o.push(s)}}),console.log("[VariableAggregation] \u9700\u8981\u5220\u9664\u7684\u6241\u5E73\u5316\u952E: ".concat(o.join(", "))),o.forEach(function(s){delete e[s]}),e.variableGroups=r;var l=r.map(function(s){var u={key:s.id||s.name,name:s.name||"",dataType:s.dataType||"String",description:"".concat(s.name||"Group"," ").concat(s.dataType||"String"),require:!1,systemVariable:!1,bindValue:"",bindValueType:""};return Array.isArray(s.inputs)&&s.inputs.length>0&&(u.subArgs=s.inputs.map(function(c){var v,N;return{key:c.key||c.name,name:c.name||"",dataType:c.dataType||"String",description:c.description||"",require:(v=c.require)!==null&&v!==void 0?v:!1,systemVariable:(N=c.systemVariable)!==null&&N!==void 0?N:!1,bindValue:c.bindValue||"",bindValueType:c.bindValueType||"Reference"}})),u});return e.inputArgs=l,console.log("[VariableAggregation] \u6E05\u7406\u540E\u7684\u8868\u5355\u503C:",JSON.stringify(e,null,2)),console.log("[VariableAggregation] \u751F\u6210\u7684 inputArgs:",JSON.stringify(l,null,2)),e},_s=function(){var t=(0,Re.useModel)("workflowV3"),e=t.getWorkflow,r=t.storeWorkflow,a=t.clearWorkflow,o=t.visible,l=t.setVisible,s=t.handleInitLoading,u=t.globalLoadingTime,c=(0,Re.useParams)(),v=Number(c.workflowId),N=Number(c.spaceId),h=(0,j.useState)(Na),f=me()(h,2),m=f[0],S=f[1],b=Zs({workflowId:v,handleInitLoading:s}),k=b.info,g=b.setInfo,C=b.graphParams,d=b.setGraphParams,y=b.onConfirm,I=b.refreshGraphData,w=I,A=(0,j.useCallback)(function(){var ie=new Date;g(function(_){return _?x()(x()({},_),{},{modified:ie.toString()}):null})},[g]),D=(0,j.useCallback)(function(ie){g(function(_){return _?x()(x()({},_),{},{extension:{size:ie}}):null})},[g]),E=(0,j.useState)(!1),R=me()(E,2),P=R[0],G=R[1],B=(0,j.useState)(!1),Y=me()(B,2),le=Y[0],re=Y[1],Q=(0,j.useState)(Se.qR.Plugin),O=me()(Q,2),U=O[0],Z=O[1],ae=(0,j.useState)({x:0,y:0}),V=me()(ae,2),ne=V[0],K=V[1],z=(0,j.useRef)(null),W=J.Z.useForm(),M=me()(W,1),F=M[0],T=(0,j.useState)(!1),H=me()(T,2),q=H[0],de=H[1],ce=(0,j.useState)({errorList:[],show:!1}),ge=me()(ce,2),Ce=ge[0],X=ge[1],fe=(0,j.useRef)(null),Ne=(0,j.useRef)(null),De=(0,j.useRef)(0),Ze=(0,j.useRef)(),Me=(0,j.useRef)(!1),un=(0,j.useRef)(null),we=(0,j.useRef)(null),tn=(0,j.useRef)(null),Nn=(0,j.useRef)(null);Nn.current=w;var Ut=(0,j.useState)(!1),ht=me()(Ut,2),rn=ht[0],Kn=ht[1],na=(0,Re.useModel)("model"),mt=na.setTestRun,Jn=(0,Re.useModel)("workflowV3"),$t=Jn.setReferenceList,dn=Jn.setIsModified,zt=Jn.skillChange,Bn=Jn.setSkillChange,Xt=Jn.isModified;(0,ga.Z)(rn),(0,va.Z)();var nl=(0,j.useCallback)(function(ie,_){var $=(0,Nt.ed)(ie,_,z.current);z.current=$},[z]),tl=(0,j.useCallback)(function(ie){if(ie===-1){var _;(_=fe.current)===null||_===void 0||_.graphChangeZoomToFit()}else{var $;($=fe.current)===null||$===void 0||$.graphChangeZoom(ie)}},[fe]);(0,j.useEffect)(function(){if(r("drawerForm",m),m&&m.nodeConfig){var ie=F.getFieldValue(Ue);F.setFieldsValue(m.nodeConfig),Array.isArray(ie)&&ie.length>0&&F.setFieldValue(Ue,ie)}zt&&Bn(!1)},[m]);var Ct=function(){var ie=xe()(ee()().mark(function _($){var te,ve,ue,he,Te,ye,Ie,Oe;return ee()().wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:if(console.log("[getReference] \u8C03\u7528, id:",$,"preventGetReference:",De.current),!($===se.zQ.empty||De.current===$)){Pe.next=3;break}return Pe.abrupt("return",!1);case 3:if(Pe.prev=3,ue=[],he=[],Te=(te=fe.current)===null||te===void 0||(ve=te.getGraphRef)===null||ve===void 0?void 0:ve.call(te),Te?(ue=Te.getNodes().map(function(_e){var An,Dn=_e.getData(),sa=_e.getPosition(),la=_e.getSize();return x()(x()({},Dn),{},{nodeConfig:x()(x()({},Dn.nodeConfig),{},{extension:x()(x()({},(An=Dn.nodeConfig)===null||An===void 0?void 0:An.extension),{},{x:sa.x,y:sa.y,width:la.width,height:la.height})})})}),he=Te.getEdges().map(function(_e){var An,Dn;return{id:_e.id,source:_e.getSourceCellId(),target:_e.getTargetCellId(),sourcePort:(An=_e.getSource())===null||An===void 0?void 0:An.port,targetPort:(Dn=_e.getTarget())===null||Dn===void 0?void 0:Dn.port}})):(ye=Ae.getFullWorkflowData(),ue=ye?.nodes||C.nodeList,he=ye?.edges||C.edgeList),!(!ue||ue.length===0)){Pe.next=11;break}return $t({previousNodes:[],innerPreviousNodes:[],argMap:{}}),Pe.abrupt("return",!1);case 11:return Ie={workflowId:v,nodes:ue,edges:he,systemVariables:Ae.getSystemVariables()},Oe=Ht($,Ie),Oe&&Oe.previousNodes&&Oe.previousNodes.length?$t({previousNodes:Oe.previousNodes,innerPreviousNodes:Oe.innerPreviousNodes,argMap:Oe.argMap}):$t({previousNodes:[],innerPreviousNodes:[],argMap:{}}),Pe.abrupt("return",!0);case 17:return Pe.prev=17,Pe.t0=Pe.catch(3),console.error("[V3] \u524D\u7AEF\u8BA1\u7B97\u53D8\u91CF\u5F15\u7528\u5931\u8D25:",Pe.t0),Pe.abrupt("return",!1);case 21:case"end":return Pe.stop()}},_,null,[[3,17]])}));return function($){return ie.apply(this,arguments)}}(),ta=function(){var ie=xe()(ee()().mark(function _($){var te,ve,ue,he;return ee()().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if($!==se.zQ.empty){ye.next=2;break}return ye.abrupt("return");case 2:if(te=Ae.getNodeById($),!te){ye.next=7;break}S((0,ke.Xh)(te)),ye.next=17;break;case 7:return ye.prev=7,ye.next=10,an.ZP.getNodeConfig($);case 10:ve=ye.sent,ve.code===cn.ZP.success&&(he=ve.data,Ae.updateNode(he),(ue=fe.current)===null||ue===void 0||ue.graphUpdateNode(String(he.id),he),S(he),A()),ye.next=17;break;case 14:ye.prev=14,ye.t0=ye.catch(7),console.error("\u83B7\u53D6\u8282\u70B9\u8BE6\u60C5\u5931\u8D25",ye.t0);case 17:case"end":return ye.stop()}},_,null,[[7,14]])}));return function($){return ie.apply(this,arguments)}}(),Qt=Os({graphRef:fe,graphInstanceRef:Ne,changeUpdateTime:A,getReference:Ct,setFoldWrapItem:S}),jn=Qt.saveFullWorkflow,Kt=Qt.debouncedSaveFullWorkflow,rl=Qt.autoSaveNodeConfig,al=(0,j.useCallback)(function(){var ie=xe()(ee()().mark(function _($){var te,ve,ue,he,Te;return ee()().wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return Ie.prev=0,g(function(Oe){var _n,Pe,_e;return Oe?x()(x()({},Oe),{},{name:(_n=$.name)!==null&&_n!==void 0?_n:Oe.name,description:(Pe=$.description)!==null&&Pe!==void 0?Pe:Oe.description,icon:(_e=$.icon)!==null&&_e!==void 0?_e:Oe.icon,modified:new Date().toString()}):null}),te=Ae.getWorkflowInfo(),te&&Ae.setWorkflowInfo(x()(x()({},te),{},{name:(ve=$.name)!==null&&ve!==void 0?ve:te.name,description:(ue=$.description)!==null&&ue!==void 0?ue:te.description,icon:(he=$.icon)!==null&&he!==void 0?he:te.icon})),kn.updateMeta({name:$.name,description:$.description,icon:$.icon}),Ie.next=7,jn();case 7:return Te=Ie.sent,Ie.abrupt("return",Te);case 11:return Ie.prev=11,Ie.t0=Ie.catch(0),console.error("\u66F4\u65B0\u5DE5\u4F5C\u6D41\u57FA\u7840\u4FE1\u606F\u5931\u8D25:",Ie.t0),Ie.abrupt("return",!1);case 15:case"end":return Ie.stop()}},_,null,[[0,11]])}));return function(_){return ie.apply(this,arguments)}}(),[g,jn]),ra=Rs({graphRef:fe,debouncedSaveFullWorkflow:Kt,changeUpdateTime:A,getReference:function(_){return Ct(_)},setFoldWrapItem:S,getNodeConfig:function(_){return ta(_)},updateCurrentNodeRef:nl}),aa=ra.nodeChangeEdge,Yn=ra.changeNode,In=Ps({workflowId:v,graphRef:fe,currentNodeRef:z,foldWrapItem:m,setFoldWrapItem:S,setVisible:l,setOpen:G,setCreatedItem:Z,setDragEvent:K,dragEvent:ne,preventGetReference:De,timerRef:Ze,changeUpdateTime:A,debouncedSaveFullWorkflow:Kt,changeDrawer:function(_){var $;return($=un.current)===null||$===void 0?void 0:$.call(un,_)},getNodeConfig:function(_){return ta(_)},getReference:function(_){return Ct(_)},getWorkflow:e,changeNode:Yn,nodeChangeEdge:function(){var ie=xe()(ee()().mark(function $(te,ve){var ue;return ee()().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return Te.next=2,aa(te,ve);case 2:return ue=Te.sent,Te.abrupt("return",ue===!1?null:ue);case 4:case"end":return Te.stop()}},$)}));function _($,te){return ie.apply(this,arguments)}return _}()}),qe=Vs({workflowId:v,spaceId:N,graphRef:fe,info:k,foldWrapItem:m,validWorkflow:function(){var ie=xe()(ee()().mark(function $(){var te;return ee()().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(te=we.current,!te){ue.next=7;break}return ue.next=4,te();case 4:ue.t0=ue.sent,ue.next=8;break;case 7:ue.t0=!1;case 8:return ue.abrupt("return",ue.t0);case 9:case"end":return ue.stop()}},$)}));function _(){return ie.apply(this,arguments)}return _}(),onSaveWorkflow:function(){var ie=xe()(ee()().mark(function $(){return ee()().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return ve.next=2,jn();case 2:case"end":return ve.stop()}},$)}));function _(){return ie.apply(this,arguments)}return _}(),getWorkflow:e,isModified:Xt,setIsModified:dn,changeUpdateTime:A,errorParams:Ce,setErrorParams:X}),Fn=Gs({workflowId:v,info:k,graphRef:fe,getWorkflow:e,setGraphParams:d,changeDrawer:function(_){var $;return($=un.current)===null||$===void 0?void 0:$.call(un,_)},setInfo:g,setErrorParams:X,errorParams:Ce,doSubmitFormData:function(){var ie=xe()(ee()().mark(function $(){var te;return ee()().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(te=tn.current,!te){ue.next=4;break}return ue.next=4,te();case 4:case"end":return ue.stop()}},$)}));function _(){return ie.apply(this,arguments)}return _}(),saveFullWorkflow:jn,getDetails:function(){var ie=xe()(ee()().mark(function $(){var te;return ee()().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(te=Nn.current,!te){ue.next=4;break}return ue.next=4,te();case 4:case"end":return ue.stop()}},$)}));function _(){return ie.apply(this,arguments)}return _}()}),qn=(0,j.useCallback)(function(){var ie=xe()(ee()().mark(function _($){var te,ve,ue,he;return ee()().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return te=!1,ye.prev=1,ve=F.getFieldsValue(!0),console.log("[onSaveWorkflow] \u8282\u70B9\u7C7B\u578B:",$.type),console.log("[onSaveWorkflow] \u539F\u59CB\u8868\u5355\u503C keys:",Object.keys(ve)),$.type===i.C8.VariableAggregation&&(console.log("[onSaveWorkflow] \u5F00\u59CB\u6E05\u7406 VariableAggregation \u6570\u636E..."),ve=qs(ve),console.log("[onSaveWorkflow] \u6E05\u7406\u540E\u8868\u5355\u503C keys:",Object.keys(ve))),([i.C8.IntentRecognition,i.C8.Condition].includes($.type)||$.type===i.C8.QA&&ve.answerType===i.J4.SELECT)&&$.id===e("drawerForm").id?(he=(0,Nt.$N)($.type,ve,$.nodeConfig),ue=x()(x()({},$),{},{nodeConfig:x()(x()({},$.nodeConfig),he)})):(ue=x()(x()({},$),{},{nodeConfig:x()(x()({},$.nodeConfig),ve)}),$.type===i.C8.QA&&(ue.nextNodeIds=[])),ye.next=9,rl(ue);case 9:te=ye.sent,ye.next=16;break;case 12:ye.prev=12,ye.t0=ye.catch(1),console.error("\u8868\u5355\u63D0\u4EA4\u5931\u8D25:",ye.t0),te=!1;case 16:return ye.abrupt("return",te);case 17:case"end":return ye.stop()}},_,null,[[1,12]])}));return function(_){return ie.apply(this,arguments)}}(),[F]),oa=(0,j.useCallback)(xe()(ee()().mark(function ie(){var _,$,te,ve,ue,he,Te;return ee()().wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(_=!1,$=zt,e("isModified")!==!1){Ie.next=5;break}return $&&Bn(!1),Ie.abrupt("return",_);case 5:return Ie.prev=5,dn(!1),Ie.next=9,qn(e("drawerForm"));case 9:if(_=Ie.sent,!$){Ie.next=17;break}return Ie.next=13,an.ZP.getNodeConfig(e("drawerForm").id);case 13:te=Ie.sent,ve=te.code===cn.ZP.success,ue=te.data,ve&&ue&&ue.nodeConfig[Ue]?(Te=(0,Nt.gc)(F.getFieldsValue(!0)[Ue]||[],ue.nodeConfig[Ue]),F.setFieldValue(Ue,Te),Bn(!1),S(te.data),(he=fe.current)===null||he===void 0||he.graphUpdateNode(String(ue.id),ue)):Bn(!1);case 17:Ie.next=23;break;case 19:Ie.prev=19,Ie.t0=Ie.catch(5),console.error("Failed to fetch node config:",Ie.t0),Bn(!1);case 23:return Ie.abrupt("return",_);case 24:case"end":return Ie.stop()}},ie,null,[[5,19]])})),[dn,F,Bn,zt]);tn.current=oa;var Jt=(0,j.useCallback)(function(){var ie=xe()(ee()().mark(function _($){var te,ve,ue,he,Te,ye;return ee()().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:te=e("isModified"),ve=e("drawerForm"),console.log("[changeDrawer] \u8282\u70B9\u5207\u6362, isModified:",te,"currentNode:",ve?.id,"->",$?.id),Me.current=!0,setTimeout(function(){Me.current=!1},600),te===!0&&ve?.id!==0?(console.log("[changeDrawer] \u68C0\u6D4B\u5230\u4FEE\u6539\uFF0C\u89E6\u53D1\u4FDD\u5B58"),dn(!1),qn(ve),Ze.current&&clearTimeout(Ze.current)):$&&$.id!==0&&Ct($.id),$&&$.type!==i.C8.Start&&(mt(!1),qe.setTestRunResult("")),ue=e("visible"),he=ue,ye=e("drawerForm"),ye?.id===se.zQ.empty&&$===null?(he=!1,Te=ye):$!==null?(ue||(he=!0),Te=$):(he=!1,Te={id:se.zQ.empty,shape:i.K$.General,description:"",workflowId:v,type:i.C8.Start,nodeConfig:{},name:"",icon:""}),mt(!1),he!==ue&&l(he),S(Te);case 14:case"end":return Oe.stop()}},_)}));return function(_){return ie.apply(this,arguments)}}(),[]);un.current=Jt;var ol=(0,j.useCallback)(xe()(ee()().mark(function ie(){return ee()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,Fn.validWorkflow();case 2:return $.abrupt("return",$.sent);case 3:case"end":return $.stop()}},ie)})),[Fn]);we.current=ol;var il=(0,j.useCallback)(function(){var ie=xe()(ee()().mark(function _($){var te,ve;return ee()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:he.t0=$,he.next=he.t0==="Rename"?3:he.t0==="Delete"?5:he.t0==="Duplicate"?8:he.t0==="TestRun"?11:23;break;case 3:return de(!0),he.abrupt("break",24);case 5:return te=e("drawerForm"),In.deleteNode(te.id),he.abrupt("break",24);case 8:return ve=e("drawerForm"),In.copyNode(ve),he.abrupt("break",24);case 11:if(!Xt){he.next=15;break}return dn(!1),he.next=15,qn(e("drawerForm"));case 15:if(e("drawerForm").type!==i.C8.Start){he.next=20;break}return he.next=18,qe.testRunAll();case 18:he.next=22;break;case 20:qe.setTestRunResult(""),mt(!0);case 22:return he.abrupt("break",24);case 23:return he.abrupt("break",24);case 24:case"end":return he.stop()}},_)}));return function(_){return ie.apply(this,arguments)}}(),[Xt,In,qe]),sl=(0,j.useCallback)(function(){var ie;(ie=fe.current)===null||ie===void 0||ie.graphTriggerBlankClick()},[]),ll=(0,j.useCallback)(function(){Jt(null),l(!1)},[]),ul=function(_){var $=_.name,te=_.description,ve=x()(x()({},m),{},{name:$,description:te});Yn({nodeData:ve}),de(!1)},dl=(0,j.useCallback)(function(ie,_){var $,te=x()(x()({},ie),_);Yn({nodeData:te});var ve=($=fe.current)===null||$===void 0?void 0:$.getGraphRef();if(ve){var ue=ve.getCellById(ie.id.toString());ue&&(ue.updateData({name:te.name}),S(function(he){return x()(x()({},he),{},{name:te.name})}))}else console.error("graph is null")},[Yn,S]),cl=function(_){e("visible")&&_&&_.id===e("drawerForm").id||Jt(_)},fl=function(_){var $,te=($=fe.current)===null||$===void 0?void 0:$.getGraphRef(),ve=te?.getCellById(_.toString());if(ve){var ue;(ue=fe.current)===null||ue===void 0||ue.graphSelectNode(_.toString())}},pl=function(_){if(!(o&&_&&_.id===e("drawerForm").id)&&_){var $,te=($=fe.current)===null||$===void 0?void 0:$.getGraphRef(),ve=te?.getCellById(_.id.toString());ve&&te?.centerCell(ve),fl(_.id)}},vl=function(){var ie=xe()(ee()().mark(function _($){var te,ve,ue,he,Te,ye,Ie,Oe;return ee()().wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:return ve=$.child,ue=$.sourceNode,he=$.portId,Te=$.position,ye=$.targetNode,Ie=$.edgeId,z.current={sourceNode:ue,portId:he,targetNode:ye,edgeId:Ie},Oe=Qa({position:Te,portId:he,type:ve.type,hasTargetNode:!!ye,sourceNodeId:ue.id.toString(),graph:(te=fe.current)===null||te===void 0?void 0:te.getGraphRef()}),Pe.next=5,In.dragChild(ve,Oe);case 5:case"end":return Pe.stop()}},_)}));return function($){return ie.apply(this,arguments)}}();Ts({getGraph:function(){var _,$;return((_=fe.current)===null||_===void 0||($=_.getGraphRef)===null||$===void 0?void 0:$.call(_))||Ne.current},onSave:jn}),(0,j.useEffect)(function(){return function(){Ae.hasPendingChanges()&&jn(),dn(function(ie){return ie===!0&&qn(e("drawerForm")),!1}),l(!1),mt(!1),a()}},[]),(0,j.useEffect)(function(){if(m.id!==0){var ie=(0,ke.Xh)(m);F.resetFields(),F.setFieldsValue(ie.nodeConfig),io({type:ie.type,nodeConfig:ie.nodeConfig,form:F})}},[m.id,m.type]),Ss({run:(0,j.useCallback)(xe()(ee()().mark(function ie(){var _;return ee()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return _=e("drawerForm"),te.next=3,qn(_);case 3:return te.abrupt("return",te.sent);case 4:case"end":return te.stop()}},ie)})),[]),doNext:(0,j.useCallback)(function(){dn(!1)},[dn])});var gl=function(){var ie=xe()(ee()().mark(function _(){return ee()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return d({nodeList:[],edgeList:[]}),te.next=3,w();case 3:case"end":return te.stop()}},_)}));return function(){return ie.apply(this,arguments)}}(),hl=(0,j.useCallback)(function(ie,_){var $=e("drawerForm").id;!fe.current||!$||$===se.zQ.empty||fe.current.graphUpdateByFormData(ie,_,$.toString())},[fe.current]),ml=(0,_t.z)(function(ie,_){console.log("[throttledHandleGraphUpdate] \u89E6\u53D1, changedValues:",Object.keys(ie),"isNodeSwitching:",Me.current),dn(!1),hl(ie,_),Me.current||dn(!0)},500,{leading:!0,trailing:!0}),Yt=Bs({graphRef:fe,graphInstanceRef:Ne,debouncedSaveFullWorkflow:Kt}),ia=Yt.historyState,Cl=Yt.handleUndo,yl=Yt.handleRedo;return(0,n.jsx)(Ws.B,{version:"v3",children:(0,n.jsx)(ws,{isValidLoading:Fn.isValidLoading,info:k,setShowCreateWorkflow:re,setShowVersionHistory:Kn,handleShowPublish:Fn.handleShowPublish,showPublish:Fn.showPublish,setShowPublish:Fn.setShowPublish,canUndo:ia.canUndo,canRedo:ia.canRedo,onUndo:Cl,onRedo:yl,onManualSave:jn,onConfirm:y,onUpdateWorkflow:al,handleConfirmPublishWorkflow:Fn.handleConfirmPublishWorkflow,globalLoadingTime:u,graphParams:C,graphRef:fe,handleNodeClick:cl,nodeChangeEdge:aa,changeNode:Yn,deleteNode:In.deleteNode,copyNode:In.copyNode,changeZoom:D,createNodeByPortOrEdge:vl,handleSaveNode:dl,handleClickBlank:ll,handleInitLoading:s,handleRefreshGraph:gl,dragChild:In.dragChild,foldWrapItem:m,changeGraph:tl,testRunAll:qe.testRunAll,testRunLoading:qe.testRunLoading,visible:o,handleDrawerClose:sl,showNameInput:q,changeFoldWrap:ul,handleOperationsChange:il,form:F,doSubmitFormData:oa,throttledHandleGraphUpdate:ml,createdItem:U,onAdded:In.onAdded,open:P,setOpen:G,workflowCreatedTabs:Ys,workflowId:v,runTest:qe.runTest,testRunResult:qe.testRunResult,handleClearRunResult:qe.handleClearRunResult,loading:qe.loading,stopWait:qe.stopWait,formItemValue:qe.formItemValue,testRunParams:qe.testRunParams,errorParams:Ce,setErrorParams:X,handleErrorNodeClick:pl,spaceId:N,showCreateWorkflow:le,showVersionHistory:rn})})},el=_s}}]);})();
