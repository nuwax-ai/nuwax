(()=>{(function(){"use strict";const p=console.error,D=console.warn,S={version:"1.0.5",enabled:!0,logLevel:"error",maxErrors:10,maxLogs:20,mutationObserverEnabled:!0},u={errors:[],basicInfo:{url:window.location.href,userAgent:navigator.userAgent.split(" ")[0]},historyChanges:[],ready:!1,detectedErrorElements:new Set,recentErrors:new Map};function E(){try{let o=function(){try{let c="";if(!e||!e.body)e&&e.documentElement?c=e.documentElement.outerHTML||"":e?c=e.documentElement?String(e.documentElement):String(e):c="[Document not available]";else{const s=e.body.innerHTML||"",i=Array.from(e.head.querySelectorAll("script")).map(l=>l.outerHTML).join(`
`),a=Array.from(e.head.querySelectorAll("style")).map(l=>l.outerHTML).join(`
`);c=["<!-- Head Scripts -->",i,"<!-- Head Styles -->",a,"<!-- Body -->",s].filter(l=>l).join(`
`)}const r=5e3;return c.length>r&&(c=c.substring(0,r)+`
... [truncated, total length: `+c.length+"]"),c}catch(c){return"[Failed to get document string: "+String(c)+"]"}};const e=document;if(!e||!e.body)return{isWhiteScreen:!0,documentString:o()};if(!(e.body.innerText.trim().length>0||e.body.children.length>0))return{isWhiteScreen:!0,documentString:o()};const n=e.querySelector("#root, #app");return n?n.children.length===0?{isWhiteScreen:!0,documentString:o()}:{isWhiteScreen:!1}:{isWhiteScreen:!0,documentString:o()}}catch(e){return{isWhiteScreen:!1,documentString:"[White screen check failed: "+String(e)+"]"}}}function j(e,o){const t=typeof e=="string"?e:String(e),n=o?JSON.stringify(o):"";return!!(t.includes("Canceled")&&(t.includes("Monaco")||t.includes("WordHighlighter")||n.includes("Canceled"))||t.includes("[DevMonitor]")||t.includes("[Dev-Monitor")||t.includes("DevMonitor")||t.includes("Failed to fetch")||t.includes("\u8BF7\u6C42\u7684\u6570\u636E\u6E90\u4E0D\u5B58\u5728"))}function b(e,o=5e3){const t=typeof e=="string"?e:String(e),n=Date.now(),c=t.substring(0,100),r=u.recentErrors.get(c);if(r&&n-r<o)return!0;if(u.recentErrors.set(c,n),u.recentErrors.size>50){const s=Array.from(u.recentErrors.entries());s.sort((i,a)=>a[1]-i[1]),u.recentErrors.clear(),s.slice(0,50).forEach(([i,a])=>{u.recentErrors.set(i,a)})}return!1}let f=null,w=null;const T=5e3;function C(e){if(window.self!==window.top&&window.parent)try{const{documentString:t,isWhiteScreen:n}=E(),c={type:"dev-monitor-error",error:e,errorCount:u.errors.length,url:u.basicInfo.url,timestamp:Date.now(),isWhiteScreen:n,...t&&{documentString:t}};window.parent.postMessage(c,"*"),p.call(console,`[DevMonitor] \u2713 \u9519\u8BEF\u5DF2\u53D1\u9001 | ${e.message.substring(0,80)}`)}catch(t){p.call(console,`[DevMonitor] \u2717 \u53D1\u9001\u5931\u8D25 | ${t.message}`)}}const g={error:(e,o=null)=>{if(j(e,o))return;const t={message:typeof e=="string"?e:e.toString(),details:o?JSON.stringify(o).substring(0,500):null,timestamp:Date.now()};u.errors.push(t),u.errors.length>S.maxErrors&&u.errors.shift();const n=f!==null;f&&clearTimeout(f),w=t,p.call(console,`[DevMonitor] ${n?"\u27F3":"\u25CF"} \u63A5\u6536\u9519\u8BEF\uFF0C${T/1e3}s\u540E\u53D1\u9001 | ${t.message.substring(0,80)}`),f=setTimeout(()=>{w&&(C(w),w=null),f=null},T)}};function x(e){let o="",t=null,n=null;for(let c=0;c<e.length;c++){const r=e[c];if(r instanceof Error)o=r.message||o,t=r.stack||null,n={name:r.name,message:r.message,stack:r.stack?r.stack.substring(0,500):null};else if(typeof r=="string")o?o+=" "+r:o=r;else if(typeof r=="object"&&r!==null)try{JSON.stringify(r).length<200&&(n=n||{},Object.assign(n,r))}catch{}}return{message:o||e.map(c=>String(c)).join(" "),stack:t,details:n}}function v(){const e=p,o=D;console.error=function(...t){try{const n=t.map(s=>{if(s instanceof Error)return s.name+": "+s.message+" "+(s.stack||"");if(typeof s=="object"&&s!==null)try{return JSON.stringify(s)}catch{return String(s)}return String(s)}).join(" "),c=n.includes("Error handled by React Router")||n.includes("Error handled by")||n.includes("ErrorBoundary")||n.includes("React Router")||n.includes("react-router")||n.includes("default ErrorBoundary"),r=n.includes("Uncaught")||n.includes("Unhandled")||n.includes("TypeError")||n.includes("ReferenceError")||n.includes("SyntaxError")||n.includes("RangeError")||n.includes("URIError")||n.includes("EvalError");if(c||r){const s=x(t),i=s.message||n;if(b(i,5e3))return;g.error(i,{source:"console.error",isReactRouterError:c,isImportantError:r,stack:s.stack,originalArgs:t.map(a=>a instanceof Error?{type:"Error",name:a.name,message:a.message,stack:a.stack?a.stack.substring(0,500):null}:typeof a=="object"&&a!==null?"[Object]":String(a)),...s.details})}}catch{}e.apply(console,t)},console.warn=function(...t){try{const n=t.map(r=>{if(r instanceof Error)return r.name+": "+r.message+" "+(r.stack||"");if(typeof r=="object"&&r!==null)try{return JSON.stringify(r)}catch{return String(r)}return String(r)}).join(" "),c=n.includes("Error handled by React Router")||n.includes("Error handled by")||n.includes("ErrorBoundary")||n.includes("default ErrorBoundary")||n.includes("Warning:")||n.includes("Failed to")||n.includes("ReferenceError")||n.includes("TypeError");if(c){const r=x(t),s=r.message||n;if(b(s,5e3))return;g.error(s,{source:"console.warn",isImportantWarning:c,stack:r.stack,originalArgs:t.map(i=>i instanceof Error?{type:"Error",name:i.name,message:i.message,stack:i.stack?i.stack.substring(0,500):null}:typeof i=="object"&&i!==null?"[Object]":String(i)),...r.details})}}catch{}o.apply(console,t)}}function P(e){if(!e||e.nodeType!==1)return!1;try{const o=e,t=o.tagName?.toLowerCase()||"",n=o.className||"",c=o.id||"",r=o.textContent||"",s=o.innerHTML||"";return["error","ErrorBoundary","error-boundary","react-error-boundary","error-page","error-page-container","Something went wrong","\u51FA\u9519\u4E86","\u9519\u8BEF"].some(l=>n.includes(l)||c.includes(l)||r.includes(l)||s.includes(l))||r.includes("Error handled by React Router")||r.includes("Something went wrong")||t==="div"&&(n.includes("error")||c.includes("error"))}catch{return!1}}function H(){window.addEventListener("error",function(e){if(e.target===window||!e.target){const o=`${e.message} at ${e.filename}:${e.lineno}:${e.colno}`;g.error(o,{filename:e.filename,lineno:e.lineno,colno:e.colno,source:"window.error"})}},!0),window.addEventListener("unhandledrejection",function(e){let o="Promise rejection: ",t=null;e.reason instanceof Error?(o+=e.reason.message,t={name:e.reason.name,message:e.reason.message,stack:e.reason.stack?e.reason.stack.substring(0,200):null,source:"unhandledrejection"}):typeof e.reason=="string"?(o+=e.reason,t={message:e.reason,source:"unhandledrejection"}):(o+=JSON.stringify(e.reason).substring(0,200),t={reason:e.reason,source:"unhandledrejection"}),g.error(o,t)})}function R(){let e=window.location.href,o=window.location.hash;const t=[];let n=-1;window.addEventListener("hashchange",function(){const i=window.location.href,a=window.location.hash;a!==o&&(e=i,o=a,t.push({url:i,pathname:window.location.pathname+a,timestamp:Date.now()}),n=t.length-1,s("hashchange",i,window.location.pathname+a))}),window.addEventListener("popstate",function(){const i=window.location.href,a=window.location.hash;if(i!==e||a!==o){e=i,o=a;let l=-1;const d=window.location.pathname+a;for(let h=t.length-1;h>=0;h--)if(t[h].url===i||t[h].pathname===d){l=h;break}let m="unknown";l!==-1&&l!==n?(l<n?m="back":l>n&&(m="forward"),n=l):l===-1&&(t.push({url:i,pathname:d,timestamp:Date.now()}),n=t.length-1,m="forward"),s("popstate",i,d,null,m)}});const c=window.history.pushState;window.history.pushState=function(...i){c.apply(window.history,i);const a=window.location.href,l=window.location.hash;(a!==e||l!==o)&&(e=a,o=l,t.push({url:a,pathname:window.location.pathname+l,timestamp:Date.now()}),n=t.length-1,s("pushState",a,window.location.pathname+l,i[2]))};const r=window.history.replaceState;window.history.replaceState=function(...i){r.apply(window.history,i);const a=window.location.href,l=window.location.hash;(a!==e||l!==o)&&(e=a,o=l,t.length===0?(t.push({url:a,pathname:window.location.pathname+l,timestamp:Date.now()}),n=0):n>=0&&n<t.length&&(t[n]={url:a,pathname:window.location.pathname+l,timestamp:Date.now()}),s("replaceState",a,window.location.pathname+l,i[2]))};function s(i,a,l,d=null,m=null){let h=null;if(d!=null)try{h=JSON.parse(JSON.stringify(d))}catch{h=d.toString?d.toString():"[Non-serializable]"}const M={historyType:i,url:a,pathname:l,state:h,timestamp:Date.now(),...m&&{direction:m}};if(u.historyChanges.push(M),u.historyChanges.length>S.maxLogs&&u.historyChanges.shift(),window.parent&&window.parent!==window)try{const{documentString:y,isWhiteScreen:_}=E(),N={type:"dev-monitor-history-change",...M,isWhiteScreen:_,...y&&{documentString:y}};window.parent.postMessage(N,"*")}catch{}}setTimeout(()=>{t.push({url:e,pathname:window.location.pathname+o,timestamp:Date.now()}),n=0,s("initial",e,window.location.pathname+o)},100)}function W(){if(window.__wxjs_environment!=="miniprogram")return;function e(){const r=document.querySelector("head > title")?.textContent||"\u9875\u9762\u9884\u89C8",s=document.body.innerHTML||"";window.wx.miniProgram.postMessage({data:{html:s,title:r}})}function o(r,s){try{const i=new URL(r,window.location.origin);if(i.searchParams.has(s))return i.searchParams.get(s);if(i.hash.includes("?")){const a=i.hash.split("?")[1],l=new URLSearchParams(a);if(l.has(s))return l.get(s)}return null}catch{return console.warn("\u65E0\u6548 URL\uFF1A",r),null}}function t(){const r=window.location.href,s=o(r,"_ticket"),i=o(r,"jump_type");if(!s||!i){console.warn("[dev-monitor] \u672A\u68C0\u6D4B\u5230 _ticket \u6216 jump_type\uFF0C\u8DF3\u8FC7\u9996\u9875\u6309\u94AE\u6E32\u67D3");return}i==="inner"&&I(()=>{n(i)}),i==="outer"&&n(i)}function n(r){const s=document.createElement("div");s.innerHTML="X",Object.assign(s.style,{position:"fixed",bottom:"16px",right:"16px",width:"30px",height:"30px",lineHeight:"30px",textAlign:"center",borderRadius:"22px",background:"rgba(0, 0, 0, 0.15)",color:"#fff",fontSize:"14px",zIndex:"99999",cursor:"pointer",userSelect:"none",WebkitUserSelect:"none"});function i(){s.remove(),setTimeout(()=>{r==="outer"&&window.wx.miniProgram.reLaunch({url:"/pages/index/index"}),r==="inner"&&window.wx.miniProgram.navigateBack()},50)}s.addEventListener("click",()=>{try{i()}catch{}}),s.addEventListener("touchend",a=>{a?.preventDefault();try{i()}catch{}},{passive:!1}),document.body.appendChild(s)}function c(){const r=document.createElement("script");r.type="text/javascript",r.src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js",r.onload=function(){t(),setTimeout(()=>{let i=null;new MutationObserver(()=>{clearTimeout(i),i=setTimeout(()=>{try{e()}catch{}},500)}).observe(document.body,{childList:!0,subtree:!0,characterData:!0}),e()},100)},(()=>{document.head&&document.head.appendChild(r)})()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c()}function I(e){let o=!1;const t=()=>{o||(o=!0,e(),window.removeEventListener("popstate",t),window.removeEventListener("hashchange",t),history.pushState=n)},n=history.pushState;history.pushState=function(...c){const r=n.apply(this,c);return t(),r},window.addEventListener("popstate",()=>{t()}),window.addEventListener("hashchange",()=>{t()})}function O(){v(),H(),R(),W(),u.ready=!0}function L(){try{const e=getComputedStyle(document.documentElement);for(const o of e)if(o&&o.startsWith("--tw-"))return!0;return!1}catch{return!1}}function U(){const e=document.readyState==="complete"?300:1e3;setTimeout(()=>{if(!L()){setTimeout(()=>{L()&&k()},1e3);return}k()},e)}function k(){try{const e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href="/sdk/tailwind_design_mode.all.css?v="+S.version,document.head.appendChild(e)}catch(e){console.warn("\u52A0\u8F7D tailwind_design_mode.all.css \u5931\u8D25",e)}}O()})();})();
