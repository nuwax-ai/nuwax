"use strict";(()=>{(self.webpackChunk=self.webpackChunk||[]).push([[8129],{67522:function(re,D,n){var T=n(15009),o=n.n(T),O=n(99289),R=n.n(O),b=n(89299),F=n(99659),U=n(39902),p=function(){var W=(0,F.Z)(b.co,{manual:!0,debounceMaxWait:300}),_=W.runAsync,B=function(){var m=R()(o()().mark(function j(c,r){var x,g,A,d,L;return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return x=r?.variableParams,u.next=3,_({agentId:c,devMode:!1,variables:x});case 3:g=u.sent,A=g.success,d=g.data,A&&(L=d?.id,U.history.push("/home/chat/".concat(L,"/").concat(c),r));case 7:case"end":return u.stop()}},j)}));return function(c,r){return m.apply(this,arguments)}}();return{handleCreateConversation:B,runAsyncConversationCreate:_}};D.Z=p},5048:function(re,D,n){n.r(D),n.d(D,{default:function(){return ve}});var T=n(5574),o=n.n(T),O=n(88042),R=n(47873),b=n(86088),F=n(69478),U=n(56265),p=n(88639),$=n(77048),W=n(67522),_=n(97745),B=n(77744),m=n(91120),j=n(89575),c=n(50888),r=n(99859),x=n(45360),g=n(94184),A=n.n(g),d=n(30381),L=n.n(d),s=n(67294),u=n(39902),ue=n(88773),l={"main-content":"main-content___RZVrO","title-box":"title-box___sFfah",title:"title___UQDXG","chat-wrapper":"chat-wrapper___rpWPS",loading:"loading___gGjUA","chat-inner":"chat-inner___dS4XS","suggest-item":"suggest-item___PGZ70","chat-input-container":"chat-input-container___JdZct"},t=n(85893),i=A().bind(l),de=function(){var me=(0,u.useParams)(),P=Number(me.agentId),ce=r.Z.useForm(),ge=o()(ce,1),f=ge[0],fe=(0,s.useState)([]),H=o()(fe,2),v=H[0],Q=H[1],he=(0,s.useState)([]),X=o()(he,2),J=X[0],Y=X[1],Ce=(0,s.useState)(!1),z=o()(Ce,2),w=z[0],k=z[1],Se=(0,s.useState)([]),q=o()(Se,2),E=q[0],ee=q[1],De=(0,s.useState)([]),ne=o()(De,2),h=ne[0],pe=ne[1],_e=(0,s.useState)(null),te=o()(_e,2),M=te[0],ae=te[1],Z=(0,_.Z)(),se=Z.selectedComponentList,je=Z.setSelectedComponentList,xe=Z.handleSelectComponent,Ae=Z.initSelectedComponentList,Le=(0,W.Z)(),Pe=Le.handleCreateConversation,K=(0,$.Z)(),e=K.agentDetail,oe=K.setAgentDetail,Ee=K.handleToggleCollectSuccess,y=r.Z.useWatch([],{form:f,preserve:!0});s.useEffect(function(){y&&Object.keys(y).length===0||f.validateFields({validateOnly:!0}).then(function(){return ae(y)}).catch(function(){return ae(null)})},[f,y]);var le=(0,s.useMemo)(function(){if(h?.length>0){if(!M)return!0;var C=(0,j.VL)(h,Object.keys(M));return!C}return!1},[h,M]),ie=(0,u.useRequest)(B.xI,{manual:!0,debounceInterval:300,onSuccess:function(a){var S;oe(a),Y(a?.openingGuidQuestions||[]);var I=a?.variables||[];ee(I);var ye=I==null||(S=I.filter(function(N){return!N.systemVariable&&N.require}))===null||S===void 0?void 0:S.map(function(N){return N.name});if(pe(ye||[]),a!=null&&a.openingChatMsg){var Ie={role:m.hZ.ASSISTANT,type:m.Zy.CHAT,text:a?.openingChatMsg,time:L()().toString(),id:(0,ue.Z)(),messageType:m.DK.ASSISTANT};Q([Ie])}k(!0)}}),Me=ie.run,G=ie.loading;(0,s.useEffect)(function(){return Me(P),function(){k(!1),Q([]),Y([]),oe(null),je([]),ee([])}},[P]),(0,s.useEffect)(function(){Ae(e?.manualComponents)},[e?.manualComponents]);var Ze=(0,s.useMemo)(function(){return{assistant:{name:e?.name,avatar:e?.icon},system:{name:e?.name,avatar:e?.icon}}},[e]),V=function(a,S){if(e){if(le){f.validateFields(),x.ZP.warning("\u8BF7\u586B\u5199\u5FC5\u586B\u53C2\u6570");return}Pe(e.agentId,{message:a,files:S,infos:se,defaultAgentDetail:e,variableParams:M})}};return(0,t.jsxs)("div",{className:i("flex","h-full"),style:{overflowY:"scroll"},children:[(0,t.jsxs)("div",{className:i("flex-1","flex","flex-col",l["main-content"]),children:[(0,t.jsx)("div",{className:i(l["title-box"]),children:(0,t.jsx)("h3",{className:i(l.title,"text-ellipsis","clip-path-animation"),children:w&&(e!=null&&e.name?"\u548C".concat(e?.name,"\u5F00\u59CB\u4F1A\u8BDD"):"\u5F00\u59CB\u4F1A\u8BDD")})}),(0,t.jsx)("div",{className:i(l["chat-wrapper"],"flex-1"),children:G?(0,t.jsx)("div",{className:i("flex","items-center","content-center","h-full"),children:(0,t.jsx)(c.Z,{className:i(l.loading)})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.Z,{className:"mb-16",form:f,isFilled:!0,variables:E},P),v?.length>0?(0,t.jsxs)(t.Fragment,{children:[v?.map(function(C,a){return(0,t.jsx)(F.Z,{messageInfo:C,roleInfo:Ze,contentClassName:l["chat-inner"],mode:"none"},a)}),(0,t.jsx)(p.Z,{itemClassName:l["suggest-item"],loading:G,chatSuggestList:J,onClick:V})]}):w&&(0,t.jsx)(O.Z,{className:i({"h-full":!(E!=null&&E.length)}),icon:e?.icon,name:e?.name||"",extra:(0,t.jsx)(p.Z,{className:"mt-16",itemClassName:i(l["suggest-item"]),loading:G,chatSuggestList:J,onClick:V})})]})}),(0,t.jsx)(b.Z,{className:i(l["chat-input-container"]),onEnter:V,isClearInput:!1,wholeDisabled:le,manualComponents:e?.manualComponents||[],selectedComponentList:se,onSelectComponent:xe})]}),(0,t.jsx)(R.Z,{agentId:P,agentDetail:e,onToggleCollectSuccess:Ee})]})},ve=de}}]);})();
