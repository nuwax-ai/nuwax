"use strict";(()=>{(self.webpackChunk=self.webpackChunk||[]).push([[4570],{76523:function(Ce,T,e){e.d(T,{Z:function(){return ce}});var y=e(97857),c=e.n(y),f=e(95141),B=e(67294),P=e(94184),L=e.n(P),g={container:"container___bLyIn"},n=e(85893),p=L().bind(g),$=function(a){var m=a.className,u=a.title,o=a.content,l=a.onClick;return(0,n.jsxs)("div",{className:p(g.container,"flex","flex-col","cursor-pointer",m),onClick:l,children:[(0,n.jsx)("h3",{children:u}),(0,n.jsx)("p",{className:"text-ellipsis-2",children:o})]})},W=$,E=e(75216),C={container:"container___uoSDc",box:"box___on4p2"},I=L().bind(C),F=function(a){var m=a.className,u=a.title,o=a.content,l=a.image,S=a.onClick;return(0,n.jsxs)("div",{className:I(C.container,"flex","cursor-pointer",m),onClick:S,children:[(0,n.jsx)(E.Z,{condition:l,children:(0,n.jsx)("img",{className:"radius-6",src:l,alt:""})}),(0,n.jsxs)("div",{className:I(C.box,"flex-1"),children:[(0,n.jsx)("h3",{className:"text-ellipsis-2",children:u}),(0,n.jsx)("p",{className:"text-ellipsis-2",children:o})]})]})},U=F,b={container:"container___ujWA4"},z=L().bind(b),xe=function(a){var m=a.className,u=a.title,o=a.content,l=a.image,S=a.onClick;return(0,n.jsxs)("div",{className:z(b.container,"cursor-pointer",m),onClick:S,children:[(0,n.jsx)("h3",{children:u}),(0,n.jsx)(E.Z,{condition:l,children:(0,n.jsx)("img",{className:"radius-6",src:l,alt:""})}),(0,n.jsx)("p",{className:"text-ellipsis-2",children:o})]})},oe=xe,K={container:"container___mGrAV"},Ne=L().bind(K),le=function(a){var m=a.className,u=a.title,o=a.content,l=a.image,S=a.onClick;return(0,n.jsxs)("div",{className:Ne(K.container,"flex","flex-col","cursor-pointer",m),onClick:S,children:[(0,n.jsx)("h3",{children:u}),(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("p",{className:"flex-1 text-ellipsis-2",children:o}),(0,n.jsx)(E.Z,{condition:l,children:(0,n.jsx)("img",{className:"radius-6",src:l,alt:""})})]})]})},Se=le,ie=function(a){var m=a.cardKey,u=a.bindLinkUrl,o=function(){u&&window.open(u)};switch(m){case f.H1.ONE:return(0,n.jsx)(U,c()(c()({},a),{},{onClick:o}));case f.H1.TWO:return(0,n.jsx)(Se,c()(c()({},a),{},{onClick:o}));case f.H1.THREE:return(0,n.jsx)(oe,c()(c()({},a),{},{onClick:o}));case f.H1.FOUR:return(0,n.jsx)(W,c()(c()({},a),{},{onClick:o}))}},re=ie,v=e(57882),Z=e(32983),d={"inner-container":"inner-container____n5mL","card-item-container":"card-item-container___rBOVp"},Q=L().bind(d),G=function(a){var m=a.className,u=a.visible,o=a.onClose,l=a.cardList;return(0,n.jsx)(v.Z,{title:"\u5C55\u793A\u53F0",className:m,visible:u,onClose:o,children:l?.length>0?(0,n.jsx)("div",{className:Q(d["inner-container"],"scrollbar"),children:(0,n.jsx)("div",{className:Q(d["card-item-container"]),children:l?.map(function(S,je){return(0,n.jsx)(re,c()({},S),"".concat(S.cardKey).concat(je))})})}):(0,n.jsx)("div",{className:Q("flex","h-full","items-center","content-center"),children:(0,n.jsx)(Z.Z,{description:"\u6682\u65E0\u6570\u636E"})})})},ce=G},57882:function(Ce,T,e){e.d(T,{Z:function(){return W}});var y=e(9783),c=e.n(y),f=e(97937),B=e(94184),P=e.n(B),L=e(67294),g={container:"container___ZmQyk",hidden:"hidden___sQc7Y",header:"header___NPVhj",close:"close___T88xb","divider-horizontal":"divider-horizontal___Lmz1p"},n=e(85893),p=P().bind(g),$=function(C){var I=C.className,F=C.title,U=C.visible,b=C.onClose,z=C.children;return(0,n.jsxs)("div",{className:p("flex","flex-col","overflow-y",g.container,I,c()({},g.hidden,!U)),children:[(0,n.jsxs)("div",{className:p(g.header,"flex","items-center","content-between"),children:[(0,n.jsx)("h3",{children:F}),(0,n.jsx)(f.Z,{className:p(g.close,"cursor-pointer"),onClick:b})]}),(0,n.jsx)("div",{className:p(g["divider-horizontal"])}),(0,n.jsx)("div",{className:"flex-1 overflow-y",children:z})]})},W=$},1367:function(Ce,T,e){e.d(T,{Z:function(){return c}});var y=function(f){return f.NewNotifyMessage="new_notify_message",f.RefreshChatMessage="refresh_chat_message",f}({}),c={NewNotifyMessage:y.NewNotifyMessage,RefreshChatMessage:y.RefreshChatMessage}},94778:function(Ce,T,e){e.r(T),e.d(T,{default:function(){return S}});var y=e(19632),c=e.n(y),f=e(15009),B=e.n(f),P=e(99289),L=e.n(P),g=e(5574),n=e.n(g),p=e(88042),$=e(47873),W=e(86088),E=e(69478),C=e(56265),I=e(88639),F=e(1367),U=e(77048),b=e(97745),z=e(77744),xe=e(91120),oe=e(89575),K=e(96231),Ne=e(50888),le=e(99859),Se=e(94184),ie=e.n(Se),re=e(96486),v=e(67294),Z=e(39902),d={"title-box":"title-box___iID3k",title:"title___hLdV6","main-content":"main-content___Mnb2h","chat-wrapper":"chat-wrapper___wkNNq",loading:"loading___K4RqU","chat-inner":"chat-inner___Io6kE","suggest-item":"suggest-item___Rmslc","chat-input-container":"chat-input-container___IZ7zv","agent-sidebar":"agent-sidebar___hBEH6"},Q=e(76523),G=e(1322),ce={container:"container___9JQHs",box:"box___txrQH","main-wrap":"main-wrap___R3g6N"},s=e(85893),a=ie().bind(ce),m=function(){var A=(0,Z.useModel)("conversationInfo"),Y=A.cardList,D=A.showType,J=A.setShowType;return(0,s.jsx)("div",{className:a("flex","flex-col","items-end",ce.container),style:{display:D===G.wv.Show_Stand?"flex":"none"},children:(0,s.jsx)(Q.Z,{className:a("flex-1"),cardList:Y,visible:D===G.wv.Show_Stand,onClose:function(){return J(G.wv.Hide)}})})},u=m,o=ie().bind(d),l=function(){var A,Y,D,J,de,Te,ye,X=(0,Z.useLocation)(),Re=(0,Z.useParams)(),M=Number(Re.id),k=Number(Re.agentId),q=(A=X.state)===null||A===void 0?void 0:A.message,_=(Y=X.state)===null||Y===void 0?void 0:Y.files,R=(D=X.state)===null||D===void 0?void 0:D.infos,Ee=(J=X.state)===null||J===void 0?void 0:J.variableParams,ee=(de=X.state)===null||de===void 0?void 0:de.defaultAgentDetail,$e=le.Z.useForm(),We=n()($e,1),H=We[0],Ue=(0,v.useState)(null),Fe=n()(Ue,2),ve=Fe[0],Le=Fe[1],ue=(0,v.useRef)(!1),pe=(0,U.Z)(),ze=pe.agentDetail,be=pe.setAgentDetail,Ke=pe.handleToggleCollectSuccess,me=(0,b.Z)(),De=me.selectedComponentList,Qe=me.setSelectedComponentList,Ge=me.handleSelectComponent,Ye=me.initSelectedComponentList,i=(0,Z.useModel)("conversationInfo"),h=i.conversationInfo,Ze=i.manualComponents,Je=i.loadingConversation,w=i.messageList,Xe=i.setMessageList,He=i.chatSuggestList,ke=i.runAsync,qe=i.isLoadingConversation,_e=i.setIsLoadingConversation,en=i.loadingSuggest,we=i.onMessageSend,O=i.messageViewRef,he=i.allowAutoScrollRef,Ie=i.scrollTimeoutRef,nn=i.showScrollBtn,Ae=i.setShowScrollBtn,an=i.resetInit,fe=i.variables,ne=i.requiredNameList,ae=i.userFillVariables,ge=le.Z.useWatch([],{form:H,preserve:!0});(0,v.useEffect)(function(){ge&&Object.keys(ge).length===0||H.validateFields({validateOnly:!0}).then(function(){return Le(ge)}).catch(function(){return Le(null)})},[H,ge]),(0,v.useEffect)(function(){ae&&(H.setFieldsValue(ae),ue.current=!0,Le(ae))},[ae]);var Oe=(0,v.useMemo)(function(){if(ne?.length>0){if(!ve)return!0;var t=(0,oe.VL)(ne,Object.keys(ve));return!t}return!1},[ne,ve]),tn=(0,v.useMemo)(function(){var t=h?.agent;return{assistant:{name:t?.name,avatar:t?.icon},system:{name:t?.name,avatar:t?.icon}}},[h]),Ve=(0,Z.useRequest)(z.xI,{manual:!0,debounceInterval:300,onSuccess:function(r){be(r)}}),sn=Ve.run,on=Ve.loading;(0,v.useEffect)(function(){k!==ee?.agentId?sn(k):be(ee)},[k,ee]),(0,v.useEffect)(function(){var t=O.current;if(t){var r=function(){var V=t.scrollTop,j=t.scrollHeight,N=t.clientHeight;V+N<j?(he.current=!1,Ie.current&&(clearTimeout(Ie.current),Ie.current=null),Ae(!0)):(he.current=!0,Ae(!1))};return t.addEventListener("wheel",(0,re.throttle)(r,300)),function(){t.removeEventListener("wheel",(0,re.throttle)(r,300))}}},[]),(0,v.useEffect)(function(){if(M){_e(!1);var t=function(){var r=L()(B()().mark(function x(){var V,j,N,te,Pe;return B()().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return se.next=2,ke(M);case 2:V=se.sent,j=V.data,N=j?.messageList||[],te=N?.length||0,Pe=!te||te===1&&N[0].messageType===xe.DK.ASSISTANT,Pe&&(q||_?.length>0)&&we(M,q,_,R,Ee);case 8:case"end":return se.stop()}},x)}));return function(){return r.apply(this,arguments)}}();t()}return function(){an()}},[M,q,_,R,Ee]),(0,v.useEffect)(function(){(0,oe.t7)()},[]),(0,v.useEffect)(function(){R!=null&&R.length?Qe(R||[]):Ye(Ze)},[R,Ze]);var Be=function(r){var x=r.conversationId,V=r.message;if(Number(M)===Number(x)&&(Xe(function(te){return[].concat(c()(te),[V])}),he.current)){var j,N;(j=O.current)===null||j===void 0||j.scrollTo({top:(N=O.current)===null||N===void 0?void 0:N.scrollHeight,behavior:"smooth"})}};(0,v.useEffect)(function(){return K.Z.on(F.Z.RefreshChatMessage,Be),function(){K.Z.off(F.Z.RefreshChatMessage,Be)}},[]);var ln=function(){Z.history.push("/agent/".concat(k))},Me=function(r){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];if(Oe){H.validateFields(),q.warning("\u8BF7\u586B\u5199\u5FC5\u586B\u53C2\u6570");return}ue.current=!0,we(M,r,x,De,ve)},rn=function(){var r,x;he.current=!0,(r=O.current)===null||r===void 0||r.scrollTo({top:(x=O.current)===null||x===void 0?void 0:x.scrollHeight,behavior:"smooth"}),Ae(!1)};return(0,s.jsxs)("div",{className:o("flex","h-full"),style:{overflowY:"scroll"},ref:O,children:[(0,s.jsxs)("div",{className:o("flex-1","flex","flex-col",d["main-content"]),children:[(0,s.jsx)("div",{className:o(d["title-box"]),children:(0,s.jsx)("h3",{className:o(d.title,"text-ellipsis","clip-path-animation"),children:h?.topic})}),(0,s.jsx)("div",{className:o(d["chat-wrapper"],"flex-1"),children:Je?(0,s.jsx)("div",{className:o("flex","items-center","content-center","h-full"),children:(0,s.jsx)(Ne.Z,{className:o(d.loading)})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.Z,{className:"mb-16",form:H,variables:fe,isFilled:ue.current,disabled:!!ae||ue.current}),w?.length>0?(0,s.jsxs)(s.Fragment,{children:[w?.map(function(t,r){return(0,s.jsx)(E.Z,{messageInfo:t,roleInfo:tn,contentClassName:d["chat-inner"],mode:"home"},t.id||r)}),(0,s.jsx)(I.Z,{itemClassName:d["suggest-item"],loading:en,chatSuggestList:He,onClick:Me})]}):qe&&!q&&(0,s.jsx)(p.Z,{className:o({"h-full":!(fe!=null&&fe.length)}),icon:h==null||(Te=h.agent)===null||Te===void 0?void 0:Te.icon,name:h==null||(ye=h.agent)===null||ye===void 0?void 0:ye.name,extra:(0,s.jsx)(I.Z,{className:"mt-16",itemClassName:o(d["suggest-item"]),chatSuggestList:He,onClick:Me})})]})}),(0,s.jsx)(W.Z,{className:o(d["chat-input-container"]),onEnter:Me,visible:nn,wholeDisabled:Oe,onClear:ln,manualComponents:Ze,selectedComponentList:De,onSelectComponent:Ge,onScrollBottom:rn},M)]}),(0,s.jsx)($.Z,{className:o(d["agent-sidebar"]),agentId:k,loading:on,agentDetail:ze,onToggleCollectSuccess:Ke}),(0,s.jsx)(u,{})]})},S=l}}]);})();
