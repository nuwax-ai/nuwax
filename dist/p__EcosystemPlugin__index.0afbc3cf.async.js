"use strict";(()=>{(self.webpackChunk=self.webpackChunk||[]).push([[7696],{29986:function(Aa,x,u){u.r(x),u.d(x,{default:function(){return Be}});var Ce=u(19632),_=u.n(Ce),be=u(97857),b=u.n(be),Te=u(15009),f=u.n(Te),De=u(99289),A=u.n(De),Pe=u(5574),p=u.n(Pe),Ee=u(96947),Ae=u(78927),Ne=u(33265),Le=u(28365),D=u(59170),y=u(9297),N=u(91120),g=u(30928),je=u(25278),ke=u(3914),we=u(34041),Re=u(85804),Ie=u(80688),$e=u(32983),He=u(94184),Je=u.n(He),c=u(67294),S={container:"container___tnDVH",header:"header___dDn36",tabs:"tabs___U2ugD",searchInput:"searchInput___cgdZK",pluginList:"pluginList___JxOh1","list-section":"list-section___k1SHt",title:"title___tWZUT",headerRight:"headerRight___u2mgm",select:"select___olaJQ"},Fe=u(70787),Ze=u(70852),Me=u(13969),i=u(85893),v=Je().bind(S),ee=je.Z.Search,w=24,ze=Me.Ne.filter(function(L){return[N.qR.Plugin].includes(L.key)});function Be(){var L,U,G,Ve=ke.Z.useApp(),h=Ve.message,Ue=(0,c.useState)(""),ae=p()(Ue,2),R=ae[0],O=ae[1],Ge=(0,c.useState)(D.eH.ALL),re=p()(Ge,2),P=re[0],Oe=re[1],Ke=(0,c.useState)(!1),ne=p()(Ke,2),Qe=ne[0],I=ne[1],We=(0,c.useState)(null),se=p()(We,2),E=se[0],te=se[1],Ye=(0,c.useState)(!1),ue=p()(Ye,2),Xe=ue[0],$=ue[1],qe=(0,c.useState)(!1),le=p()(qe,2),K=le[0],ie=le[1],xe=(0,c.useState)(null),de=p()(xe,2),H=de[0],J=de[1],_e=(0,c.useState)(!1),oe=p()(_e,2),Q=oe[0],F=oe[1],ea=(0,c.useState)({size:10,records:[],total:0,current:1,pages:0}),ce=p()(ea,2),C=ce[0],Z=ce[1],aa=(0,c.useState)({current:1,pageSize:w}),he=p()(aa,2),j=he[0],fe=he[1],ra=(0,c.useCallback)(A()(f()().mark(function s(){var e,a,l,t,r,m,d,n,W,Y,X,Se,k,me,ye,q=arguments;return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:e=q.length>0&&q[0]!==void 0?q[0]:{},a=e.tabType,l=e.keyword,t=l===void 0?"":l,r=e.page,m=r===void 0?1:r,d=e.pageSize,n=d===void 0?w:d,W=e.shareStatus,Y=W===void 0?-1:W,X=e.categoryCode,Se=X===void 0?"":X,F(!0),o.prev=2,o.t0=a,o.next=o.t0===D.eH.ALL?6:o.t0===D.eH.ENABLED?8:o.t0===D.eH.SHARED?10:12;break;case 6:return k=g.wF.ALL,o.abrupt("break",13);case 8:return k=g.wF.ENABLED,o.abrupt("break",13);case 10:return k=g.wF.MY_SHARE,o.abrupt("break",13);case 12:k=g.wF.ALL;case 13:return me={queryFilter:{dataType:g.Th.PLUGIN,subTabType:k,name:t||void 0,shareStatus:Y===-1?void 0:Y,categoryCode:Se||void 0},current:m,pageSize:n,orders:[{column:"created",asc:!1}]},Z({size:n,records:[],total:0,current:m,pages:0}),o.next=17,(0,y.k_)(me);case 17:ye=o.sent,Z(ye),o.next=25;break;case 21:o.prev=21,o.t1=o.catch(2),console.error("\u83B7\u53D6\u63D2\u4EF6\u5217\u8868\u5931\u8D25:",o.t1),h.error("\u83B7\u53D6\u63D2\u4EF6\u5217\u8868\u5931\u8D25");case 25:return o.prev=25,F(!1),o.finish(25);case 28:case"end":return o.stop()}},s,null,[[2,21,25,28]])})),[P,R,j.current,j.pageSize]),T=function(e){fe({current:1,pageSize:w}),ra(b()({tabType:P,keyword:e?.keyword===void 0?R:e.keyword,page:1,pageSize:w},e||{}))};(0,c.useEffect)(function(){T()},[]),(0,c.useEffect)(function(){T()},[P]);var na=function(e){var a=P===D.eH.SHARED,l=P===D.eH.ALL;return{icon:e.icon||"",title:e.name||"\u672A\u547D\u540D\u63D2\u4EF6",description:e.description||"\u6682\u65E0\u63CF\u8FF0",isNewVersion:e.isNewVersion,author:e.author||"",targetType:e.targetType,configParamJson:e.serverConfigParamJson,localConfigParamJson:e.localConfigParamJson,isEnabled:l?e.useStatus===g.MN.ENABLED:void 0,shareStatus:a?e.shareStatus:void 0,publishDoc:e.publishDoc}},sa=function(e){return{icon:e.icon||"",title:e.name||"\u672A\u547D\u540D\u63D2\u4EF6",description:e.description||"\u6682\u65E0\u63CF\u8FF0",isNewVersion:e.isNewVersion||!1,author:e.author||"",ownedFlag:e.ownedFlag,targetType:e.targetType,configParamJson:e.serverConfigParamJson,localConfigParamJson:e.localConfigParamJson,isEnabled:e.useStatus===g.MN.ENABLED,publishDoc:e.publishDoc}},M=function(e){O(e),T({keyword:e})},ta=function(){te(null),I(!1)},ua=function(){var s=A()(f()().mark(function e(a){var l;return f()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(E){r.next=2;break}return r.abrupt("return",!1);case 2:return l=null,r.prev=3,r.next=6,(0,y.$t)({uid:E.uid,configParamJson:JSON.stringify(a)});case 6:l=r.sent,r.next=13;break;case 9:return r.prev=9,r.t0=r.catch(3),h.error("\u64CD\u4F5C\u5931\u8D25"),r.abrupt("return",!1);case 13:if(!l){r.next=18;break}return I(!1),h.success("\u66F4\u65B0\u6210\u529F"),T(),r.abrupt("return",!0);case 18:return h.error("\u66F4\u65B0\u5931\u8D25"),r.abrupt("return",!1);case 20:case"end":return r.stop()}},e,null,[[3,9]])}));return function(a){return s.apply(this,arguments)}}(),la=function(){var s=A()(f()().mark(function e(){var a;return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(E!=null&&E.uid){t.next=2;break}return t.abrupt("return",!1);case 2:return a=null,t.prev=3,t.next=6,(0,y.m5)(E.uid);case 6:a=t.sent,t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(3),h.error("\u4E0B\u7EBF\u5931\u8D25"),t.abrupt("return",!1);case 13:if(!a){t.next=18;break}return h.success("\u5DF2\u4E0B\u7EBF"),I(!1),T(),t.abrupt("return",!0);case 18:return h.error("\u4E0B\u7EBF\u5931\u8D25"),t.abrupt("return",!1);case 20:case"end":return t.stop()}},e,null,[[3,9]])}));return function(){return s.apply(this,arguments)}}(),ia=function(){ie(!1),J(null),$(!0)},da=function(){T(),$(!1),J(null)},oa=function(){var s=A()(f()().mark(function e(a,l){var t,r,m;return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,t={name:a.name,description:a.description,dataType:g.Th.PLUGIN,targetType:a.targetType||N.qR.Plugin,targetId:a.targetId,categoryCode:a.categoryCode,categoryName:a.categoryName,useStatus:a.useStatus||g.MN.ENABLED,author:a.author,publishDoc:a.publishDoc,configParamJson:a.configParamJson,icon:a.icon},r=null,!(K&&H!==null&&H!==void 0&&H.uid)){n.next=16;break}if(m=b()(b()({},t),{},{uid:H.uid}),!l){n.next=11;break}return n.next=8,(0,y.Cd)(m);case 8:r=n.sent,n.next=14;break;case 11:return n.next=13,(0,y.F6)(m);case 13:r=n.sent;case 14:n.next=25;break;case 16:if(!l){n.next=22;break}return n.next=19,(0,y.$Q)(t);case 19:r=n.sent,n.next=25;break;case 22:return n.next=24,(0,y.TG)(t);case 24:r=n.sent;case 25:if(!r){n.next=31;break}return h.success(K?"\u66F4\u65B0\u6210\u529F":"\u521B\u5EFA\u6210\u529F"),da(),n.abrupt("return",!0);case 31:return h.error("\u64CD\u4F5C\u5931\u8D25"),n.abrupt("return",!1);case 33:n.next=40;break;case 35:return n.prev=35,n.t0=n.catch(0),console.error("\u4FDD\u5B58\u5206\u4EAB\u5931\u8D25:",n.t0),h.error("\u64CD\u4F5C\u5931\u8D25"),n.abrupt("return",!1);case 40:case"end":return n.stop()}},e,null,[[0,35]])}));return function(a,l){return s.apply(this,arguments)}}(),ca=function(){var s=A()(f()().mark(function e(a,l){var t,r,m=arguments;return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=m.length>2&&m[2]!==void 0?m[2]:!1,F(!0),n.prev=2,n.next=5,(0,y.k_)({queryFilter:{dataType:g.Th.PLUGIN},current:a,pageSize:l,orders:[{column:"created",asc:!1}]});case 5:r=n.sent,t&&C.records?Z(b()(b()({},r),{},{records:[].concat(_()(C.records||[]),_()(r.records||[]))})):Z(r),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(2),console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",n.t0),h.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25");case 13:return n.prev=13,F(!1),n.finish(13);case 16:case"end":return n.stop()}},e,null,[[2,9,13,16]])}));return function(a,l){return s.apply(this,arguments)}}(),ha=function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;Q||(fe(function(l){return b()(b()({},l),{},{current:e})}),ca(e,j.pageSize,a))},fa=function(e){T({shareStatus:e})},va=function(e){T({categoryCode:e===""?void 0:e})},pa=function(){return P===D.eH.SHARED?(0,i.jsxs)("div",{className:v(S.headerRight),children:[(0,i.jsx)(we.Z,{options:[{label:"\u5168\u90E8",value:-1},{label:"\u5DF2\u53D1\u5E03",value:3},{label:"\u5BA1\u6838\u4E2D",value:2},{label:"\u5DF2\u4E0B\u7EBF",value:4}],defaultValue:-1,onChange:function(a){return fa(a)},className:v(S.select)}),(0,i.jsx)(ee,{className:v(S.searchInput),placeholder:"\u641C\u7D22\u63D2\u4EF6",value:R,onChange:function(a){return O(a.target.value)},onSearch:M,onClear:function(){return M("")},allowClear:!0}),(0,i.jsx)(Re.ZP,{type:"primary",onClick:ia,children:"\u521B\u5EFA\u5206\u4EAB"})]}):(0,i.jsxs)("div",{className:v(S.headerRight),children:[(0,i.jsx)(Ae.Z,{targetType:N.qR.Plugin,onChange:function(a){return va(a)}}),(0,i.jsx)(ee,{className:v(S.searchInput),placeholder:"\u641C\u7D22\u63D2\u4EF6",value:R,onChange:function(a){return O(a.target.value)},onSearch:M,onClear:function(){return M("")},allowClear:!0})]})},ga=(0,c.useState)(!1),ve=p()(ga,2),Sa=ve[0],z=ve[1],ma=(0,c.useState)(null),pe=p()(ma,2),ya=pe[0],B=pe[1],Ca=(0,c.useState)([]),ge=p()(Ca,2),ba=ge[0],V=ge[1],Ta=function(e){z(!1),B({icon:e.icon,name:e.name,description:e.description,targetType:e.targetType,targetId:e.targetId.toString(),shareStatus:g.yB.DRAFT}),V([{type:e.targetType,targetId:e.targetId,status:N.BQ.Added}])},Da=function(){var s=A()(f()().mark(function e(a){var l,t,r;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(P!=="shared"){d.next=12;break}return J(a),ie(!0),$(!0),z(!1),l=a.targetType,t={icon:a.icon||"",uid:a.uid,name:a.name||"",description:a.description||"",targetType:l,targetId:(a.targetId||"").toString(),author:a.author||"",publishDoc:a.publishDoc||"",shareStatus:a.shareStatus,configParamJson:a.configParamJson||""},B(t),V([{type:l,targetId:Number(t.targetId)||0,status:N.BQ.Added}]),d.abrupt("return",!0);case 12:if(!a.uid){d.next=26;break}return d.prev=13,d.next=16,(0,y.Ry)(a.uid);case 16:if(r=d.sent,!r){d.next=21;break}return te(r),I(!0),d.abrupt("return",!0);case 21:d.next=26;break;case 23:d.prev=23,d.t0=d.catch(13),h.error("\u83B7\u53D6\u63D2\u4EF6\u8BE6\u60C5\u5931\u8D25");case 26:return d.abrupt("return",!1);case 27:case"end":return d.stop()}},e,null,[[13,23]])}));return function(a){return s.apply(this,arguments)}}(),Pa=function(){var s=A()(f()().mark(function e(a){var l;return f()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return l=null,r.prev=1,r.next=4,(0,y.n)(a);case 4:l=r.sent,r.next=11;break;case 7:return r.prev=7,r.t0=r.catch(1),h.error("\u4E0B\u7EBF\u5931\u8D25"),r.abrupt("return",!1);case 11:if(!l){r.next=15;break}return h.success("\u63D2\u4EF6\u5DF2\u4E0B\u7EBF"),T(),r.abrupt("return",!0);case 15:return h.error("\u4E0B\u7EBF\u5931\u8D25"),r.abrupt("return",!1);case 17:case"end":return r.stop()}},e,null,[[1,7]])}));return function(a){return s.apply(this,arguments)}}(),Ea=function(){$(!1),J(null),B(null),V([])};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:v(S.container,"flex","flex-col","h-full","overflow-hide"),children:[(0,i.jsx)("h3",{className:v(S.title),children:"\u63D2\u4EF6"}),(0,i.jsxs)("div",{className:v(S.header),children:[(0,i.jsx)(Ie.Z,{activeKey:P,onChange:function(e){return Oe(e)},className:v(S.tabs),items:D.l$}),pa()]}),(0,i.jsx)("div",{className:v(S.pluginList,"flex-1","overflow-y"),onScroll:function(e){var a=e.currentTarget,l=a.scrollTop,t=a.scrollHeight,r=a.clientHeight;t-l-r<100&&!Q&&j.current<(C.pages||0)&&ha(j.current+1,!0)},children:Q&&(C==null||(L=C.records)===null||L===void 0?void 0:L.length)===0?(0,i.jsx)(Ze.Z,{className:v("h-full")}):C!=null&&(U=C.records)!==null&&U!==void 0&&U.length?(0,i.jsx)("div",{className:v(S["list-section"]),children:(G=C.records)===null||G===void 0?void 0:G.map(function(s){return(0,i.jsx)(Fe.Z,b()(b()({},na(s)),{},{onClick:function(){return Da(s)}}),s?.uid)})}):(0,i.jsx)("div",{className:v("flex","h-full","items-center","content-center"),children:(0,i.jsx)($e.Z,{className:v("flex","flex-col","items-center","content-center"),description:"\u6682\u65E0\u6570\u636E"})})})]}),(0,i.jsx)(Ee.Z,{visible:Qe,data:E?sa(E):void 0,onClose:ta,onUpdateAndEnable:ua,onDisable:la}),(0,i.jsx)(Ne.Z,{type:g.Th.PLUGIN,targetType:N.qR.Plugin,visible:Xe,isEdit:K,onClose:Ea,onOffline:Pa,onSave:oa,data:ya,onAddComponent:function(){z(!0)},onRemoveComponent:function(){B(null),V([])}}),(0,i.jsx)(Le.Z,{checkTag:N.qR.Plugin,onAdded:Ta,open:Sa,onCancel:function(){return z(!1)},tabs:ze,addComponents:ba})]})}}}]);})();
