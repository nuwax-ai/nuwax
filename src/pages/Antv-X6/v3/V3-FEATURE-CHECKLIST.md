# V3 工作流编辑器回归测试清单

> 本文档以 V1 已实现功能为基准，对照 V3 进行回归测试验证。

## 测试状态说明

- ✅ 已实现/测试通过
- 🚧 实现中/部分完成
- ❌ 未实现/未测试
- ⚠️ 有问题/需修复

---

## V3 核心架构改动（相比 V1）

> 以下是 V3 版本相比 V1 的核心改动点：

| 改动项 | 说明 | 实现状态 |
| --- | --- | --- |
| **统一代理层** | 使用 `workflowProxyV3` 管理节点/边操作，单一数据源 | ✅ |
| **全量数据更新** | 组装全量数据后统一更新，以前端画布为依据 | ✅ |
| **前端变量引用计算** | 替代原 `getOutputArgs` 接口，前端计算引用关系 | ⚠️ 待验证 |
| **撤销/重做支持** | 使用 X6 History 插件支持撤销/重做 | ⚠️ 待验证 |

### 架构分层

```
v3/
├── components/        # UI 组件层
│   ├── layout/       # 布局组件 (Header, Sidebar, ControlPanel, WorkflowLayout)
│   ├── panels/       # 功能面板 (PropertyPanel)
│   └── graph/        # 画布容器 (GraphContainer)
├── hooks/            # 业务逻辑层
│   ├── useWorkflowLifecycle.ts   # 初始化/加载/销毁
│   ├── useGraphInteraction.ts    # 画布事件监听
│   ├── useWorkflowPersistence.ts # 保存逻辑
│   └── useAutoSave.ts            # 自动保存
├── services/         # 基础设施层
│   ├── workflowProxyV3.ts        # 数据代理
│   └── WorkflowSaveService.ts    # 保存服务
├── config/           # 配置
│   └── NodeRegistry.tsx          # 节点注册表
└── component/        # 节点配置组件 (V3 专属)
```

### V3 新增功能（V1 没有）

| 功能             | 说明                                       | 实现状态  |
| ---------------- | ------------------------------------------ | --------- |
| **变量聚合节点** | `VariableAggregation` 节点类型，多输入聚合 | ⚠️ 待验证 |

---

## 迁移任务总览

| 任务                     | 状态 | 优先级 | 备注                           |
| ------------------------ | ---- | ------ | ------------------------------ |
| workflowV3 model 迁移    | ✅   | P0     | 修复 skillChange bug           |
| V3 组件目录结构          | ✅   | P0     | components/hooks/services 分层 |
| NodeRegistry V3 组件引用 | ✅   | P0     | 改为 ../component/             |
| NewSkillV3 组件          | ✅   | P1     | 移除 loading                   |
| 技能列表保存逻辑         | ✅   | P0     | form.submit() 触发             |
| 功能回归对照调试         | 🚧   | P1     | 本清单追踪                     |

---

## 一、画布操作

> 对照 V1 画布基础交互功能

| V1 功能                  | V3 状态 | 测试结果 | 备注           |
| ------------------------ | ------- | -------- | -------------- |
| 画布拖拽平移             | ⚠️      |          | GraphContainer |
| 画布缩放（鼠标滚轮）     | ⚠️      |          |                |
| 画布缩放（控制面板按钮） | ⚠️      |          | ControlPanel   |
| 画布适应视图             | ⚠️      |          |                |
| 画布网格显示             | ⚠️      |          |                |

---

## 二、节点操作

### 2.1 节点选择

| V1 功能          | V3 状态 | 测试结果 | 备注 |
| ---------------- | ------- | -------- | ---- |
| 单击选中节点     | ⚠️      |          |      |
| 选中节点高亮边框 | ⚠️      |          |      |
| 点击空白取消选中 | ⚠️      |          |      |
| 多选节点         | ⚠️      |          |      |
| 框选多个节点     | ⚠️      |          |      |

### 2.2 节点添加

| V1 功能                     | V3 状态 | 测试结果 | 备注    |
| --------------------------- | ------- | -------- | ------- |
| 点击节点面板添加节点        | ⚠️      |          | Sidebar |
| 拖拽节点面板添加节点        | ⚠️      |          |         |
| 从输出端口点击添加节点      | ⚠️      |          |         |
| 复制节点（Ctrl+C / Ctrl+V） | ⚠️      |          |         |
| 复制节点（右键菜单）        | ⚠️      |          |         |

### 2.3 节点删除

| V1 功能                      | V3 状态 | 测试结果 | 备注 |
| ---------------------------- | ------- | -------- | ---- |
| Delete/Backspace 键删除      | ⚠️      |          |      |
| 删除时弹出确认框（循环节点） | ⚠️      |          |      |
| 开始/结束节点不可删除        | ⚠️      |          |      |
| 删除节点自动删除关联连线     | ⚠️      |          |      |

### 2.4 节点移动

| V1 功能            | V3 状态 | 测试结果 | 备注 |
| ------------------ | ------- | -------- | ---- |
| 拖拽移动节点       | ⚠️      |          |      |
| 移动时连线自动跟随 | ⚠️      |          |      |
| 移动后位置自动保存 | ⚠️      |          |      |

---

## 三、连线操作

### 3.1 连线创建

| V1 功能                | V3 状态 | 测试结果 | 备注 |
| ---------------------- | ------- | -------- | ---- |
| 从输出端口拖拽创建连线 | ⚠️      |          |      |
| 连线自动吸附到输入端口 | ⚠️      |          |      |
| 防止自连接             | ⚠️      |          |      |
| 防止重复连接           | ⚠️      |          |      |
| 端口点击快捷添加+连线  | ⚠️      |          |      |

### 3.2 连线渲染

| V1 功能                | V3 状态 | 测试结果 | 备注             |
| ---------------------- | ------- | -------- | ---------------- |
| 条件分支多输出端口连线 | ⚠️      |          | special 端口组   |
| 意图识别多输出端口连线 | ⚠️      |          | special 端口组   |
| 问答节点多输出端口连线 | ⚠️      |          | special 端口组   |
| 异常处理端口连线       | ⚠️      |          | exception 端口组 |

### 3.3 连线删除

| V1 功能                | V3 状态 | 测试结果 | 备注 |
| ---------------------- | ------- | -------- | ---- |
| 选中连线后 Delete 删除 | ⚠️      |          |      |
| 删除节点自动删除连线   | ⚠️      |          |      |

---

## 四、节点配置面板

### 4.1 面板基础

| V1 功能                      | V3 状态 | 测试结果 | 备注          |
| ---------------------------- | ------- | -------- | ------------- |
| 点击节点打开配置面板         | ⚠️      |          | PropertyPanel |
| 关闭配置面板                 | ⚠️      |          |               |
| 节点名称显示                 | ⚠️      |          |               |
| 节点名称编辑                 | ⚠️      |          |               |
| 操作菜单（复制/删除/试运行） | ⚠️      |          |               |

### 4.2 各节点类型配置

| 节点类型                   | V3 状态 | 测试结果 | 备注                       |
| -------------------------- | ------- | -------- | -------------------------- |
| **开始节点 (Start)**       | ⚠️      |          | nodeItem.tsx               |
| **结束节点 (End)**         | ⚠️      |          | nodeItem.tsx               |
| **过程输出 (Output)**      | ⚠️      |          | nodeItem.tsx               |
| **LLM 大模型节点**         | ⚠️      |          | complexNode.tsx            |
| - 技能组件选择             | ✅      |          | NewSkillV3 + form.submit() |
| - 技能增删改保存           | ✅      |          | form.submit() 已添加       |
| **知识库节点 (Knowledge)** | ⚠️      |          | library.tsx                |
| - 知识库增删改保存         | ✅      |          | form.submit() 已添加       |
| **意图识别节点**           | ⚠️      |          | complexNode.tsx            |
| **问答节点 (QA)**          | ⚠️      |          | complexNode.tsx            |
| **条件分支节点**           | ⚠️      |          | condition.tsx              |
| **循环节点 (Loop)**        | ⚠️      |          | nodeItem.tsx               |
| **代码节点 (Code)**        | ⚠️      |          | nodeItem.tsx               |
| **变量节点 (Variable)**    | ⚠️      |          | nodeItem.tsx               |
| **变量聚合节点**           | ⚠️      |          | useVariableAggregation.ts  |
| **文本处理节点**           | ⚠️      |          | nodeItem.tsx               |
| **文档提取节点**           | ⚠️      |          | nodeItem.tsx               |
| **数据库节点**             | ⚠️      |          | database.tsx               |
| **插件节点 (Plugin)**      | ⚠️      |          | pluginNode.tsx             |
| **工作流节点**             | ⚠️      |          | pluginNode.tsx             |
| **MCP 节点**               | ⚠️      |          | pluginNode.tsx             |
| **长期记忆节点**           | ⚠️      |          | pluginNode.tsx             |
| **HTTP 请求节点**          | ⚠️      |          | complexNode.tsx            |

### 4.3 变量引用功能

| V1 功能          | V3 状态 | 备注 |
| ---------------- | ------- | ---- |
| 变量引用选择器   | ⚠️      |      |
| 上游节点变量列表 | ⚠️      |      |
| 数据类型过滤     | ⚠️      |      |
| 循环内部变量引用 | ⚠️      |      |

---

## 五、工具栏功能

### 5.1 顶部工具栏

| V1 功能        | V3 状态 | 备注       |
| -------------- | ------- | ---------- |
| 返回按钮       | ⚠️      | Header.tsx |
| 工作流名称显示 | ⚠️      |            |
| 撤销按钮       | ⚠️      |            |
| 重做按钮       | ⚠️      |            |
| 保存按钮       | ⚠️      |            |
| 发布按钮       | ⚠️      |            |
| 版本历史按钮   | ⚠️      |            |

### 5.2 底部控制面板

| V1 功能        | V3 状态 | 备注             |
| -------------- | ------- | ---------------- |
| 缩放百分比显示 | ⚠️      | ControlPanel.tsx |
| 放大/缩小按钮  | ⚠️      |                  |
| 适应视图按钮   | ⚠️      |                  |
| 试运行按钮     | ⚠️      |                  |

---

## 六、数据保存

| V1 功能           | V3 状态 | 备注                |
| ----------------- | ------- | ------------------- |
| 手动保存          | ⚠️      | WorkflowSaveService |
| 自动保存          | ⚠️      | useAutoSave.ts      |
| 全量保存          | ✅      | workflowProxyV3     |
| 保存成功/失败提示 | ⚠️      |                     |

---

## 七、撤销/重做

| V1 功能                 | V3 状态 | 备注 |
| ----------------------- | ------- | ---- |
| 撤销操作（按钮）        | ⚠️      |      |
| 重做操作（按钮）        | ⚠️      |      |
| 撤销快捷键 Ctrl+Z       | ⚠️      |      |
| 重做快捷键 Ctrl+Shift+Z | ⚠️      |      |

---

## 八、弹窗功能

| V1 功能        | V3 状态 | 备注 |
| -------------- | ------- | ---- |
| 试运行弹窗     | ⚠️      |      |
| 发布弹窗       | ⚠️      |      |
| 编辑工作流弹窗 | ⚠️      |      |
| 版本历史抽屉   | ⚠️      |      |

---

## 九、异常处理

| V1 功能       | V3 状态 | 备注              |
| ------------- | ------- | ----------------- |
| 异常处理配置  | ⚠️      | ExceptionItem.tsx |
| 异常流程连线  | ⚠️      |                   |
| 超时/重试设置 | ⚠️      |                   |

---

## 十、快捷键

| 快捷键           | V1 功能  | V3 状态 |
| ---------------- | -------- | ------- |
| Ctrl+Z           | 撤销     | ⚠️      |
| Ctrl+Y/Shift+Z   | 重做     | ⚠️      |
| Ctrl+S           | 保存     | ⚠️      |
| Delete/Backspace | 删除选中 | ⚠️      |
| Ctrl+C           | 复制节点 | ⚠️      |
| Ctrl+V           | 粘贴节点 | ⚠️      |
| Ctrl+A           | 全选     | ⚠️      |

---

## 已完成功能汇总

### 架构重构 ✅

- [x] workflowV3 model 创建 (修复 skillChange bug)
- [x] V3 组件目录结构分层 (components/hooks/services)
- [x] NodeRegistry 引用 V3 组件
- [x] NewSkillV3 组件 (移除 loading)
- [x] 所有 V3 文件使用 workflowV3 model

### 技能列表功能 ✅

- [x] 技能列表显示 (Form.useWatch)
- [x] 技能添加触发保存
- [x] 技能删除触发保存
- [x] 技能修改触发保存
- [x] 知识库添加触发保存
- [x] 知识库删除触发保存
- [x] 知识库修改触发保存

---

## 待验证功能

### P0 - 高优先级

- [ ] 全部节点类型功能回归
- [ ] 节点属性面板保存逻辑
- [ ] 连线增删改保存

### P1 - 中优先级

- [ ] 撤销/重做功能
- [ ] 试运行功能
- [ ] 发布功能

### P2 - 低优先级

- [ ] 快捷键支持
- [ ] 版本历史

---

## 更新日志

### 2025-12-17 (初始)

- 创建 V3 功能检查清单
- 对照 V1-FEATURES.md 建立基准
- 记录已完成的架构重构和技能列表修复

---

_最后更新: 2025-12-17_
