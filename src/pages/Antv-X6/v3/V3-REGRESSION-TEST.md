# V3 复测清单

> 由于重构，需对 TODO 1-5 进行完整复测

## 测试类型说明

| 类型     | 标识 | 说明                    |
| -------- | ---- | ----------------------- |
| 手动验证 | 👆   | 需在浏览器中手动操作    |
| 输出验证 | 📝   | 需检查 DevTools/Console |

## 状态说明

- ✅ 测试通过
- ❌ 测试失败
- ⏳ 待测试
- 🔧 需修复

---

## 1. 离线模式支持 👆

### 1.1 异常节点展示

```
操作步骤:
1. 打开工作流编辑器
2. 添加一个可能触发异常的节点 (如 HTTP/Plugin)
3. 故意触发错误状态

验证:
- [ ] 异常节点展示时项目信息正确显示
- [ ] 前端缓存处理正常

状态: ⏳
```

### 1.2 循环节点初始化

```
操作步骤:
1. 点击侧边栏添加循环节点
2. 观察循环节点内部

验证:
- [ ] 内部开始节点 (LoopStart) 正确展示
- [ ] 内部结束节点 (LoopEnd) 正确展示
- [ ] 节点连线正确

状态: ⏳
```

### 1.3 离线状态提示

```
操作步骤:
1. 断开网络连接
2. 尝试保存工作流

验证:
- [ ] 离线提示消息友好
- [ ] 有离线状态指示器显示

状态: ⏳
```

---

## 2. 变量引用向上查找逻辑 👆 📝 ✅

### 2.1 条件节点初始状态

```
操作步骤:
1. 创建工作流: 开始 → 条件分支 → LLM → 结束
2. 条件分支保持初始状态（不配置）
3. 点击 LLM 节点打开变量选择器

验证:
- [x] 条件节点不被错误命中为上游节点
- [x] 变量列表只显示开始节点

状态: ✅
```

### 2.2 开始节点编辑

```
操作步骤:
1. 编辑开始节点的输入参数: 添加 { name: "testVar", type: "String" }
2. 保存
3. 点击下游 LLM 节点打开变量选择器

验证:
- [x] 变量列表显示刚添加的 testVar
- [x] 变量格式: "开始.testVar"

预期 Console:
[ReferenceList] previousNodes 包含开始节点

状态: ✅
```

### 2.3 变量引用标签

```
操作步骤:
1. 在 LLM 节点选择变量引用
2. 查看已选变量的标签显示

验证:
- [x] 不显示 "undefined - 变量名" 格式
- [x] 正确显示 "节点名.变量名" 格式

状态: ✅
```

---

## 3. 保存逻辑优化 📝 ✅

### 3.1 边一致性验证

```
操作步骤:
1. 创建工作流: 开始 → LLM → 结束
2. 添加连线
3. 删除中间节点 (LLM)
4. 保存

验证 (DevTools → Network → /api/workflow/save):
- [x] Payload 不包含已删除节点的 ID
- [x] 无效边自动移除
- [x] nextNodeIds 不包含已删除节点

状态: ✅
```

### 3.2 nextNodeIds 一致性

```
操作步骤:
1. 创建连线: 开始 → LLM
2. 保存 → 刷新
3. 再添加连线: LLM → 结束
4. 保存 → 刷新

验证 (DevTools → Network):
- [x] 每次保存 nextNodeIds 与画布边一致
- [x] 刷新后连线正确恢复

状态: ✅
```

---

## 4. 循环节点内功能测试 👆 📝

### 4.1 变量聚合测试

```
操作步骤:
1. 创建循环节点
2. 在循环内部添加 VariableAggregation 节点
3. 配置分组: 添加 group1 → 选择变量
4. 保存 → 刷新页面

验证:
- [ ] 变量聚合节点添加成功
- [ ] 分组配置正确保存
- [ ] 刷新后配置正确回显
- [ ] 输出展示嵌套子字段正确

预期 Network:
/api/workflow/save Payload 包含 VariableAggregation 配置

状态: ⏳
```

### 4.2 变量引用查找逻辑测试

```
操作步骤:
1. 创建: 开始 → 循环 (内部: LoopStart → LLM → LoopEnd) → 结束
2. 在循环开始节点添加输出变量
3. 点击循环内 LLM 节点打开变量选择器

验证:
- [ ] 可以引用循环外部开始节点的变量
- [ ] 可以引用循环内部 LoopStart 的变量
- [ ] 循环内节点之间变量引用正常

状态: ⏳
```

---

## 5. 试运行功能 👆 📝

### 5.1 基础试运行

```
操作步骤:
1. 创建简单工作流: 开始 → LLM → 结束
2. 配置开始节点输入参数
3. 配置 LLM 节点
4. 点击试运行按钮

验证:
- [ ] 弹窗正确显示
- [ ] 输入参数配置正确显示
- [ ] 填入参数后执行成功
- [ ] 运行结果正确展示

状态: ⏳
```

### 5.2 节点运行状态

```
操作步骤:
1. 执行试运行
2. 观察各节点状态变化

验证:
- [ ] 执行中节点高亮显示
- [ ] 完成节点显示结果数据
- [ ] 失败节点正确标记错误

状态: ⏳
```

---

## 测试记录

| 日期 | 测试人 | 通过项 | 失败项 | 备注 |
| ---- | ------ | ------ | ------ | ---- |
|      |        |        |        |      |

---

_最后更新: 2025-12-17_
