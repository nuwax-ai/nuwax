# åˆ·æ–°é—®é¢˜ä¿®å¤æ€»ç»“

## é—®é¢˜åˆ†æ

### åŸå§‹é—®é¢˜

åœæ­¢æœåŠ¡å’Œé‡å¯æœåŠ¡åï¼ŒPreview ç»„ä»¶æ²¡æœ‰æ­£ç¡®åˆ·æ–°ã€‚

### æ ¹æœ¬åŸå› 

1. **çŠ¶æ€æ›´æ–°æ—¶æœºé—®é¢˜**ï¼š`updateDevServerUrl` æ˜¯å¼‚æ­¥çŠ¶æ€æ›´æ–°ï¼Œæ‰‹åŠ¨è°ƒç”¨ `refreshPreview` æ—¶ï¼Œ`devServerUrl` å¯èƒ½è¿˜æ˜¯æ—§å€¼
2. **ä¾èµ–é—®é¢˜**ï¼š`refreshPreview` æ–¹æ³•ä¾èµ– `devServerUrl` å‚æ•°ï¼Œä½†è°ƒç”¨æ—¶å‚æ•°å¯èƒ½æœªæ›´æ–°
3. **æ—¶æœºæ§åˆ¶é—®é¢˜**ï¼šæ‰‹åŠ¨è°ƒç”¨åˆ·æ–°éœ€è¦ç²¾ç¡®æ§åˆ¶æ—¶æœºï¼Œå®¹æ˜“å‡ºç°ç«æ€æ¡ä»¶

## è§£å†³æ–¹æ¡ˆ

### 1. ä½¿ç”¨ useEffect è‡ªåŠ¨ç›‘å¬çŠ¶æ€å˜åŒ–

**æ–‡ä»¶**: `src/components/WebIDE/Preview/index.tsx`

```typescript
// å½“å¼€å‘æœåŠ¡å™¨URLå¯ç”¨æ—¶ï¼Œè‡ªåŠ¨åŠ è½½é¢„è§ˆ
useEffect(() => {
  console.log('ğŸŒ [Preview] devServerUrl changed:', devServerUrl);
  if (devServerUrl) {
    console.log('ğŸŒ [Preview] Dev server URL available, loading preview');
    loadDevServerPreview();
  } else {
    console.log('ğŸŒ [Preview] Dev server URL is empty, clearing iframe');
    if (iframeRef.current) {
      iframeRef.current.src = '';
    }
    setLoadError('å¼€å‘æœåŠ¡å™¨URLä¸å¯ç”¨');
    setLastRefreshed(new Date());
  }
}, [devServerUrl, loadDevServerPreview]);
```

**ä¼˜åŠ¿**:

- è‡ªåŠ¨å“åº”çŠ¶æ€å˜åŒ–
- æ— éœ€æ‰‹åŠ¨æ§åˆ¶æ—¶æœº
- é¿å…ç«æ€æ¡ä»¶
- ä»£ç æ›´ç®€æ´

### 2. ç®€åŒ– AppDev ä¸­çš„é‡å¯é€»è¾‘

**æ–‡ä»¶**: `src/pages/AppDev/index.tsx`

```typescript
// å¦‚æœè¿”å›äº†æ–°çš„å¼€å‘æœåŠ¡å™¨URLï¼Œæ›´æ–°å®ƒ
if (response?.data?.devServerUrl) {
  console.log('ğŸ”— [AppDev] æ›´æ–°å¼€å‘æœåŠ¡å™¨URL:', response.data.devServerUrl);
  updateDevServerUrl(response.data.devServerUrl);
  // Previewç»„ä»¶ä¼šé€šè¿‡useEffectè‡ªåŠ¨ç›‘å¬devServerUrlå˜åŒ–å¹¶åˆ·æ–°
} else {
  console.warn('âš ï¸ [AppDev] é‡å¯å“åº”ä¸­æ²¡æœ‰devServerUrlå­—æ®µ');
}
```

**ä¼˜åŠ¿**:

- ç§»é™¤äº†å¤æ‚çš„æ‰‹åŠ¨åˆ·æ–°é€»è¾‘
- ç§»é™¤äº† setTimeout å»¶è¿Ÿ
- ä»£ç æ›´æ¸…æ™°
- å‡å°‘äº†å‡ºé”™çš„å¯èƒ½æ€§

### 3. å¢å¼ºåœæ­¢æœåŠ¡é€»è¾‘

**æ–‡ä»¶**: `src/pages/AppDev/index.tsx`

```typescript
// åœæ­¢æˆåŠŸåæ¸…ç©ºå¼€å‘æœåŠ¡å™¨URLå¹¶æ›´æ–°æœåŠ¡çŠ¶æ€
updateDevServerUrl('');
setIsServiceRunning(false);

// é‡ç½®å¯åŠ¨çŠ¶æ€ï¼Œå…è®¸é‡æ–°å¯åŠ¨
hasStartedDevRef.current = false;
```

**ä¼˜åŠ¿**:

- ç¡®ä¿åœæ­¢åçŠ¶æ€æ­£ç¡®
- å…è®¸é‡æ–°å¯åŠ¨
- Preview ç»„ä»¶è‡ªåŠ¨æ˜¾ç¤ºç­‰å¾…çŠ¶æ€

## æŠ€æœ¯æ”¹è¿›

### 1. è°ƒè¯•æ—¥å¿—å¢å¼º

- æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- ä¾¿äºé—®é¢˜æ’æŸ¥
- å¯ä»¥è¿½è¸ªæ•´ä¸ªæµç¨‹

### 2. é”™è¯¯å¤„ç†æ”¹è¿›

- å¢åŠ äº†æ›´å¤šçš„é”™è¯¯æ£€æŸ¥
- æä¾›äº†æ›´æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- æ”¹å–„äº†ç”¨æˆ·ä½“éªŒ

### 3. çŠ¶æ€ç®¡ç†ä¼˜åŒ–

- ä½¿ç”¨ React çš„ useEffect è‡ªåŠ¨å“åº”çŠ¶æ€å˜åŒ–
- é¿å…äº†æ‰‹åŠ¨çŠ¶æ€åŒæ­¥çš„å¤æ‚æ€§
- æé«˜äº†ä»£ç çš„å¯é æ€§

## åŠŸèƒ½æµç¨‹

### åœæ­¢æœåŠ¡æµç¨‹

1. ç”¨æˆ·ç‚¹å‡»"åœæ­¢"æŒ‰é’®
2. è°ƒç”¨ `stopDev` API
3. æˆåŠŸåè°ƒç”¨ `updateDevServerUrl('')`
4. Preview ç»„ä»¶çš„ useEffect ç›‘å¬åˆ° devServerUrl å˜åŒ–
5. è‡ªåŠ¨æ¸…ç©º iframe å¹¶æ˜¾ç¤ºç­‰å¾…çŠ¶æ€

### é‡å¯æœåŠ¡æµç¨‹

1. ç”¨æˆ·ç‚¹å‡»"é‡å¯"æŒ‰é’®
2. è°ƒç”¨ `restartDev` API
3. æˆåŠŸåè°ƒç”¨ `updateDevServerUrl(newUrl)`
4. Preview ç»„ä»¶çš„ useEffect ç›‘å¬åˆ° devServerUrl å˜åŒ–
5. è‡ªåŠ¨åŠ è½½æ–°çš„ URL å¹¶åˆ·æ–°é¢„è§ˆ

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
2. ç‚¹å‡»"åœæ­¢"æŒ‰é’® - Preview åº”è¯¥æ˜¾ç¤ºç­‰å¾…çŠ¶æ€
3. ç‚¹å‡»"é‡å¯"æŒ‰é’® - Preview åº”è¯¥è‡ªåŠ¨åˆ·æ–°å¹¶æ˜¾ç¤ºæ–°å†…å®¹
4. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤æµç¨‹æ­£å¸¸

### é¢„æœŸç»“æœ

- åœæ­¢æœåŠ¡åï¼ŒPreview ç»„ä»¶æ˜¾ç¤º"ç­‰å¾…å¼€å‘æœåŠ¡å™¨å¯åŠ¨"
- é‡å¯æœåŠ¡åï¼ŒPreview ç»„ä»¶è‡ªåŠ¨åˆ·æ–°å¹¶æ˜¾ç¤ºæ–°å†…å®¹
- æ§åˆ¶å°æ—¥å¿—æ˜¾ç¤ºå®Œæ•´çš„æ“ä½œæµç¨‹
- æ— é”™è¯¯æˆ–è­¦å‘Š

## ä»£ç è´¨é‡æ”¹è¿›

1. **å¯ç»´æŠ¤æ€§**: ä½¿ç”¨ React æ ‡å‡†æ¨¡å¼ï¼Œä»£ç æ›´æ˜“ç»´æŠ¤
2. **å¯è¯»æ€§**: ç§»é™¤äº†å¤æ‚çš„æ—¶æœºæ§åˆ¶é€»è¾‘
3. **å¯é æ€§**: ä½¿ç”¨ React çš„å“åº”å¼æœºåˆ¶ï¼Œæ›´å¯é 
4. **è°ƒè¯•æ€§**: å¢åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—

## æ³¨æ„äº‹é¡¹

1. **useEffect ä¾èµ–**: ç¡®ä¿ useEffect çš„ä¾èµ–æ•°ç»„æ­£ç¡®
2. **çŠ¶æ€æ›´æ–°**: çŠ¶æ€æ›´æ–°æ˜¯å¼‚æ­¥çš„ï¼ŒuseEffect ä¼šè‡ªåŠ¨å¤„ç†
3. **é”™è¯¯å¤„ç†**: ä¿æŒäº†åŸæœ‰çš„é”™è¯¯å¤„ç†æœºåˆ¶
4. **æ€§èƒ½**: useEffect åªåœ¨ devServerUrl å˜åŒ–æ—¶è§¦å‘ï¼Œæ€§èƒ½è‰¯å¥½
