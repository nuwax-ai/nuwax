# PromptVariableRef 一次性删除功能测试指南

## 功能概述

新版本 v1.3.0 为 PromptVariableRef 组件添加了**一次性删除高亮区块**功能。当用户将光标放在高亮的变量引用区块（如 `{{user.name}}`）中时，按退格键或删除键可以一次性删除整个高亮区块，而不是逐个字符删除。

## 测试步骤

### 1. 基础功能测试

1. 访问测试页面：`/examples/ScrollTest`
2. 点击"插入长文本"按钮生成测试内容
3. 观察文本中高亮的变量引用区块（如 `{{user0.name}}`）
4. 将光标放在任意高亮区块内
5. 按退格键（Backspace）或删除键（Delete）
6. 验证整个高亮区块被一次性删除

### 2. 视觉反馈测试

1. 观察高亮区块的视觉特征：

   - ⚡ 闪电图标
   - 淡蓝色背景和边框
   - 字体加粗显示

2. 将鼠标悬停在高亮区块上：
   - 应该显示"← 一次删除"的 hover 提示
   - 背景色会变深

### 3. 边界条件测试

1. **光标在高亮区块外**：

   - 退格键和删除键应该执行正常的逐字符删除
   - 不应该触发一次性删除功能

2. **多个高亮区块**：

   - 验证每个高亮区块都可以独立一次性删除
   - 删除其中一个不应该影响其他的

3. **光标在边界位置**：
   - 光标在高亮区块开头、中间、结尾都应该能触发一次性删除
   - 删除后光标应该正确移动到删除位置

### 4. 滚动位置测试

1. 滚动输入框到不同位置
2. 在滚动位置尝试一次性删除功能
3. 验证功能在滚动状态下仍然正常工作

## 预期结果

### ✅ 成功情况

- 高亮区块显示闪电图标 ⚡
- hover 时显示删除提示
- 在高亮区块内按删除键一次性删除整个区块
- 删除后光标正确移动
- 在高亮区块外保持正常删除行为

### ❌ 失败情况

- 高亮区块没有视觉标识
- 删除操作仍然是逐字符删除
- 删除后光标位置不正确
- 在高亮区块外也触发一次性删除

## 调试信息

在浏览器控制台中应该看到以下调试信息：

```
检测到删除操作，原值: ... 新值: ... 光标位置: ...
发现高亮区块，一次性删除: {start: xxx, end: xxx, content: "{{user.name}}", variableName: "user.name"}
高亮区块删除已处理，不再执行默认删除逻辑
```

如果没有看到这些信息，可能的原因：

1. 新功能未正确加载
2. 光标位置计算有误
3. 高亮区块识别逻辑有问题

## 用户体验改进

这个功能显著提升了用户体验：

- **效率提升**：不需要手动选中整个变量引用再删除
- **视觉清晰**：高亮区块有明确的视觉标识
- **智能保护**：不会影响正常的文本编辑
- **向下兼容**：现有用户不受影响

## 相关文件

- `PromptVariableRef.tsx` - 主要功能实现
- `styles.less` - 样式增强
- `CHANGELOG.md` - 版本变更记录
- `/examples/ScrollTest/index.tsx` - 专用测试页面
